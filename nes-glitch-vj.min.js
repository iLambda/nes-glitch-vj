(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){window.glitchnes=window.glitchnes||{};window.glitchnes.Session=require("./lib/session.js")},{"./lib/session.js":2}],2:[function(require,module,exports){var _=require("lodash");var NESEmulator=require("nesnes");function Session(canvas,settings){settings=settings||{midiport:0};this.emulator=new NESEmulator(canvas);this.emulator.load("/glitchnes.nes",true);this.emulator.input.configure(0,"keyboard",{z:"a",x:"b",shift:"select","return":"start",up:"up",down:"down",left:"left",right:"right"})}Session.prototype.bindto=function(btn){};function pressed(btn){}function released(btn){}module.exports=Session},{lodash:3,nesnes:6}],3:[function(require,module,exports){(function(global){(function(){var undefined;var VERSION="4.17.4";var LARGE_ARRAY_SIZE=200;var CORE_ERROR_TEXT="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",FUNC_ERROR_TEXT="Expected a function";var HASH_UNDEFINED="__lodash_hash_undefined__";var MAX_MEMOIZE_SIZE=500;var PLACEHOLDER="__lodash_placeholder__";var CLONE_DEEP_FLAG=1,CLONE_FLAT_FLAG=2,CLONE_SYMBOLS_FLAG=4;var COMPARE_PARTIAL_FLAG=1,COMPARE_UNORDERED_FLAG=2;var WRAP_BIND_FLAG=1,WRAP_BIND_KEY_FLAG=2,WRAP_CURRY_BOUND_FLAG=4,WRAP_CURRY_FLAG=8,WRAP_CURRY_RIGHT_FLAG=16,WRAP_PARTIAL_FLAG=32,WRAP_PARTIAL_RIGHT_FLAG=64,WRAP_ARY_FLAG=128,WRAP_REARG_FLAG=256,WRAP_FLIP_FLAG=512;var DEFAULT_TRUNC_LENGTH=30,DEFAULT_TRUNC_OMISSION="...";var HOT_COUNT=800,HOT_SPAN=16;var LAZY_FILTER_FLAG=1,LAZY_MAP_FLAG=2,LAZY_WHILE_FLAG=3;var INFINITY=1/0,MAX_SAFE_INTEGER=9007199254740991,MAX_INTEGER=1.7976931348623157e308,NAN=0/0;var MAX_ARRAY_LENGTH=4294967295,MAX_ARRAY_INDEX=MAX_ARRAY_LENGTH-1,HALF_MAX_ARRAY_LENGTH=MAX_ARRAY_LENGTH>>>1;var wrapFlags=[["ary",WRAP_ARY_FLAG],["bind",WRAP_BIND_FLAG],["bindKey",WRAP_BIND_KEY_FLAG],["curry",WRAP_CURRY_FLAG],["curryRight",WRAP_CURRY_RIGHT_FLAG],["flip",WRAP_FLIP_FLAG],["partial",WRAP_PARTIAL_FLAG],["partialRight",WRAP_PARTIAL_RIGHT_FLAG],["rearg",WRAP_REARG_FLAG]];var argsTag="[object Arguments]",arrayTag="[object Array]",asyncTag="[object AsyncFunction]",boolTag="[object Boolean]",dateTag="[object Date]",domExcTag="[object DOMException]",errorTag="[object Error]",funcTag="[object Function]",genTag="[object GeneratorFunction]",mapTag="[object Map]",numberTag="[object Number]",nullTag="[object Null]",objectTag="[object Object]",promiseTag="[object Promise]",proxyTag="[object Proxy]",regexpTag="[object RegExp]",setTag="[object Set]",stringTag="[object String]",symbolTag="[object Symbol]",undefinedTag="[object Undefined]",weakMapTag="[object WeakMap]",weakSetTag="[object WeakSet]";var arrayBufferTag="[object ArrayBuffer]",dataViewTag="[object DataView]",float32Tag="[object Float32Array]",float64Tag="[object Float64Array]",int8Tag="[object Int8Array]",int16Tag="[object Int16Array]",int32Tag="[object Int32Array]",uint8Tag="[object Uint8Array]",uint8ClampedTag="[object Uint8ClampedArray]",uint16Tag="[object Uint16Array]",uint32Tag="[object Uint32Array]";var reEmptyStringLeading=/\b__p \+= '';/g,reEmptyStringMiddle=/\b(__p \+=) '' \+/g,reEmptyStringTrailing=/(__e\(.*?\)|\b__t\)) \+\n'';/g;var reEscapedHtml=/&(?:amp|lt|gt|quot|#39);/g,reUnescapedHtml=/[&<>"']/g,reHasEscapedHtml=RegExp(reEscapedHtml.source),reHasUnescapedHtml=RegExp(reUnescapedHtml.source);var reEscape=/<%-([\s\S]+?)%>/g,reEvaluate=/<%([\s\S]+?)%>/g,reInterpolate=/<%=([\s\S]+?)%>/g;var reIsDeepProp=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,reIsPlainProp=/^\w*$/,reLeadingDot=/^\./,rePropName=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g;var reRegExpChar=/[\\^$.*+?()[\]{}|]/g,reHasRegExpChar=RegExp(reRegExpChar.source);var reTrim=/^\s+|\s+$/g,reTrimStart=/^\s+/,reTrimEnd=/\s+$/;var reWrapComment=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,reWrapDetails=/\{\n\/\* \[wrapped with (.+)\] \*/,reSplitDetails=/,? & /;var reAsciiWord=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g;var reEscapeChar=/\\(\\)?/g;var reEsTemplate=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g;var reFlags=/\w*$/;var reIsBadHex=/^[-+]0x[0-9a-f]+$/i;var reIsBinary=/^0b[01]+$/i;var reIsHostCtor=/^\[object .+?Constructor\]$/;var reIsOctal=/^0o[0-7]+$/i;var reIsUint=/^(?:0|[1-9]\d*)$/;var reLatin=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g;var reNoMatch=/($^)/;var reUnescapedString=/['\n\r\u2028\u2029\\]/g;var rsAstralRange="\\ud800-\\udfff",rsComboMarksRange="\\u0300-\\u036f",reComboHalfMarksRange="\\ufe20-\\ufe2f",rsComboSymbolsRange="\\u20d0-\\u20ff",rsComboRange=rsComboMarksRange+reComboHalfMarksRange+rsComboSymbolsRange,rsDingbatRange="\\u2700-\\u27bf",rsLowerRange="a-z\\xdf-\\xf6\\xf8-\\xff",rsMathOpRange="\\xac\\xb1\\xd7\\xf7",rsNonCharRange="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",rsPunctuationRange="\\u2000-\\u206f",rsSpaceRange=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",rsUpperRange="A-Z\\xc0-\\xd6\\xd8-\\xde",rsVarRange="\\ufe0e\\ufe0f",rsBreakRange=rsMathOpRange+rsNonCharRange+rsPunctuationRange+rsSpaceRange;var rsApos="['’]",rsAstral="["+rsAstralRange+"]",rsBreak="["+rsBreakRange+"]",rsCombo="["+rsComboRange+"]",rsDigits="\\d+",rsDingbat="["+rsDingbatRange+"]",rsLower="["+rsLowerRange+"]",rsMisc="[^"+rsAstralRange+rsBreakRange+rsDigits+rsDingbatRange+rsLowerRange+rsUpperRange+"]",rsFitz="\\ud83c[\\udffb-\\udfff]",rsModifier="(?:"+rsCombo+"|"+rsFitz+")",rsNonAstral="[^"+rsAstralRange+"]",rsRegional="(?:\\ud83c[\\udde6-\\uddff]){2}",rsSurrPair="[\\ud800-\\udbff][\\udc00-\\udfff]",rsUpper="["+rsUpperRange+"]",rsZWJ="\\u200d";var rsMiscLower="(?:"+rsLower+"|"+rsMisc+")",rsMiscUpper="(?:"+rsUpper+"|"+rsMisc+")",rsOptContrLower="(?:"+rsApos+"(?:d|ll|m|re|s|t|ve))?",rsOptContrUpper="(?:"+rsApos+"(?:D|LL|M|RE|S|T|VE))?",reOptMod=rsModifier+"?",rsOptVar="["+rsVarRange+"]?",rsOptJoin="(?:"+rsZWJ+"(?:"+[rsNonAstral,rsRegional,rsSurrPair].join("|")+")"+rsOptVar+reOptMod+")*",rsOrdLower="\\d*(?:(?:1st|2nd|3rd|(?![123])\\dth)\\b)",rsOrdUpper="\\d*(?:(?:1ST|2ND|3RD|(?![123])\\dTH)\\b)",rsSeq=rsOptVar+reOptMod+rsOptJoin,rsEmoji="(?:"+[rsDingbat,rsRegional,rsSurrPair].join("|")+")"+rsSeq,rsSymbol="(?:"+[rsNonAstral+rsCombo+"?",rsCombo,rsRegional,rsSurrPair,rsAstral].join("|")+")";var reApos=RegExp(rsApos,"g");var reComboMark=RegExp(rsCombo,"g");var reUnicode=RegExp(rsFitz+"(?="+rsFitz+")|"+rsSymbol+rsSeq,"g");var reUnicodeWord=RegExp([rsUpper+"?"+rsLower+"+"+rsOptContrLower+"(?="+[rsBreak,rsUpper,"$"].join("|")+")",rsMiscUpper+"+"+rsOptContrUpper+"(?="+[rsBreak,rsUpper+rsMiscLower,"$"].join("|")+")",rsUpper+"?"+rsMiscLower+"+"+rsOptContrLower,rsUpper+"+"+rsOptContrUpper,rsOrdUpper,rsOrdLower,rsDigits,rsEmoji].join("|"),"g");var reHasUnicode=RegExp("["+rsZWJ+rsAstralRange+rsComboRange+rsVarRange+"]");var reHasUnicodeWord=/[a-z][A-Z]|[A-Z]{2,}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/;var contextProps=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"];var templateCounter=-1;var typedArrayTags={};typedArrayTags[float32Tag]=typedArrayTags[float64Tag]=typedArrayTags[int8Tag]=typedArrayTags[int16Tag]=typedArrayTags[int32Tag]=typedArrayTags[uint8Tag]=typedArrayTags[uint8ClampedTag]=typedArrayTags[uint16Tag]=typedArrayTags[uint32Tag]=true;typedArrayTags[argsTag]=typedArrayTags[arrayTag]=typedArrayTags[arrayBufferTag]=typedArrayTags[boolTag]=typedArrayTags[dataViewTag]=typedArrayTags[dateTag]=typedArrayTags[errorTag]=typedArrayTags[funcTag]=typedArrayTags[mapTag]=typedArrayTags[numberTag]=typedArrayTags[objectTag]=typedArrayTags[regexpTag]=typedArrayTags[setTag]=typedArrayTags[stringTag]=typedArrayTags[weakMapTag]=false;var cloneableTags={};cloneableTags[argsTag]=cloneableTags[arrayTag]=cloneableTags[arrayBufferTag]=cloneableTags[dataViewTag]=cloneableTags[boolTag]=cloneableTags[dateTag]=cloneableTags[float32Tag]=cloneableTags[float64Tag]=cloneableTags[int8Tag]=cloneableTags[int16Tag]=cloneableTags[int32Tag]=cloneableTags[mapTag]=cloneableTags[numberTag]=cloneableTags[objectTag]=cloneableTags[regexpTag]=cloneableTags[setTag]=cloneableTags[stringTag]=cloneableTags[symbolTag]=cloneableTags[uint8Tag]=cloneableTags[uint8ClampedTag]=cloneableTags[uint16Tag]=cloneableTags[uint32Tag]=true;cloneableTags[errorTag]=cloneableTags[funcTag]=cloneableTags[weakMapTag]=false;var deburredLetters={"À":"A","Á":"A","Â":"A","Ã":"A","Ä":"A","Å":"A","à":"a","á":"a","â":"a","ã":"a","ä":"a","å":"a","Ç":"C","ç":"c","Ð":"D","ð":"d","È":"E","É":"E","Ê":"E","Ë":"E","è":"e","é":"e","ê":"e","ë":"e","Ì":"I","Í":"I","Î":"I","Ï":"I","ì":"i","í":"i","î":"i","ï":"i","Ñ":"N","ñ":"n","Ò":"O","Ó":"O","Ô":"O","Õ":"O","Ö":"O","Ø":"O","ò":"o","ó":"o","ô":"o","õ":"o","ö":"o","ø":"o","Ù":"U","Ú":"U","Û":"U","Ü":"U","ù":"u","ú":"u","û":"u","ü":"u","Ý":"Y","ý":"y","ÿ":"y","Æ":"Ae","æ":"ae","Þ":"Th","þ":"th","ß":"ss","Ā":"A","Ă":"A","Ą":"A","ā":"a","ă":"a","ą":"a","Ć":"C","Ĉ":"C","Ċ":"C","Č":"C","ć":"c","ĉ":"c","ċ":"c","č":"c","Ď":"D","Đ":"D","ď":"d","đ":"d","Ē":"E","Ĕ":"E","Ė":"E","Ę":"E","Ě":"E","ē":"e","ĕ":"e","ė":"e","ę":"e","ě":"e","Ĝ":"G","Ğ":"G","Ġ":"G","Ģ":"G","ĝ":"g","ğ":"g","ġ":"g","ģ":"g","Ĥ":"H","Ħ":"H","ĥ":"h","ħ":"h","Ĩ":"I","Ī":"I","Ĭ":"I","Į":"I","İ":"I","ĩ":"i","ī":"i","ĭ":"i","į":"i","ı":"i","Ĵ":"J","ĵ":"j","Ķ":"K","ķ":"k","ĸ":"k","Ĺ":"L","Ļ":"L","Ľ":"L","Ŀ":"L","Ł":"L","ĺ":"l","ļ":"l","ľ":"l","ŀ":"l","ł":"l","Ń":"N","Ņ":"N","Ň":"N","Ŋ":"N","ń":"n","ņ":"n","ň":"n","ŋ":"n","Ō":"O","Ŏ":"O","Ő":"O","ō":"o","ŏ":"o","ő":"o","Ŕ":"R","Ŗ":"R","Ř":"R","ŕ":"r","ŗ":"r","ř":"r","Ś":"S","Ŝ":"S","Ş":"S","Š":"S","ś":"s","ŝ":"s","ş":"s","š":"s","Ţ":"T","Ť":"T","Ŧ":"T","ţ":"t","ť":"t","ŧ":"t","Ũ":"U","Ū":"U","Ŭ":"U","Ů":"U","Ű":"U","Ų":"U","ũ":"u","ū":"u","ŭ":"u","ů":"u","ű":"u","ų":"u","Ŵ":"W","ŵ":"w","Ŷ":"Y","ŷ":"y","Ÿ":"Y","Ź":"Z","Ż":"Z","Ž":"Z","ź":"z","ż":"z","ž":"z","Ĳ":"IJ","ĳ":"ij","Œ":"Oe","œ":"oe","ŉ":"'n","ſ":"s"};var htmlEscapes={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"};var htmlUnescapes={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"};var stringEscapes={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"};var freeParseFloat=parseFloat,freeParseInt=parseInt;var freeGlobal=typeof global=="object"&&global&&global.Object===Object&&global;var freeSelf=typeof self=="object"&&self&&self.Object===Object&&self;var root=freeGlobal||freeSelf||Function("return this")();var freeExports=typeof exports=="object"&&exports&&!exports.nodeType&&exports;var freeModule=freeExports&&typeof module=="object"&&module&&!module.nodeType&&module;var moduleExports=freeModule&&freeModule.exports===freeExports;var freeProcess=moduleExports&&freeGlobal.process;var nodeUtil=function(){try{return freeProcess&&freeProcess.binding&&freeProcess.binding("util")}catch(e){}}();var nodeIsArrayBuffer=nodeUtil&&nodeUtil.isArrayBuffer,nodeIsDate=nodeUtil&&nodeUtil.isDate,nodeIsMap=nodeUtil&&nodeUtil.isMap,nodeIsRegExp=nodeUtil&&nodeUtil.isRegExp,nodeIsSet=nodeUtil&&nodeUtil.isSet,nodeIsTypedArray=nodeUtil&&nodeUtil.isTypedArray;function addMapEntry(map,pair){map.set(pair[0],pair[1]);return map}function addSetEntry(set,value){set.add(value);return set}function apply(func,thisArg,args){switch(args.length){case 0:return func.call(thisArg);case 1:return func.call(thisArg,args[0]);case 2:return func.call(thisArg,args[0],args[1]);case 3:return func.call(thisArg,args[0],args[1],args[2])}return func.apply(thisArg,args)}function arrayAggregator(array,setter,iteratee,accumulator){var index=-1,length=array==null?0:array.length;while(++index<length){var value=array[index];setter(accumulator,value,iteratee(value),array)}return accumulator}function arrayEach(array,iteratee){var index=-1,length=array==null?0:array.length;while(++index<length){if(iteratee(array[index],index,array)===false){break}}return array}function arrayEachRight(array,iteratee){var length=array==null?0:array.length;while(length--){if(iteratee(array[length],length,array)===false){break}}return array}function arrayEvery(array,predicate){var index=-1,length=array==null?0:array.length;while(++index<length){if(!predicate(array[index],index,array)){return false}}return true}function arrayFilter(array,predicate){var index=-1,length=array==null?0:array.length,resIndex=0,result=[];while(++index<length){var value=array[index];if(predicate(value,index,array)){result[resIndex++]=value}}return result}function arrayIncludes(array,value){var length=array==null?0:array.length;return!!length&&baseIndexOf(array,value,0)>-1}function arrayIncludesWith(array,value,comparator){var index=-1,length=array==null?0:array.length;while(++index<length){if(comparator(value,array[index])){return true}}return false}function arrayMap(array,iteratee){var index=-1,length=array==null?0:array.length,result=Array(length);while(++index<length){result[index]=iteratee(array[index],index,array)}return result}function arrayPush(array,values){var index=-1,length=values.length,offset=array.length;while(++index<length){array[offset+index]=values[index]}return array}function arrayReduce(array,iteratee,accumulator,initAccum){var index=-1,length=array==null?0:array.length;if(initAccum&&length){accumulator=array[++index]}while(++index<length){accumulator=iteratee(accumulator,array[index],index,array)}return accumulator}function arrayReduceRight(array,iteratee,accumulator,initAccum){var length=array==null?0:array.length;if(initAccum&&length){accumulator=array[--length]}while(length--){accumulator=iteratee(accumulator,array[length],length,array)}return accumulator}function arraySome(array,predicate){var index=-1,length=array==null?0:array.length;while(++index<length){if(predicate(array[index],index,array)){return true}}return false}var asciiSize=baseProperty("length");function asciiToArray(string){return string.split("")}function asciiWords(string){return string.match(reAsciiWord)||[]}function baseFindKey(collection,predicate,eachFunc){var result;eachFunc(collection,function(value,key,collection){if(predicate(value,key,collection)){result=key;return false}});return result}function baseFindIndex(array,predicate,fromIndex,fromRight){var length=array.length,index=fromIndex+(fromRight?1:-1);while(fromRight?index--:++index<length){if(predicate(array[index],index,array)){return index}}return-1}function baseIndexOf(array,value,fromIndex){return value===value?strictIndexOf(array,value,fromIndex):baseFindIndex(array,baseIsNaN,fromIndex)}function baseIndexOfWith(array,value,fromIndex,comparator){var index=fromIndex-1,length=array.length;while(++index<length){if(comparator(array[index],value)){return index}}return-1}function baseIsNaN(value){return value!==value}function baseMean(array,iteratee){var length=array==null?0:array.length;return length?baseSum(array,iteratee)/length:NAN}function baseProperty(key){return function(object){return object==null?undefined:object[key]}}function basePropertyOf(object){return function(key){return object==null?undefined:object[key]}}function baseReduce(collection,iteratee,accumulator,initAccum,eachFunc){eachFunc(collection,function(value,index,collection){accumulator=initAccum?(initAccum=false,value):iteratee(accumulator,value,index,collection)});return accumulator}function baseSortBy(array,comparer){var length=array.length;array.sort(comparer);while(length--){array[length]=array[length].value}return array}function baseSum(array,iteratee){var result,index=-1,length=array.length;while(++index<length){var current=iteratee(array[index]);if(current!==undefined){result=result===undefined?current:result+current}}return result}function baseTimes(n,iteratee){var index=-1,result=Array(n);while(++index<n){result[index]=iteratee(index)}return result}function baseToPairs(object,props){return arrayMap(props,function(key){return[key,object[key]]})}function baseUnary(func){return function(value){return func(value)}}function baseValues(object,props){return arrayMap(props,function(key){return object[key]})}function cacheHas(cache,key){return cache.has(key)}function charsStartIndex(strSymbols,chrSymbols){var index=-1,length=strSymbols.length;while(++index<length&&baseIndexOf(chrSymbols,strSymbols[index],0)>-1){}return index}function charsEndIndex(strSymbols,chrSymbols){var index=strSymbols.length;while(index--&&baseIndexOf(chrSymbols,strSymbols[index],0)>-1){}return index}function countHolders(array,placeholder){var length=array.length,result=0;while(length--){if(array[length]===placeholder){++result}}return result}var deburrLetter=basePropertyOf(deburredLetters);var escapeHtmlChar=basePropertyOf(htmlEscapes);function escapeStringChar(chr){return"\\"+stringEscapes[chr]}function getValue(object,key){return object==null?undefined:object[key]}function hasUnicode(string){return reHasUnicode.test(string)}function hasUnicodeWord(string){return reHasUnicodeWord.test(string)}function iteratorToArray(iterator){var data,result=[];while(!(data=iterator.next()).done){result.push(data.value)}return result}function mapToArray(map){var index=-1,result=Array(map.size);map.forEach(function(value,key){result[++index]=[key,value]});return result}function overArg(func,transform){return function(arg){return func(transform(arg))}}function replaceHolders(array,placeholder){var index=-1,length=array.length,resIndex=0,result=[];while(++index<length){var value=array[index];if(value===placeholder||value===PLACEHOLDER){array[index]=PLACEHOLDER;result[resIndex++]=index}}return result}function setToArray(set){var index=-1,result=Array(set.size);set.forEach(function(value){result[++index]=value});return result}function setToPairs(set){var index=-1,result=Array(set.size);set.forEach(function(value){result[++index]=[value,value]});return result}function strictIndexOf(array,value,fromIndex){var index=fromIndex-1,length=array.length;while(++index<length){if(array[index]===value){return index}}return-1}function strictLastIndexOf(array,value,fromIndex){var index=fromIndex+1;while(index--){if(array[index]===value){return index}}return index}function stringSize(string){return hasUnicode(string)?unicodeSize(string):asciiSize(string)}function stringToArray(string){return hasUnicode(string)?unicodeToArray(string):asciiToArray(string)}var unescapeHtmlChar=basePropertyOf(htmlUnescapes);function unicodeSize(string){var result=reUnicode.lastIndex=0;while(reUnicode.test(string)){++result}return result}function unicodeToArray(string){return string.match(reUnicode)||[]}function unicodeWords(string){return string.match(reUnicodeWord)||[]}var runInContext=function runInContext(context){context=context==null?root:_.defaults(root.Object(),context,_.pick(root,contextProps));var Array=context.Array,Date=context.Date,Error=context.Error,Function=context.Function,Math=context.Math,Object=context.Object,RegExp=context.RegExp,String=context.String,TypeError=context.TypeError;var arrayProto=Array.prototype,funcProto=Function.prototype,objectProto=Object.prototype;var coreJsData=context["__core-js_shared__"];var funcToString=funcProto.toString;var hasOwnProperty=objectProto.hasOwnProperty;var idCounter=0;var maskSrcKey=function(){var uid=/[^.]+$/.exec(coreJsData&&coreJsData.keys&&coreJsData.keys.IE_PROTO||"");return uid?"Symbol(src)_1."+uid:""}();var nativeObjectToString=objectProto.toString;var objectCtorString=funcToString.call(Object);var oldDash=root._;var reIsNative=RegExp("^"+funcToString.call(hasOwnProperty).replace(reRegExpChar,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");var Buffer=moduleExports?context.Buffer:undefined,Symbol=context.Symbol,Uint8Array=context.Uint8Array,allocUnsafe=Buffer?Buffer.allocUnsafe:undefined,getPrototype=overArg(Object.getPrototypeOf,Object),objectCreate=Object.create,propertyIsEnumerable=objectProto.propertyIsEnumerable,splice=arrayProto.splice,spreadableSymbol=Symbol?Symbol.isConcatSpreadable:undefined,symIterator=Symbol?Symbol.iterator:undefined,symToStringTag=Symbol?Symbol.toStringTag:undefined;var defineProperty=function(){try{var func=getNative(Object,"defineProperty");func({},"",{});return func}catch(e){}}();var ctxClearTimeout=context.clearTimeout!==root.clearTimeout&&context.clearTimeout,ctxNow=Date&&Date.now!==root.Date.now&&Date.now,ctxSetTimeout=context.setTimeout!==root.setTimeout&&context.setTimeout;var nativeCeil=Math.ceil,nativeFloor=Math.floor,nativeGetSymbols=Object.getOwnPropertySymbols,nativeIsBuffer=Buffer?Buffer.isBuffer:undefined,nativeIsFinite=context.isFinite,nativeJoin=arrayProto.join,nativeKeys=overArg(Object.keys,Object),nativeMax=Math.max,nativeMin=Math.min,nativeNow=Date.now,nativeParseInt=context.parseInt,nativeRandom=Math.random,nativeReverse=arrayProto.reverse;var DataView=getNative(context,"DataView"),Map=getNative(context,"Map"),Promise=getNative(context,"Promise"),Set=getNative(context,"Set"),WeakMap=getNative(context,"WeakMap"),nativeCreate=getNative(Object,"create");var metaMap=WeakMap&&new WeakMap;var realNames={};var dataViewCtorString=toSource(DataView),mapCtorString=toSource(Map),promiseCtorString=toSource(Promise),setCtorString=toSource(Set),weakMapCtorString=toSource(WeakMap);var symbolProto=Symbol?Symbol.prototype:undefined,symbolValueOf=symbolProto?symbolProto.valueOf:undefined,symbolToString=symbolProto?symbolProto.toString:undefined;function lodash(value){if(isObjectLike(value)&&!isArray(value)&&!(value instanceof LazyWrapper)){if(value instanceof LodashWrapper){return value}if(hasOwnProperty.call(value,"__wrapped__")){return wrapperClone(value)}}return new LodashWrapper(value)}var baseCreate=function(){function object(){}return function(proto){if(!isObject(proto)){return{}}if(objectCreate){return objectCreate(proto)}object.prototype=proto;var result=new object;object.prototype=undefined;return result}}();function baseLodash(){}function LodashWrapper(value,chainAll){this.__wrapped__=value;this.__actions__=[];this.__chain__=!!chainAll;this.__index__=0;this.__values__=undefined}lodash.templateSettings={escape:reEscape,evaluate:reEvaluate,interpolate:reInterpolate,variable:"",imports:{_:lodash}};lodash.prototype=baseLodash.prototype;lodash.prototype.constructor=lodash;LodashWrapper.prototype=baseCreate(baseLodash.prototype);LodashWrapper.prototype.constructor=LodashWrapper;function LazyWrapper(value){this.__wrapped__=value;this.__actions__=[];this.__dir__=1;this.__filtered__=false;this.__iteratees__=[];this.__takeCount__=MAX_ARRAY_LENGTH;this.__views__=[]}function lazyClone(){var result=new LazyWrapper(this.__wrapped__);result.__actions__=copyArray(this.__actions__);result.__dir__=this.__dir__;result.__filtered__=this.__filtered__;result.__iteratees__=copyArray(this.__iteratees__);result.__takeCount__=this.__takeCount__;result.__views__=copyArray(this.__views__);return result}function lazyReverse(){if(this.__filtered__){var result=new LazyWrapper(this);result.__dir__=-1;result.__filtered__=true}else{result=this.clone();result.__dir__*=-1}return result}function lazyValue(){var array=this.__wrapped__.value(),dir=this.__dir__,isArr=isArray(array),isRight=dir<0,arrLength=isArr?array.length:0,view=getView(0,arrLength,this.__views__),start=view.start,end=view.end,length=end-start,index=isRight?end:start-1,iteratees=this.__iteratees__,iterLength=iteratees.length,resIndex=0,takeCount=nativeMin(length,this.__takeCount__);if(!isArr||!isRight&&arrLength==length&&takeCount==length){return baseWrapperValue(array,this.__actions__)}var result=[];outer:while(length--&&resIndex<takeCount){index+=dir;var iterIndex=-1,value=array[index];while(++iterIndex<iterLength){var data=iteratees[iterIndex],iteratee=data.iteratee,type=data.type,computed=iteratee(value);if(type==LAZY_MAP_FLAG){value=computed}else if(!computed){if(type==LAZY_FILTER_FLAG){continue outer}else{break outer}}}result[resIndex++]=value}return result}LazyWrapper.prototype=baseCreate(baseLodash.prototype);LazyWrapper.prototype.constructor=LazyWrapper;function Hash(entries){var index=-1,length=entries==null?0:entries.length;this.clear();while(++index<length){var entry=entries[index];this.set(entry[0],entry[1])}}function hashClear(){this.__data__=nativeCreate?nativeCreate(null):{};this.size=0}function hashDelete(key){var result=this.has(key)&&delete this.__data__[key];this.size-=result?1:0;return result}function hashGet(key){var data=this.__data__;if(nativeCreate){var result=data[key];return result===HASH_UNDEFINED?undefined:result}return hasOwnProperty.call(data,key)?data[key]:undefined}function hashHas(key){var data=this.__data__;return nativeCreate?data[key]!==undefined:hasOwnProperty.call(data,key)}function hashSet(key,value){var data=this.__data__;this.size+=this.has(key)?0:1;data[key]=nativeCreate&&value===undefined?HASH_UNDEFINED:value;return this}Hash.prototype.clear=hashClear;Hash.prototype["delete"]=hashDelete;Hash.prototype.get=hashGet;Hash.prototype.has=hashHas;Hash.prototype.set=hashSet;function ListCache(entries){var index=-1,length=entries==null?0:entries.length;this.clear();while(++index<length){var entry=entries[index];this.set(entry[0],entry[1])}}function listCacheClear(){this.__data__=[];this.size=0}function listCacheDelete(key){var data=this.__data__,index=assocIndexOf(data,key);if(index<0){return false}var lastIndex=data.length-1;if(index==lastIndex){data.pop()}else{splice.call(data,index,1)}--this.size;return true}function listCacheGet(key){var data=this.__data__,index=assocIndexOf(data,key);return index<0?undefined:data[index][1]}function listCacheHas(key){return assocIndexOf(this.__data__,key)>-1}function listCacheSet(key,value){var data=this.__data__,index=assocIndexOf(data,key);if(index<0){++this.size;data.push([key,value])}else{data[index][1]=value}return this}ListCache.prototype.clear=listCacheClear;ListCache.prototype["delete"]=listCacheDelete;ListCache.prototype.get=listCacheGet;ListCache.prototype.has=listCacheHas;ListCache.prototype.set=listCacheSet;function MapCache(entries){var index=-1,length=entries==null?0:entries.length;this.clear();while(++index<length){var entry=entries[index];this.set(entry[0],entry[1])}}function mapCacheClear(){this.size=0;this.__data__={hash:new Hash,map:new(Map||ListCache),string:new Hash}}function mapCacheDelete(key){var result=getMapData(this,key)["delete"](key);this.size-=result?1:0;return result}function mapCacheGet(key){return getMapData(this,key).get(key)}function mapCacheHas(key){return getMapData(this,key).has(key)}function mapCacheSet(key,value){var data=getMapData(this,key),size=data.size;data.set(key,value);this.size+=data.size==size?0:1;return this}MapCache.prototype.clear=mapCacheClear;MapCache.prototype["delete"]=mapCacheDelete;MapCache.prototype.get=mapCacheGet;MapCache.prototype.has=mapCacheHas;MapCache.prototype.set=mapCacheSet;function SetCache(values){var index=-1,length=values==null?0:values.length;this.__data__=new MapCache;while(++index<length){this.add(values[index])}}function setCacheAdd(value){this.__data__.set(value,HASH_UNDEFINED);return this}function setCacheHas(value){return this.__data__.has(value)}SetCache.prototype.add=SetCache.prototype.push=setCacheAdd;SetCache.prototype.has=setCacheHas;function Stack(entries){var data=this.__data__=new ListCache(entries);this.size=data.size}function stackClear(){this.__data__=new ListCache;this.size=0}function stackDelete(key){var data=this.__data__,result=data["delete"](key);this.size=data.size;return result}function stackGet(key){return this.__data__.get(key)}function stackHas(key){return this.__data__.has(key)}function stackSet(key,value){var data=this.__data__;if(data instanceof ListCache){var pairs=data.__data__;if(!Map||pairs.length<LARGE_ARRAY_SIZE-1){pairs.push([key,value]);this.size=++data.size;return this}data=this.__data__=new MapCache(pairs)}data.set(key,value);this.size=data.size;return this}Stack.prototype.clear=stackClear;Stack.prototype["delete"]=stackDelete;Stack.prototype.get=stackGet;Stack.prototype.has=stackHas;Stack.prototype.set=stackSet;function arrayLikeKeys(value,inherited){var isArr=isArray(value),isArg=!isArr&&isArguments(value),isBuff=!isArr&&!isArg&&isBuffer(value),isType=!isArr&&!isArg&&!isBuff&&isTypedArray(value),skipIndexes=isArr||isArg||isBuff||isType,result=skipIndexes?baseTimes(value.length,String):[],length=result.length;for(var key in value){if((inherited||hasOwnProperty.call(value,key))&&!(skipIndexes&&(key=="length"||isBuff&&(key=="offset"||key=="parent")||isType&&(key=="buffer"||key=="byteLength"||key=="byteOffset")||isIndex(key,length)))){result.push(key)}}return result}function arraySample(array){var length=array.length;return length?array[baseRandom(0,length-1)]:undefined}function arraySampleSize(array,n){return shuffleSelf(copyArray(array),baseClamp(n,0,array.length))}function arrayShuffle(array){return shuffleSelf(copyArray(array))}function assignMergeValue(object,key,value){if(value!==undefined&&!eq(object[key],value)||value===undefined&&!(key in object)){baseAssignValue(object,key,value)}}function assignValue(object,key,value){var objValue=object[key];if(!(hasOwnProperty.call(object,key)&&eq(objValue,value))||value===undefined&&!(key in object)){baseAssignValue(object,key,value)}}function assocIndexOf(array,key){var length=array.length;while(length--){if(eq(array[length][0],key)){return length}}return-1}function baseAggregator(collection,setter,iteratee,accumulator){baseEach(collection,function(value,key,collection){setter(accumulator,value,iteratee(value),collection)});return accumulator}function baseAssign(object,source){return object&&copyObject(source,keys(source),object)}function baseAssignIn(object,source){return object&&copyObject(source,keysIn(source),object)}function baseAssignValue(object,key,value){if(key=="__proto__"&&defineProperty){defineProperty(object,key,{configurable:true,enumerable:true,value:value,writable:true})}else{object[key]=value}}function baseAt(object,paths){var index=-1,length=paths.length,result=Array(length),skip=object==null;while(++index<length){result[index]=skip?undefined:get(object,paths[index])}return result}function baseClamp(number,lower,upper){if(number===number){if(upper!==undefined){number=number<=upper?number:upper}if(lower!==undefined){number=number>=lower?number:lower}}return number}function baseClone(value,bitmask,customizer,key,object,stack){var result,isDeep=bitmask&CLONE_DEEP_FLAG,isFlat=bitmask&CLONE_FLAT_FLAG,isFull=bitmask&CLONE_SYMBOLS_FLAG;if(customizer){result=object?customizer(value,key,object,stack):customizer(value)}if(result!==undefined){return result}if(!isObject(value)){return value}var isArr=isArray(value);if(isArr){result=initCloneArray(value);if(!isDeep){return copyArray(value,result)}}else{var tag=getTag(value),isFunc=tag==funcTag||tag==genTag;if(isBuffer(value)){return cloneBuffer(value,isDeep)}if(tag==objectTag||tag==argsTag||isFunc&&!object){result=isFlat||isFunc?{}:initCloneObject(value);if(!isDeep){return isFlat?copySymbolsIn(value,baseAssignIn(result,value)):copySymbols(value,baseAssign(result,value))}}else{if(!cloneableTags[tag]){return object?value:{}}result=initCloneByTag(value,tag,baseClone,isDeep)}}stack||(stack=new Stack);var stacked=stack.get(value);if(stacked){return stacked}stack.set(value,result);var keysFunc=isFull?isFlat?getAllKeysIn:getAllKeys:isFlat?keysIn:keys;var props=isArr?undefined:keysFunc(value);arrayEach(props||value,function(subValue,key){if(props){key=subValue;subValue=value[key]}assignValue(result,key,baseClone(subValue,bitmask,customizer,key,value,stack))});return result;

}function baseConforms(source){var props=keys(source);return function(object){return baseConformsTo(object,source,props)}}function baseConformsTo(object,source,props){var length=props.length;if(object==null){return!length}object=Object(object);while(length--){var key=props[length],predicate=source[key],value=object[key];if(value===undefined&&!(key in object)||!predicate(value)){return false}}return true}function baseDelay(func,wait,args){if(typeof func!="function"){throw new TypeError(FUNC_ERROR_TEXT)}return setTimeout(function(){func.apply(undefined,args)},wait)}function baseDifference(array,values,iteratee,comparator){var index=-1,includes=arrayIncludes,isCommon=true,length=array.length,result=[],valuesLength=values.length;if(!length){return result}if(iteratee){values=arrayMap(values,baseUnary(iteratee))}if(comparator){includes=arrayIncludesWith;isCommon=false}else if(values.length>=LARGE_ARRAY_SIZE){includes=cacheHas;isCommon=false;values=new SetCache(values)}outer:while(++index<length){var value=array[index],computed=iteratee==null?value:iteratee(value);value=comparator||value!==0?value:0;if(isCommon&&computed===computed){var valuesIndex=valuesLength;while(valuesIndex--){if(values[valuesIndex]===computed){continue outer}}result.push(value)}else if(!includes(values,computed,comparator)){result.push(value)}}return result}var baseEach=createBaseEach(baseForOwn);var baseEachRight=createBaseEach(baseForOwnRight,true);function baseEvery(collection,predicate){var result=true;baseEach(collection,function(value,index,collection){result=!!predicate(value,index,collection);return result});return result}function baseExtremum(array,iteratee,comparator){var index=-1,length=array.length;while(++index<length){var value=array[index],current=iteratee(value);if(current!=null&&(computed===undefined?current===current&&!isSymbol(current):comparator(current,computed))){var computed=current,result=value}}return result}function baseFill(array,value,start,end){var length=array.length;start=toInteger(start);if(start<0){start=-start>length?0:length+start}end=end===undefined||end>length?length:toInteger(end);if(end<0){end+=length}end=start>end?0:toLength(end);while(start<end){array[start++]=value}return array}function baseFilter(collection,predicate){var result=[];baseEach(collection,function(value,index,collection){if(predicate(value,index,collection)){result.push(value)}});return result}function baseFlatten(array,depth,predicate,isStrict,result){var index=-1,length=array.length;predicate||(predicate=isFlattenable);result||(result=[]);while(++index<length){var value=array[index];if(depth>0&&predicate(value)){if(depth>1){baseFlatten(value,depth-1,predicate,isStrict,result)}else{arrayPush(result,value)}}else if(!isStrict){result[result.length]=value}}return result}var baseFor=createBaseFor();var baseForRight=createBaseFor(true);function baseForOwn(object,iteratee){return object&&baseFor(object,iteratee,keys)}function baseForOwnRight(object,iteratee){return object&&baseForRight(object,iteratee,keys)}function baseFunctions(object,props){return arrayFilter(props,function(key){return isFunction(object[key])})}function baseGet(object,path){path=castPath(path,object);var index=0,length=path.length;while(object!=null&&index<length){object=object[toKey(path[index++])]}return index&&index==length?object:undefined}function baseGetAllKeys(object,keysFunc,symbolsFunc){var result=keysFunc(object);return isArray(object)?result:arrayPush(result,symbolsFunc(object))}function baseGetTag(value){if(value==null){return value===undefined?undefinedTag:nullTag}return symToStringTag&&symToStringTag in Object(value)?getRawTag(value):objectToString(value)}function baseGt(value,other){return value>other}function baseHas(object,key){return object!=null&&hasOwnProperty.call(object,key)}function baseHasIn(object,key){return object!=null&&key in Object(object)}function baseInRange(number,start,end){return number>=nativeMin(start,end)&&number<nativeMax(start,end)}function baseIntersection(arrays,iteratee,comparator){var includes=comparator?arrayIncludesWith:arrayIncludes,length=arrays[0].length,othLength=arrays.length,othIndex=othLength,caches=Array(othLength),maxLength=Infinity,result=[];while(othIndex--){var array=arrays[othIndex];if(othIndex&&iteratee){array=arrayMap(array,baseUnary(iteratee))}maxLength=nativeMin(array.length,maxLength);caches[othIndex]=!comparator&&(iteratee||length>=120&&array.length>=120)?new SetCache(othIndex&&array):undefined}array=arrays[0];var index=-1,seen=caches[0];outer:while(++index<length&&result.length<maxLength){var value=array[index],computed=iteratee?iteratee(value):value;value=comparator||value!==0?value:0;if(!(seen?cacheHas(seen,computed):includes(result,computed,comparator))){othIndex=othLength;while(--othIndex){var cache=caches[othIndex];if(!(cache?cacheHas(cache,computed):includes(arrays[othIndex],computed,comparator))){continue outer}}if(seen){seen.push(computed)}result.push(value)}}return result}function baseInverter(object,setter,iteratee,accumulator){baseForOwn(object,function(value,key,object){setter(accumulator,iteratee(value),key,object)});return accumulator}function baseInvoke(object,path,args){path=castPath(path,object);object=parent(object,path);var func=object==null?object:object[toKey(last(path))];return func==null?undefined:apply(func,object,args)}function baseIsArguments(value){return isObjectLike(value)&&baseGetTag(value)==argsTag}function baseIsArrayBuffer(value){return isObjectLike(value)&&baseGetTag(value)==arrayBufferTag}function baseIsDate(value){return isObjectLike(value)&&baseGetTag(value)==dateTag}function baseIsEqual(value,other,bitmask,customizer,stack){if(value===other){return true}if(value==null||other==null||!isObjectLike(value)&&!isObjectLike(other)){return value!==value&&other!==other}return baseIsEqualDeep(value,other,bitmask,customizer,baseIsEqual,stack)}function baseIsEqualDeep(object,other,bitmask,customizer,equalFunc,stack){var objIsArr=isArray(object),othIsArr=isArray(other),objTag=objIsArr?arrayTag:getTag(object),othTag=othIsArr?arrayTag:getTag(other);objTag=objTag==argsTag?objectTag:objTag;othTag=othTag==argsTag?objectTag:othTag;var objIsObj=objTag==objectTag,othIsObj=othTag==objectTag,isSameTag=objTag==othTag;if(isSameTag&&isBuffer(object)){if(!isBuffer(other)){return false}objIsArr=true;objIsObj=false}if(isSameTag&&!objIsObj){stack||(stack=new Stack);return objIsArr||isTypedArray(object)?equalArrays(object,other,bitmask,customizer,equalFunc,stack):equalByTag(object,other,objTag,bitmask,customizer,equalFunc,stack)}if(!(bitmask&COMPARE_PARTIAL_FLAG)){var objIsWrapped=objIsObj&&hasOwnProperty.call(object,"__wrapped__"),othIsWrapped=othIsObj&&hasOwnProperty.call(other,"__wrapped__");if(objIsWrapped||othIsWrapped){var objUnwrapped=objIsWrapped?object.value():object,othUnwrapped=othIsWrapped?other.value():other;stack||(stack=new Stack);return equalFunc(objUnwrapped,othUnwrapped,bitmask,customizer,stack)}}if(!isSameTag){return false}stack||(stack=new Stack);return equalObjects(object,other,bitmask,customizer,equalFunc,stack)}function baseIsMap(value){return isObjectLike(value)&&getTag(value)==mapTag}function baseIsMatch(object,source,matchData,customizer){var index=matchData.length,length=index,noCustomizer=!customizer;if(object==null){return!length}object=Object(object);while(index--){var data=matchData[index];if(noCustomizer&&data[2]?data[1]!==object[data[0]]:!(data[0]in object)){return false}}while(++index<length){data=matchData[index];var key=data[0],objValue=object[key],srcValue=data[1];if(noCustomizer&&data[2]){if(objValue===undefined&&!(key in object)){return false}}else{var stack=new Stack;if(customizer){var result=customizer(objValue,srcValue,key,object,source,stack)}if(!(result===undefined?baseIsEqual(srcValue,objValue,COMPARE_PARTIAL_FLAG|COMPARE_UNORDERED_FLAG,customizer,stack):result)){return false}}}return true}function baseIsNative(value){if(!isObject(value)||isMasked(value)){return false}var pattern=isFunction(value)?reIsNative:reIsHostCtor;return pattern.test(toSource(value))}function baseIsRegExp(value){return isObjectLike(value)&&baseGetTag(value)==regexpTag}function baseIsSet(value){return isObjectLike(value)&&getTag(value)==setTag}function baseIsTypedArray(value){return isObjectLike(value)&&isLength(value.length)&&!!typedArrayTags[baseGetTag(value)]}function baseIteratee(value){if(typeof value=="function"){return value}if(value==null){return identity}if(typeof value=="object"){return isArray(value)?baseMatchesProperty(value[0],value[1]):baseMatches(value)}return property(value)}function baseKeys(object){if(!isPrototype(object)){return nativeKeys(object)}var result=[];for(var key in Object(object)){if(hasOwnProperty.call(object,key)&&key!="constructor"){result.push(key)}}return result}function baseKeysIn(object){if(!isObject(object)){return nativeKeysIn(object)}var isProto=isPrototype(object),result=[];for(var key in object){if(!(key=="constructor"&&(isProto||!hasOwnProperty.call(object,key)))){result.push(key)}}return result}function baseLt(value,other){return value<other}function baseMap(collection,iteratee){var index=-1,result=isArrayLike(collection)?Array(collection.length):[];baseEach(collection,function(value,key,collection){result[++index]=iteratee(value,key,collection)});return result}function baseMatches(source){var matchData=getMatchData(source);if(matchData.length==1&&matchData[0][2]){return matchesStrictComparable(matchData[0][0],matchData[0][1])}return function(object){return object===source||baseIsMatch(object,source,matchData)}}function baseMatchesProperty(path,srcValue){if(isKey(path)&&isStrictComparable(srcValue)){return matchesStrictComparable(toKey(path),srcValue)}return function(object){var objValue=get(object,path);return objValue===undefined&&objValue===srcValue?hasIn(object,path):baseIsEqual(srcValue,objValue,COMPARE_PARTIAL_FLAG|COMPARE_UNORDERED_FLAG)}}function baseMerge(object,source,srcIndex,customizer,stack){if(object===source){return}baseFor(source,function(srcValue,key){if(isObject(srcValue)){stack||(stack=new Stack);baseMergeDeep(object,source,key,srcIndex,baseMerge,customizer,stack)}else{var newValue=customizer?customizer(object[key],srcValue,key+"",object,source,stack):undefined;if(newValue===undefined){newValue=srcValue}assignMergeValue(object,key,newValue)}},keysIn)}function baseMergeDeep(object,source,key,srcIndex,mergeFunc,customizer,stack){var objValue=object[key],srcValue=source[key],stacked=stack.get(srcValue);if(stacked){assignMergeValue(object,key,stacked);return}var newValue=customizer?customizer(objValue,srcValue,key+"",object,source,stack):undefined;var isCommon=newValue===undefined;if(isCommon){var isArr=isArray(srcValue),isBuff=!isArr&&isBuffer(srcValue),isTyped=!isArr&&!isBuff&&isTypedArray(srcValue);newValue=srcValue;if(isArr||isBuff||isTyped){if(isArray(objValue)){newValue=objValue}else if(isArrayLikeObject(objValue)){newValue=copyArray(objValue)}else if(isBuff){isCommon=false;newValue=cloneBuffer(srcValue,true)}else if(isTyped){isCommon=false;newValue=cloneTypedArray(srcValue,true)}else{newValue=[]}}else if(isPlainObject(srcValue)||isArguments(srcValue)){newValue=objValue;if(isArguments(objValue)){newValue=toPlainObject(objValue)}else if(!isObject(objValue)||srcIndex&&isFunction(objValue)){newValue=initCloneObject(srcValue)}}else{isCommon=false}}if(isCommon){stack.set(srcValue,newValue);mergeFunc(newValue,srcValue,srcIndex,customizer,stack);stack["delete"](srcValue)}assignMergeValue(object,key,newValue)}function baseNth(array,n){var length=array.length;if(!length){return}n+=n<0?length:0;return isIndex(n,length)?array[n]:undefined}function baseOrderBy(collection,iteratees,orders){var index=-1;iteratees=arrayMap(iteratees.length?iteratees:[identity],baseUnary(getIteratee()));var result=baseMap(collection,function(value,key,collection){var criteria=arrayMap(iteratees,function(iteratee){return iteratee(value)});return{criteria:criteria,index:++index,value:value}});return baseSortBy(result,function(object,other){return compareMultiple(object,other,orders)})}function basePick(object,paths){return basePickBy(object,paths,function(value,path){return hasIn(object,path)})}function basePickBy(object,paths,predicate){var index=-1,length=paths.length,result={};while(++index<length){var path=paths[index],value=baseGet(object,path);if(predicate(value,path)){baseSet(result,castPath(path,object),value)}}return result}function basePropertyDeep(path){return function(object){return baseGet(object,path)}}function basePullAll(array,values,iteratee,comparator){var indexOf=comparator?baseIndexOfWith:baseIndexOf,index=-1,length=values.length,seen=array;if(array===values){values=copyArray(values)}if(iteratee){seen=arrayMap(array,baseUnary(iteratee))}while(++index<length){var fromIndex=0,value=values[index],computed=iteratee?iteratee(value):value;while((fromIndex=indexOf(seen,computed,fromIndex,comparator))>-1){if(seen!==array){splice.call(seen,fromIndex,1)}splice.call(array,fromIndex,1)}}return array}function basePullAt(array,indexes){var length=array?indexes.length:0,lastIndex=length-1;while(length--){var index=indexes[length];if(length==lastIndex||index!==previous){var previous=index;if(isIndex(index)){splice.call(array,index,1)}else{baseUnset(array,index)}}}return array}function baseRandom(lower,upper){return lower+nativeFloor(nativeRandom()*(upper-lower+1))}function baseRange(start,end,step,fromRight){var index=-1,length=nativeMax(nativeCeil((end-start)/(step||1)),0),result=Array(length);while(length--){result[fromRight?length:++index]=start;start+=step}return result}function baseRepeat(string,n){var result="";if(!string||n<1||n>MAX_SAFE_INTEGER){return result}do{if(n%2){result+=string}n=nativeFloor(n/2);if(n){string+=string}}while(n);return result}function baseRest(func,start){return setToString(overRest(func,start,identity),func+"")}function baseSample(collection){return arraySample(values(collection))}function baseSampleSize(collection,n){var array=values(collection);return shuffleSelf(array,baseClamp(n,0,array.length))}function baseSet(object,path,value,customizer){if(!isObject(object)){return object}path=castPath(path,object);var index=-1,length=path.length,lastIndex=length-1,nested=object;while(nested!=null&&++index<length){var key=toKey(path[index]),newValue=value;if(index!=lastIndex){var objValue=nested[key];newValue=customizer?customizer(objValue,key,nested):undefined;if(newValue===undefined){newValue=isObject(objValue)?objValue:isIndex(path[index+1])?[]:{}}}assignValue(nested,key,newValue);nested=nested[key]}return object}var baseSetData=!metaMap?identity:function(func,data){metaMap.set(func,data);return func};var baseSetToString=!defineProperty?identity:function(func,string){return defineProperty(func,"toString",{configurable:true,enumerable:false,value:constant(string),writable:true})};function baseShuffle(collection){return shuffleSelf(values(collection))}function baseSlice(array,start,end){var index=-1,length=array.length;if(start<0){start=-start>length?0:length+start}end=end>length?length:end;if(end<0){end+=length}length=start>end?0:end-start>>>0;start>>>=0;var result=Array(length);while(++index<length){result[index]=array[index+start]}return result}function baseSome(collection,predicate){var result;baseEach(collection,function(value,index,collection){result=predicate(value,index,collection);return!result});return!!result}function baseSortedIndex(array,value,retHighest){var low=0,high=array==null?low:array.length;if(typeof value=="number"&&value===value&&high<=HALF_MAX_ARRAY_LENGTH){while(low<high){var mid=low+high>>>1,computed=array[mid];if(computed!==null&&!isSymbol(computed)&&(retHighest?computed<=value:computed<value)){low=mid+1}else{high=mid}}return high}return baseSortedIndexBy(array,value,identity,retHighest)}function baseSortedIndexBy(array,value,iteratee,retHighest){value=iteratee(value);var low=0,high=array==null?0:array.length,valIsNaN=value!==value,valIsNull=value===null,valIsSymbol=isSymbol(value),valIsUndefined=value===undefined;while(low<high){var mid=nativeFloor((low+high)/2),computed=iteratee(array[mid]),othIsDefined=computed!==undefined,othIsNull=computed===null,othIsReflexive=computed===computed,othIsSymbol=isSymbol(computed);if(valIsNaN){var setLow=retHighest||othIsReflexive}else if(valIsUndefined){setLow=othIsReflexive&&(retHighest||othIsDefined)}else if(valIsNull){setLow=othIsReflexive&&othIsDefined&&(retHighest||!othIsNull)}else if(valIsSymbol){setLow=othIsReflexive&&othIsDefined&&!othIsNull&&(retHighest||!othIsSymbol)}else if(othIsNull||othIsSymbol){setLow=false}else{setLow=retHighest?computed<=value:computed<value}if(setLow){low=mid+1}else{high=mid}}return nativeMin(high,MAX_ARRAY_INDEX)}function baseSortedUniq(array,iteratee){var index=-1,length=array.length,resIndex=0,result=[];while(++index<length){var value=array[index],computed=iteratee?iteratee(value):value;if(!index||!eq(computed,seen)){var seen=computed;result[resIndex++]=value===0?0:value}}return result}function baseToNumber(value){if(typeof value=="number"){return value}if(isSymbol(value)){return NAN}return+value}function baseToString(value){if(typeof value=="string"){return value}if(isArray(value)){return arrayMap(value,baseToString)+""}if(isSymbol(value)){return symbolToString?symbolToString.call(value):""}var result=value+"";return result=="0"&&1/value==-INFINITY?"-0":result}function baseUniq(array,iteratee,comparator){var index=-1,includes=arrayIncludes,length=array.length,isCommon=true,result=[],seen=result;if(comparator){isCommon=false;includes=arrayIncludesWith}else if(length>=LARGE_ARRAY_SIZE){var set=iteratee?null:createSet(array);if(set){return setToArray(set)}isCommon=false;includes=cacheHas;seen=new SetCache}else{seen=iteratee?[]:result}outer:while(++index<length){var value=array[index],computed=iteratee?iteratee(value):value;value=comparator||value!==0?value:0;if(isCommon&&computed===computed){var seenIndex=seen.length;while(seenIndex--){if(seen[seenIndex]===computed){continue outer}}if(iteratee){seen.push(computed)}result.push(value)}else if(!includes(seen,computed,comparator)){if(seen!==result){seen.push(computed)}result.push(value)}}return result}function baseUnset(object,path){path=castPath(path,object);object=parent(object,path);return object==null||delete object[toKey(last(path))]}function baseUpdate(object,path,updater,customizer){return baseSet(object,path,updater(baseGet(object,path)),customizer)}function baseWhile(array,predicate,isDrop,fromRight){var length=array.length,index=fromRight?length:-1;while((fromRight?index--:++index<length)&&predicate(array[index],index,array)){}return isDrop?baseSlice(array,fromRight?0:index,fromRight?index+1:length):baseSlice(array,fromRight?index+1:0,fromRight?length:index)}function baseWrapperValue(value,actions){var result=value;if(result instanceof LazyWrapper){result=result.value()}return arrayReduce(actions,function(result,action){return action.func.apply(action.thisArg,arrayPush([result],action.args))},result)}function baseXor(arrays,iteratee,comparator){var length=arrays.length;if(length<2){return length?baseUniq(arrays[0]):[]}var index=-1,result=Array(length);while(++index<length){var array=arrays[index],othIndex=-1;while(++othIndex<length){if(othIndex!=index){result[index]=baseDifference(result[index]||array,arrays[othIndex],iteratee,comparator)}}}return baseUniq(baseFlatten(result,1),iteratee,comparator)}function baseZipObject(props,values,assignFunc){var index=-1,length=props.length,valsLength=values.length,result={};while(++index<length){var value=index<valsLength?values[index]:undefined;assignFunc(result,props[index],value)}return result}function castArrayLikeObject(value){return isArrayLikeObject(value)?value:[]}function castFunction(value){return typeof value=="function"?value:identity}function castPath(value,object){if(isArray(value)){return value}return isKey(value,object)?[value]:stringToPath(toString(value))}var castRest=baseRest;function castSlice(array,start,end){var length=array.length;end=end===undefined?length:end;return!start&&end>=length?array:baseSlice(array,start,end)}var clearTimeout=ctxClearTimeout||function(id){return root.clearTimeout(id)};function cloneBuffer(buffer,isDeep){if(isDeep){return buffer.slice()}var length=buffer.length,result=allocUnsafe?allocUnsafe(length):new buffer.constructor(length);buffer.copy(result);return result}function cloneArrayBuffer(arrayBuffer){var result=new arrayBuffer.constructor(arrayBuffer.byteLength);new Uint8Array(result).set(new Uint8Array(arrayBuffer));return result}function cloneDataView(dataView,isDeep){var buffer=isDeep?cloneArrayBuffer(dataView.buffer):dataView.buffer;return new dataView.constructor(buffer,dataView.byteOffset,dataView.byteLength)}function cloneMap(map,isDeep,cloneFunc){var array=isDeep?cloneFunc(mapToArray(map),CLONE_DEEP_FLAG):mapToArray(map);return arrayReduce(array,addMapEntry,new map.constructor)}function cloneRegExp(regexp){var result=new regexp.constructor(regexp.source,reFlags.exec(regexp));result.lastIndex=regexp.lastIndex;return result}function cloneSet(set,isDeep,cloneFunc){var array=isDeep?cloneFunc(setToArray(set),CLONE_DEEP_FLAG):setToArray(set);return arrayReduce(array,addSetEntry,new set.constructor)}function cloneSymbol(symbol){return symbolValueOf?Object(symbolValueOf.call(symbol)):{}}function cloneTypedArray(typedArray,isDeep){var buffer=isDeep?cloneArrayBuffer(typedArray.buffer):typedArray.buffer;return new typedArray.constructor(buffer,typedArray.byteOffset,typedArray.length)}function compareAscending(value,other){if(value!==other){var valIsDefined=value!==undefined,valIsNull=value===null,valIsReflexive=value===value,valIsSymbol=isSymbol(value);var othIsDefined=other!==undefined,othIsNull=other===null,othIsReflexive=other===other,othIsSymbol=isSymbol(other);if(!othIsNull&&!othIsSymbol&&!valIsSymbol&&value>other||valIsSymbol&&othIsDefined&&othIsReflexive&&!othIsNull&&!othIsSymbol||valIsNull&&othIsDefined&&othIsReflexive||!valIsDefined&&othIsReflexive||!valIsReflexive){return 1}if(!valIsNull&&!valIsSymbol&&!othIsSymbol&&value<other||othIsSymbol&&valIsDefined&&valIsReflexive&&!valIsNull&&!valIsSymbol||othIsNull&&valIsDefined&&valIsReflexive||!othIsDefined&&valIsReflexive||!othIsReflexive){return-1}}return 0}function compareMultiple(object,other,orders){var index=-1,objCriteria=object.criteria,othCriteria=other.criteria,length=objCriteria.length,ordersLength=orders.length;while(++index<length){var result=compareAscending(objCriteria[index],othCriteria[index]);if(result){if(index>=ordersLength){return result}var order=orders[index];return result*(order=="desc"?-1:1)}}return object.index-other.index}function composeArgs(args,partials,holders,isCurried){var argsIndex=-1,argsLength=args.length,holdersLength=holders.length,leftIndex=-1,leftLength=partials.length,rangeLength=nativeMax(argsLength-holdersLength,0),result=Array(leftLength+rangeLength),isUncurried=!isCurried;while(++leftIndex<leftLength){result[leftIndex]=partials[leftIndex]}while(++argsIndex<holdersLength){if(isUncurried||argsIndex<argsLength){result[holders[argsIndex]]=args[argsIndex]}}while(rangeLength--){result[leftIndex++]=args[argsIndex++]}return result}function composeArgsRight(args,partials,holders,isCurried){var argsIndex=-1,argsLength=args.length,holdersIndex=-1,holdersLength=holders.length,rightIndex=-1,rightLength=partials.length,rangeLength=nativeMax(argsLength-holdersLength,0),result=Array(rangeLength+rightLength),isUncurried=!isCurried;while(++argsIndex<rangeLength){result[argsIndex]=args[argsIndex]}var offset=argsIndex;while(++rightIndex<rightLength){result[offset+rightIndex]=partials[rightIndex]}while(++holdersIndex<holdersLength){if(isUncurried||argsIndex<argsLength){result[offset+holders[holdersIndex]]=args[argsIndex++]}}return result}function copyArray(source,array){var index=-1,length=source.length;array||(array=Array(length));while(++index<length){array[index]=source[index]}return array}function copyObject(source,props,object,customizer){var isNew=!object;object||(object={});var index=-1,length=props.length;while(++index<length){var key=props[index];var newValue=customizer?customizer(object[key],source[key],key,object,source):undefined;if(newValue===undefined){newValue=source[key]}if(isNew){baseAssignValue(object,key,newValue)}else{assignValue(object,key,newValue)}}return object}function copySymbols(source,object){return copyObject(source,getSymbols(source),object)}function copySymbolsIn(source,object){return copyObject(source,getSymbolsIn(source),object)}function createAggregator(setter,initializer){return function(collection,iteratee){var func=isArray(collection)?arrayAggregator:baseAggregator,accumulator=initializer?initializer():{};return func(collection,setter,getIteratee(iteratee,2),accumulator)}}function createAssigner(assigner){return baseRest(function(object,sources){var index=-1,length=sources.length,customizer=length>1?sources[length-1]:undefined,guard=length>2?sources[2]:undefined;customizer=assigner.length>3&&typeof customizer=="function"?(length--,customizer):undefined;if(guard&&isIterateeCall(sources[0],sources[1],guard)){customizer=length<3?undefined:customizer;length=1}object=Object(object);while(++index<length){var source=sources[index];if(source){assigner(object,source,index,customizer)}}return object})}function createBaseEach(eachFunc,fromRight){return function(collection,iteratee){if(collection==null){return collection}if(!isArrayLike(collection)){return eachFunc(collection,iteratee)}var length=collection.length,index=fromRight?length:-1,iterable=Object(collection);while(fromRight?index--:++index<length){if(iteratee(iterable[index],index,iterable)===false){break}}return collection}}function createBaseFor(fromRight){return function(object,iteratee,keysFunc){var index=-1,iterable=Object(object),props=keysFunc(object),length=props.length;while(length--){var key=props[fromRight?length:++index];if(iteratee(iterable[key],key,iterable)===false){break}}return object}}function createBind(func,bitmask,thisArg){var isBind=bitmask&WRAP_BIND_FLAG,Ctor=createCtor(func);function wrapper(){var fn=this&&this!==root&&this instanceof wrapper?Ctor:func;return fn.apply(isBind?thisArg:this,arguments)}return wrapper}function createCaseFirst(methodName){return function(string){string=toString(string);var strSymbols=hasUnicode(string)?stringToArray(string):undefined;var chr=strSymbols?strSymbols[0]:string.charAt(0);var trailing=strSymbols?castSlice(strSymbols,1).join(""):string.slice(1);return chr[methodName]()+trailing}}function createCompounder(callback){return function(string){return arrayReduce(words(deburr(string).replace(reApos,"")),callback,"")}}function createCtor(Ctor){return function(){var args=arguments;switch(args.length){case 0:return new Ctor;case 1:return new Ctor(args[0]);case 2:return new Ctor(args[0],args[1]);case 3:return new Ctor(args[0],args[1],args[2]);case 4:return new Ctor(args[0],args[1],args[2],args[3]);case 5:return new Ctor(args[0],args[1],args[2],args[3],args[4]);case 6:return new Ctor(args[0],args[1],args[2],args[3],args[4],args[5]);case 7:return new Ctor(args[0],args[1],args[2],args[3],args[4],args[5],args[6])}var thisBinding=baseCreate(Ctor.prototype),result=Ctor.apply(thisBinding,args);return isObject(result)?result:thisBinding}}function createCurry(func,bitmask,arity){var Ctor=createCtor(func);function wrapper(){var length=arguments.length,args=Array(length),index=length,placeholder=getHolder(wrapper);while(index--){args[index]=arguments[index]}var holders=length<3&&args[0]!==placeholder&&args[length-1]!==placeholder?[]:replaceHolders(args,placeholder);length-=holders.length;if(length<arity){return createRecurry(func,bitmask,createHybrid,wrapper.placeholder,undefined,args,holders,undefined,undefined,arity-length)}var fn=this&&this!==root&&this instanceof wrapper?Ctor:func;return apply(fn,this,args)}return wrapper}function createFind(findIndexFunc){return function(collection,predicate,fromIndex){var iterable=Object(collection);if(!isArrayLike(collection)){var iteratee=getIteratee(predicate,3);collection=keys(collection);predicate=function(key){return iteratee(iterable[key],key,iterable)}}var index=findIndexFunc(collection,predicate,fromIndex);return index>-1?iterable[iteratee?collection[index]:index]:undefined}}function createFlow(fromRight){return flatRest(function(funcs){var length=funcs.length,index=length,prereq=LodashWrapper.prototype.thru;if(fromRight){funcs.reverse()}while(index--){var func=funcs[index];if(typeof func!="function"){throw new TypeError(FUNC_ERROR_TEXT)}if(prereq&&!wrapper&&getFuncName(func)=="wrapper"){var wrapper=new LodashWrapper([],true)}}index=wrapper?index:length;while(++index<length){func=funcs[index];var funcName=getFuncName(func),data=funcName=="wrapper"?getData(func):undefined;if(data&&isLaziable(data[0])&&data[1]==(WRAP_ARY_FLAG|WRAP_CURRY_FLAG|WRAP_PARTIAL_FLAG|WRAP_REARG_FLAG)&&!data[4].length&&data[9]==1){wrapper=wrapper[getFuncName(data[0])].apply(wrapper,data[3])}else{wrapper=func.length==1&&isLaziable(func)?wrapper[funcName]():wrapper.thru(func)}}return function(){var args=arguments,value=args[0];if(wrapper&&args.length==1&&isArray(value)){return wrapper.plant(value).value()}var index=0,result=length?funcs[index].apply(this,args):value;while(++index<length){result=funcs[index].call(this,result)}return result}})}function createHybrid(func,bitmask,thisArg,partials,holders,partialsRight,holdersRight,argPos,ary,arity){var isAry=bitmask&WRAP_ARY_FLAG,isBind=bitmask&WRAP_BIND_FLAG,isBindKey=bitmask&WRAP_BIND_KEY_FLAG,isCurried=bitmask&(WRAP_CURRY_FLAG|WRAP_CURRY_RIGHT_FLAG),isFlip=bitmask&WRAP_FLIP_FLAG,Ctor=isBindKey?undefined:createCtor(func);function wrapper(){var length=arguments.length,args=Array(length),index=length;while(index--){args[index]=arguments[index]}if(isCurried){var placeholder=getHolder(wrapper),holdersCount=countHolders(args,placeholder)}if(partials){args=composeArgs(args,partials,holders,isCurried)}if(partialsRight){args=composeArgsRight(args,partialsRight,holdersRight,isCurried)}length-=holdersCount;if(isCurried&&length<arity){var newHolders=replaceHolders(args,placeholder);return createRecurry(func,bitmask,createHybrid,wrapper.placeholder,thisArg,args,newHolders,argPos,ary,arity-length)}var thisBinding=isBind?thisArg:this,fn=isBindKey?thisBinding[func]:func;length=args.length;if(argPos){args=reorder(args,argPos)}else if(isFlip&&length>1){args.reverse()}if(isAry&&ary<length){args.length=ary}if(this&&this!==root&&this instanceof wrapper){fn=Ctor||createCtor(fn)}return fn.apply(thisBinding,args)}return wrapper}function createInverter(setter,toIteratee){return function(object,iteratee){return baseInverter(object,setter,toIteratee(iteratee),{})}}function createMathOperation(operator,defaultValue){return function(value,other){var result;if(value===undefined&&other===undefined){return defaultValue}if(value!==undefined){result=value}if(other!==undefined){if(result===undefined){return other}if(typeof value=="string"||typeof other=="string"){value=baseToString(value);other=baseToString(other)}else{value=baseToNumber(value);other=baseToNumber(other)}result=operator(value,other)}return result}}function createOver(arrayFunc){return flatRest(function(iteratees){iteratees=arrayMap(iteratees,baseUnary(getIteratee()));return baseRest(function(args){var thisArg=this;return arrayFunc(iteratees,function(iteratee){return apply(iteratee,thisArg,args)})})})}function createPadding(length,chars){chars=chars===undefined?" ":baseToString(chars);var charsLength=chars.length;if(charsLength<2){return charsLength?baseRepeat(chars,length):chars}var result=baseRepeat(chars,nativeCeil(length/stringSize(chars)));return hasUnicode(chars)?castSlice(stringToArray(result),0,length).join(""):result.slice(0,length)}function createPartial(func,bitmask,thisArg,partials){var isBind=bitmask&WRAP_BIND_FLAG,Ctor=createCtor(func);function wrapper(){var argsIndex=-1,argsLength=arguments.length,leftIndex=-1,leftLength=partials.length,args=Array(leftLength+argsLength),fn=this&&this!==root&&this instanceof wrapper?Ctor:func;

while(++leftIndex<leftLength){args[leftIndex]=partials[leftIndex]}while(argsLength--){args[leftIndex++]=arguments[++argsIndex]}return apply(fn,isBind?thisArg:this,args)}return wrapper}function createRange(fromRight){return function(start,end,step){if(step&&typeof step!="number"&&isIterateeCall(start,end,step)){end=step=undefined}start=toFinite(start);if(end===undefined){end=start;start=0}else{end=toFinite(end)}step=step===undefined?start<end?1:-1:toFinite(step);return baseRange(start,end,step,fromRight)}}function createRelationalOperation(operator){return function(value,other){if(!(typeof value=="string"&&typeof other=="string")){value=toNumber(value);other=toNumber(other)}return operator(value,other)}}function createRecurry(func,bitmask,wrapFunc,placeholder,thisArg,partials,holders,argPos,ary,arity){var isCurry=bitmask&WRAP_CURRY_FLAG,newHolders=isCurry?holders:undefined,newHoldersRight=isCurry?undefined:holders,newPartials=isCurry?partials:undefined,newPartialsRight=isCurry?undefined:partials;bitmask|=isCurry?WRAP_PARTIAL_FLAG:WRAP_PARTIAL_RIGHT_FLAG;bitmask&=~(isCurry?WRAP_PARTIAL_RIGHT_FLAG:WRAP_PARTIAL_FLAG);if(!(bitmask&WRAP_CURRY_BOUND_FLAG)){bitmask&=~(WRAP_BIND_FLAG|WRAP_BIND_KEY_FLAG)}var newData=[func,bitmask,thisArg,newPartials,newHolders,newPartialsRight,newHoldersRight,argPos,ary,arity];var result=wrapFunc.apply(undefined,newData);if(isLaziable(func)){setData(result,newData)}result.placeholder=placeholder;return setWrapToString(result,func,bitmask)}function createRound(methodName){var func=Math[methodName];return function(number,precision){number=toNumber(number);precision=precision==null?0:nativeMin(toInteger(precision),292);if(precision){var pair=(toString(number)+"e").split("e"),value=func(pair[0]+"e"+(+pair[1]+precision));pair=(toString(value)+"e").split("e");return+(pair[0]+"e"+(+pair[1]-precision))}return func(number)}}var createSet=!(Set&&1/setToArray(new Set([,-0]))[1]==INFINITY)?noop:function(values){return new Set(values)};function createToPairs(keysFunc){return function(object){var tag=getTag(object);if(tag==mapTag){return mapToArray(object)}if(tag==setTag){return setToPairs(object)}return baseToPairs(object,keysFunc(object))}}function createWrap(func,bitmask,thisArg,partials,holders,argPos,ary,arity){var isBindKey=bitmask&WRAP_BIND_KEY_FLAG;if(!isBindKey&&typeof func!="function"){throw new TypeError(FUNC_ERROR_TEXT)}var length=partials?partials.length:0;if(!length){bitmask&=~(WRAP_PARTIAL_FLAG|WRAP_PARTIAL_RIGHT_FLAG);partials=holders=undefined}ary=ary===undefined?ary:nativeMax(toInteger(ary),0);arity=arity===undefined?arity:toInteger(arity);length-=holders?holders.length:0;if(bitmask&WRAP_PARTIAL_RIGHT_FLAG){var partialsRight=partials,holdersRight=holders;partials=holders=undefined}var data=isBindKey?undefined:getData(func);var newData=[func,bitmask,thisArg,partials,holders,partialsRight,holdersRight,argPos,ary,arity];if(data){mergeData(newData,data)}func=newData[0];bitmask=newData[1];thisArg=newData[2];partials=newData[3];holders=newData[4];arity=newData[9]=newData[9]===undefined?isBindKey?0:func.length:nativeMax(newData[9]-length,0);if(!arity&&bitmask&(WRAP_CURRY_FLAG|WRAP_CURRY_RIGHT_FLAG)){bitmask&=~(WRAP_CURRY_FLAG|WRAP_CURRY_RIGHT_FLAG)}if(!bitmask||bitmask==WRAP_BIND_FLAG){var result=createBind(func,bitmask,thisArg)}else if(bitmask==WRAP_CURRY_FLAG||bitmask==WRAP_CURRY_RIGHT_FLAG){result=createCurry(func,bitmask,arity)}else if((bitmask==WRAP_PARTIAL_FLAG||bitmask==(WRAP_BIND_FLAG|WRAP_PARTIAL_FLAG))&&!holders.length){result=createPartial(func,bitmask,thisArg,partials)}else{result=createHybrid.apply(undefined,newData)}var setter=data?baseSetData:setData;return setWrapToString(setter(result,newData),func,bitmask)}function customDefaultsAssignIn(objValue,srcValue,key,object){if(objValue===undefined||eq(objValue,objectProto[key])&&!hasOwnProperty.call(object,key)){return srcValue}return objValue}function customDefaultsMerge(objValue,srcValue,key,object,source,stack){if(isObject(objValue)&&isObject(srcValue)){stack.set(srcValue,objValue);baseMerge(objValue,srcValue,undefined,customDefaultsMerge,stack);stack["delete"](srcValue)}return objValue}function customOmitClone(value){return isPlainObject(value)?undefined:value}function equalArrays(array,other,bitmask,customizer,equalFunc,stack){var isPartial=bitmask&COMPARE_PARTIAL_FLAG,arrLength=array.length,othLength=other.length;if(arrLength!=othLength&&!(isPartial&&othLength>arrLength)){return false}var stacked=stack.get(array);if(stacked&&stack.get(other)){return stacked==other}var index=-1,result=true,seen=bitmask&COMPARE_UNORDERED_FLAG?new SetCache:undefined;stack.set(array,other);stack.set(other,array);while(++index<arrLength){var arrValue=array[index],othValue=other[index];if(customizer){var compared=isPartial?customizer(othValue,arrValue,index,other,array,stack):customizer(arrValue,othValue,index,array,other,stack)}if(compared!==undefined){if(compared){continue}result=false;break}if(seen){if(!arraySome(other,function(othValue,othIndex){if(!cacheHas(seen,othIndex)&&(arrValue===othValue||equalFunc(arrValue,othValue,bitmask,customizer,stack))){return seen.push(othIndex)}})){result=false;break}}else if(!(arrValue===othValue||equalFunc(arrValue,othValue,bitmask,customizer,stack))){result=false;break}}stack["delete"](array);stack["delete"](other);return result}function equalByTag(object,other,tag,bitmask,customizer,equalFunc,stack){switch(tag){case dataViewTag:if(object.byteLength!=other.byteLength||object.byteOffset!=other.byteOffset){return false}object=object.buffer;other=other.buffer;case arrayBufferTag:if(object.byteLength!=other.byteLength||!equalFunc(new Uint8Array(object),new Uint8Array(other))){return false}return true;case boolTag:case dateTag:case numberTag:return eq(+object,+other);case errorTag:return object.name==other.name&&object.message==other.message;case regexpTag:case stringTag:return object==other+"";case mapTag:var convert=mapToArray;case setTag:var isPartial=bitmask&COMPARE_PARTIAL_FLAG;convert||(convert=setToArray);if(object.size!=other.size&&!isPartial){return false}var stacked=stack.get(object);if(stacked){return stacked==other}bitmask|=COMPARE_UNORDERED_FLAG;stack.set(object,other);var result=equalArrays(convert(object),convert(other),bitmask,customizer,equalFunc,stack);stack["delete"](object);return result;case symbolTag:if(symbolValueOf){return symbolValueOf.call(object)==symbolValueOf.call(other)}}return false}function equalObjects(object,other,bitmask,customizer,equalFunc,stack){var isPartial=bitmask&COMPARE_PARTIAL_FLAG,objProps=getAllKeys(object),objLength=objProps.length,othProps=getAllKeys(other),othLength=othProps.length;if(objLength!=othLength&&!isPartial){return false}var index=objLength;while(index--){var key=objProps[index];if(!(isPartial?key in other:hasOwnProperty.call(other,key))){return false}}var stacked=stack.get(object);if(stacked&&stack.get(other)){return stacked==other}var result=true;stack.set(object,other);stack.set(other,object);var skipCtor=isPartial;while(++index<objLength){key=objProps[index];var objValue=object[key],othValue=other[key];if(customizer){var compared=isPartial?customizer(othValue,objValue,key,other,object,stack):customizer(objValue,othValue,key,object,other,stack)}if(!(compared===undefined?objValue===othValue||equalFunc(objValue,othValue,bitmask,customizer,stack):compared)){result=false;break}skipCtor||(skipCtor=key=="constructor")}if(result&&!skipCtor){var objCtor=object.constructor,othCtor=other.constructor;if(objCtor!=othCtor&&("constructor"in object&&"constructor"in other)&&!(typeof objCtor=="function"&&objCtor instanceof objCtor&&typeof othCtor=="function"&&othCtor instanceof othCtor)){result=false}}stack["delete"](object);stack["delete"](other);return result}function flatRest(func){return setToString(overRest(func,undefined,flatten),func+"")}function getAllKeys(object){return baseGetAllKeys(object,keys,getSymbols)}function getAllKeysIn(object){return baseGetAllKeys(object,keysIn,getSymbolsIn)}var getData=!metaMap?noop:function(func){return metaMap.get(func)};function getFuncName(func){var result=func.name+"",array=realNames[result],length=hasOwnProperty.call(realNames,result)?array.length:0;while(length--){var data=array[length],otherFunc=data.func;if(otherFunc==null||otherFunc==func){return data.name}}return result}function getHolder(func){var object=hasOwnProperty.call(lodash,"placeholder")?lodash:func;return object.placeholder}function getIteratee(){var result=lodash.iteratee||iteratee;result=result===iteratee?baseIteratee:result;return arguments.length?result(arguments[0],arguments[1]):result}function getMapData(map,key){var data=map.__data__;return isKeyable(key)?data[typeof key=="string"?"string":"hash"]:data.map}function getMatchData(object){var result=keys(object),length=result.length;while(length--){var key=result[length],value=object[key];result[length]=[key,value,isStrictComparable(value)]}return result}function getNative(object,key){var value=getValue(object,key);return baseIsNative(value)?value:undefined}function getRawTag(value){var isOwn=hasOwnProperty.call(value,symToStringTag),tag=value[symToStringTag];try{value[symToStringTag]=undefined;var unmasked=true}catch(e){}var result=nativeObjectToString.call(value);if(unmasked){if(isOwn){value[symToStringTag]=tag}else{delete value[symToStringTag]}}return result}var getSymbols=!nativeGetSymbols?stubArray:function(object){if(object==null){return[]}object=Object(object);return arrayFilter(nativeGetSymbols(object),function(symbol){return propertyIsEnumerable.call(object,symbol)})};var getSymbolsIn=!nativeGetSymbols?stubArray:function(object){var result=[];while(object){arrayPush(result,getSymbols(object));object=getPrototype(object)}return result};var getTag=baseGetTag;if(DataView&&getTag(new DataView(new ArrayBuffer(1)))!=dataViewTag||Map&&getTag(new Map)!=mapTag||Promise&&getTag(Promise.resolve())!=promiseTag||Set&&getTag(new Set)!=setTag||WeakMap&&getTag(new WeakMap)!=weakMapTag){getTag=function(value){var result=baseGetTag(value),Ctor=result==objectTag?value.constructor:undefined,ctorString=Ctor?toSource(Ctor):"";if(ctorString){switch(ctorString){case dataViewCtorString:return dataViewTag;case mapCtorString:return mapTag;case promiseCtorString:return promiseTag;case setCtorString:return setTag;case weakMapCtorString:return weakMapTag}}return result}}function getView(start,end,transforms){var index=-1,length=transforms.length;while(++index<length){var data=transforms[index],size=data.size;switch(data.type){case"drop":start+=size;break;case"dropRight":end-=size;break;case"take":end=nativeMin(end,start+size);break;case"takeRight":start=nativeMax(start,end-size);break}}return{start:start,end:end}}function getWrapDetails(source){var match=source.match(reWrapDetails);return match?match[1].split(reSplitDetails):[]}function hasPath(object,path,hasFunc){path=castPath(path,object);var index=-1,length=path.length,result=false;while(++index<length){var key=toKey(path[index]);if(!(result=object!=null&&hasFunc(object,key))){break}object=object[key]}if(result||++index!=length){return result}length=object==null?0:object.length;return!!length&&isLength(length)&&isIndex(key,length)&&(isArray(object)||isArguments(object))}function initCloneArray(array){var length=array.length,result=array.constructor(length);if(length&&typeof array[0]=="string"&&hasOwnProperty.call(array,"index")){result.index=array.index;result.input=array.input}return result}function initCloneObject(object){return typeof object.constructor=="function"&&!isPrototype(object)?baseCreate(getPrototype(object)):{}}function initCloneByTag(object,tag,cloneFunc,isDeep){var Ctor=object.constructor;switch(tag){case arrayBufferTag:return cloneArrayBuffer(object);case boolTag:case dateTag:return new Ctor(+object);case dataViewTag:return cloneDataView(object,isDeep);case float32Tag:case float64Tag:case int8Tag:case int16Tag:case int32Tag:case uint8Tag:case uint8ClampedTag:case uint16Tag:case uint32Tag:return cloneTypedArray(object,isDeep);case mapTag:return cloneMap(object,isDeep,cloneFunc);case numberTag:case stringTag:return new Ctor(object);case regexpTag:return cloneRegExp(object);case setTag:return cloneSet(object,isDeep,cloneFunc);case symbolTag:return cloneSymbol(object)}}function insertWrapDetails(source,details){var length=details.length;if(!length){return source}var lastIndex=length-1;details[lastIndex]=(length>1?"& ":"")+details[lastIndex];details=details.join(length>2?", ":" ");return source.replace(reWrapComment,"{\n/* [wrapped with "+details+"] */\n")}function isFlattenable(value){return isArray(value)||isArguments(value)||!!(spreadableSymbol&&value&&value[spreadableSymbol])}function isIndex(value,length){length=length==null?MAX_SAFE_INTEGER:length;return!!length&&(typeof value=="number"||reIsUint.test(value))&&(value>-1&&value%1==0&&value<length)}function isIterateeCall(value,index,object){if(!isObject(object)){return false}var type=typeof index;if(type=="number"?isArrayLike(object)&&isIndex(index,object.length):type=="string"&&index in object){return eq(object[index],value)}return false}function isKey(value,object){if(isArray(value)){return false}var type=typeof value;if(type=="number"||type=="symbol"||type=="boolean"||value==null||isSymbol(value)){return true}return reIsPlainProp.test(value)||!reIsDeepProp.test(value)||object!=null&&value in Object(object)}function isKeyable(value){var type=typeof value;return type=="string"||type=="number"||type=="symbol"||type=="boolean"?value!=="__proto__":value===null}function isLaziable(func){var funcName=getFuncName(func),other=lodash[funcName];if(typeof other!="function"||!(funcName in LazyWrapper.prototype)){return false}if(func===other){return true}var data=getData(other);return!!data&&func===data[0]}function isMasked(func){return!!maskSrcKey&&maskSrcKey in func}var isMaskable=coreJsData?isFunction:stubFalse;function isPrototype(value){var Ctor=value&&value.constructor,proto=typeof Ctor=="function"&&Ctor.prototype||objectProto;return value===proto}function isStrictComparable(value){return value===value&&!isObject(value)}function matchesStrictComparable(key,srcValue){return function(object){if(object==null){return false}return object[key]===srcValue&&(srcValue!==undefined||key in Object(object))}}function memoizeCapped(func){var result=memoize(func,function(key){if(cache.size===MAX_MEMOIZE_SIZE){cache.clear()}return key});var cache=result.cache;return result}function mergeData(data,source){var bitmask=data[1],srcBitmask=source[1],newBitmask=bitmask|srcBitmask,isCommon=newBitmask<(WRAP_BIND_FLAG|WRAP_BIND_KEY_FLAG|WRAP_ARY_FLAG);var isCombo=srcBitmask==WRAP_ARY_FLAG&&bitmask==WRAP_CURRY_FLAG||srcBitmask==WRAP_ARY_FLAG&&bitmask==WRAP_REARG_FLAG&&data[7].length<=source[8]||srcBitmask==(WRAP_ARY_FLAG|WRAP_REARG_FLAG)&&source[7].length<=source[8]&&bitmask==WRAP_CURRY_FLAG;if(!(isCommon||isCombo)){return data}if(srcBitmask&WRAP_BIND_FLAG){data[2]=source[2];newBitmask|=bitmask&WRAP_BIND_FLAG?0:WRAP_CURRY_BOUND_FLAG}var value=source[3];if(value){var partials=data[3];data[3]=partials?composeArgs(partials,value,source[4]):value;data[4]=partials?replaceHolders(data[3],PLACEHOLDER):source[4]}value=source[5];if(value){partials=data[5];data[5]=partials?composeArgsRight(partials,value,source[6]):value;data[6]=partials?replaceHolders(data[5],PLACEHOLDER):source[6]}value=source[7];if(value){data[7]=value}if(srcBitmask&WRAP_ARY_FLAG){data[8]=data[8]==null?source[8]:nativeMin(data[8],source[8])}if(data[9]==null){data[9]=source[9]}data[0]=source[0];data[1]=newBitmask;return data}function nativeKeysIn(object){var result=[];if(object!=null){for(var key in Object(object)){result.push(key)}}return result}function objectToString(value){return nativeObjectToString.call(value)}function overRest(func,start,transform){start=nativeMax(start===undefined?func.length-1:start,0);return function(){var args=arguments,index=-1,length=nativeMax(args.length-start,0),array=Array(length);while(++index<length){array[index]=args[start+index]}index=-1;var otherArgs=Array(start+1);while(++index<start){otherArgs[index]=args[index]}otherArgs[start]=transform(array);return apply(func,this,otherArgs)}}function parent(object,path){return path.length<2?object:baseGet(object,baseSlice(path,0,-1))}function reorder(array,indexes){var arrLength=array.length,length=nativeMin(indexes.length,arrLength),oldArray=copyArray(array);while(length--){var index=indexes[length];array[length]=isIndex(index,arrLength)?oldArray[index]:undefined}return array}var setData=shortOut(baseSetData);var setTimeout=ctxSetTimeout||function(func,wait){return root.setTimeout(func,wait)};var setToString=shortOut(baseSetToString);function setWrapToString(wrapper,reference,bitmask){var source=reference+"";return setToString(wrapper,insertWrapDetails(source,updateWrapDetails(getWrapDetails(source),bitmask)))}function shortOut(func){var count=0,lastCalled=0;return function(){var stamp=nativeNow(),remaining=HOT_SPAN-(stamp-lastCalled);lastCalled=stamp;if(remaining>0){if(++count>=HOT_COUNT){return arguments[0]}}else{count=0}return func.apply(undefined,arguments)}}function shuffleSelf(array,size){var index=-1,length=array.length,lastIndex=length-1;size=size===undefined?length:size;while(++index<size){var rand=baseRandom(index,lastIndex),value=array[rand];array[rand]=array[index];array[index]=value}array.length=size;return array}var stringToPath=memoizeCapped(function(string){var result=[];if(reLeadingDot.test(string)){result.push("")}string.replace(rePropName,function(match,number,quote,string){result.push(quote?string.replace(reEscapeChar,"$1"):number||match)});return result});function toKey(value){if(typeof value=="string"||isSymbol(value)){return value}var result=value+"";return result=="0"&&1/value==-INFINITY?"-0":result}function toSource(func){if(func!=null){try{return funcToString.call(func)}catch(e){}try{return func+""}catch(e){}}return""}function updateWrapDetails(details,bitmask){arrayEach(wrapFlags,function(pair){var value="_."+pair[0];if(bitmask&pair[1]&&!arrayIncludes(details,value)){details.push(value)}});return details.sort()}function wrapperClone(wrapper){if(wrapper instanceof LazyWrapper){return wrapper.clone()}var result=new LodashWrapper(wrapper.__wrapped__,wrapper.__chain__);result.__actions__=copyArray(wrapper.__actions__);result.__index__=wrapper.__index__;result.__values__=wrapper.__values__;return result}function chunk(array,size,guard){if(guard?isIterateeCall(array,size,guard):size===undefined){size=1}else{size=nativeMax(toInteger(size),0)}var length=array==null?0:array.length;if(!length||size<1){return[]}var index=0,resIndex=0,result=Array(nativeCeil(length/size));while(index<length){result[resIndex++]=baseSlice(array,index,index+=size)}return result}function compact(array){var index=-1,length=array==null?0:array.length,resIndex=0,result=[];while(++index<length){var value=array[index];if(value){result[resIndex++]=value}}return result}function concat(){var length=arguments.length;if(!length){return[]}var args=Array(length-1),array=arguments[0],index=length;while(index--){args[index-1]=arguments[index]}return arrayPush(isArray(array)?copyArray(array):[array],baseFlatten(args,1))}var difference=baseRest(function(array,values){return isArrayLikeObject(array)?baseDifference(array,baseFlatten(values,1,isArrayLikeObject,true)):[]});var differenceBy=baseRest(function(array,values){var iteratee=last(values);if(isArrayLikeObject(iteratee)){iteratee=undefined}return isArrayLikeObject(array)?baseDifference(array,baseFlatten(values,1,isArrayLikeObject,true),getIteratee(iteratee,2)):[]});var differenceWith=baseRest(function(array,values){var comparator=last(values);if(isArrayLikeObject(comparator)){comparator=undefined}return isArrayLikeObject(array)?baseDifference(array,baseFlatten(values,1,isArrayLikeObject,true),undefined,comparator):[]});function drop(array,n,guard){var length=array==null?0:array.length;if(!length){return[]}n=guard||n===undefined?1:toInteger(n);return baseSlice(array,n<0?0:n,length)}function dropRight(array,n,guard){var length=array==null?0:array.length;if(!length){return[]}n=guard||n===undefined?1:toInteger(n);n=length-n;return baseSlice(array,0,n<0?0:n)}function dropRightWhile(array,predicate){return array&&array.length?baseWhile(array,getIteratee(predicate,3),true,true):[]}function dropWhile(array,predicate){return array&&array.length?baseWhile(array,getIteratee(predicate,3),true):[]}function fill(array,value,start,end){var length=array==null?0:array.length;if(!length){return[]}if(start&&typeof start!="number"&&isIterateeCall(array,value,start)){start=0;end=length}return baseFill(array,value,start,end)}function findIndex(array,predicate,fromIndex){var length=array==null?0:array.length;if(!length){return-1}var index=fromIndex==null?0:toInteger(fromIndex);if(index<0){index=nativeMax(length+index,0)}return baseFindIndex(array,getIteratee(predicate,3),index)}function findLastIndex(array,predicate,fromIndex){var length=array==null?0:array.length;if(!length){return-1}var index=length-1;if(fromIndex!==undefined){index=toInteger(fromIndex);index=fromIndex<0?nativeMax(length+index,0):nativeMin(index,length-1)}return baseFindIndex(array,getIteratee(predicate,3),index,true)}function flatten(array){var length=array==null?0:array.length;return length?baseFlatten(array,1):[]}function flattenDeep(array){var length=array==null?0:array.length;return length?baseFlatten(array,INFINITY):[]}function flattenDepth(array,depth){var length=array==null?0:array.length;if(!length){return[]}depth=depth===undefined?1:toInteger(depth);return baseFlatten(array,depth)}function fromPairs(pairs){var index=-1,length=pairs==null?0:pairs.length,result={};while(++index<length){var pair=pairs[index];result[pair[0]]=pair[1]}return result}function head(array){return array&&array.length?array[0]:undefined}function indexOf(array,value,fromIndex){var length=array==null?0:array.length;if(!length){return-1}var index=fromIndex==null?0:toInteger(fromIndex);if(index<0){index=nativeMax(length+index,0)}return baseIndexOf(array,value,index)}function initial(array){var length=array==null?0:array.length;return length?baseSlice(array,0,-1):[]}var intersection=baseRest(function(arrays){var mapped=arrayMap(arrays,castArrayLikeObject);return mapped.length&&mapped[0]===arrays[0]?baseIntersection(mapped):[]});var intersectionBy=baseRest(function(arrays){var iteratee=last(arrays),mapped=arrayMap(arrays,castArrayLikeObject);if(iteratee===last(mapped)){iteratee=undefined}else{mapped.pop()}return mapped.length&&mapped[0]===arrays[0]?baseIntersection(mapped,getIteratee(iteratee,2)):[]});var intersectionWith=baseRest(function(arrays){var comparator=last(arrays),mapped=arrayMap(arrays,castArrayLikeObject);comparator=typeof comparator=="function"?comparator:undefined;if(comparator){mapped.pop()}return mapped.length&&mapped[0]===arrays[0]?baseIntersection(mapped,undefined,comparator):[]});function join(array,separator){return array==null?"":nativeJoin.call(array,separator)}function last(array){var length=array==null?0:array.length;return length?array[length-1]:undefined}function lastIndexOf(array,value,fromIndex){var length=array==null?0:array.length;if(!length){return-1}var index=length;if(fromIndex!==undefined){index=toInteger(fromIndex);index=index<0?nativeMax(length+index,0):nativeMin(index,length-1)}return value===value?strictLastIndexOf(array,value,index):baseFindIndex(array,baseIsNaN,index,true)}function nth(array,n){return array&&array.length?baseNth(array,toInteger(n)):undefined}var pull=baseRest(pullAll);function pullAll(array,values){return array&&array.length&&values&&values.length?basePullAll(array,values):array}function pullAllBy(array,values,iteratee){return array&&array.length&&values&&values.length?basePullAll(array,values,getIteratee(iteratee,2)):array}function pullAllWith(array,values,comparator){return array&&array.length&&values&&values.length?basePullAll(array,values,undefined,comparator):array}var pullAt=flatRest(function(array,indexes){var length=array==null?0:array.length,result=baseAt(array,indexes);basePullAt(array,arrayMap(indexes,function(index){return isIndex(index,length)?+index:index}).sort(compareAscending));return result});function remove(array,predicate){var result=[];if(!(array&&array.length)){return result}var index=-1,indexes=[],length=array.length;predicate=getIteratee(predicate,3);while(++index<length){var value=array[index];if(predicate(value,index,array)){result.push(value);indexes.push(index)}}basePullAt(array,indexes);return result}function reverse(array){return array==null?array:nativeReverse.call(array)}function slice(array,start,end){var length=array==null?0:array.length;if(!length){return[]}if(end&&typeof end!="number"&&isIterateeCall(array,start,end)){start=0;end=length}else{start=start==null?0:toInteger(start);end=end===undefined?length:toInteger(end)}return baseSlice(array,start,end)}function sortedIndex(array,value){return baseSortedIndex(array,value)}function sortedIndexBy(array,value,iteratee){return baseSortedIndexBy(array,value,getIteratee(iteratee,2))}function sortedIndexOf(array,value){var length=array==null?0:array.length;if(length){var index=baseSortedIndex(array,value);if(index<length&&eq(array[index],value)){return index}}return-1}function sortedLastIndex(array,value){return baseSortedIndex(array,value,true)}function sortedLastIndexBy(array,value,iteratee){return baseSortedIndexBy(array,value,getIteratee(iteratee,2),true)}function sortedLastIndexOf(array,value){var length=array==null?0:array.length;if(length){var index=baseSortedIndex(array,value,true)-1;if(eq(array[index],value)){return index}}return-1}function sortedUniq(array){return array&&array.length?baseSortedUniq(array):[]}function sortedUniqBy(array,iteratee){return array&&array.length?baseSortedUniq(array,getIteratee(iteratee,2)):[]}function tail(array){var length=array==null?0:array.length;return length?baseSlice(array,1,length):[]}function take(array,n,guard){if(!(array&&array.length)){return[]}n=guard||n===undefined?1:toInteger(n);return baseSlice(array,0,n<0?0:n)}function takeRight(array,n,guard){var length=array==null?0:array.length;if(!length){return[]}n=guard||n===undefined?1:toInteger(n);n=length-n;return baseSlice(array,n<0?0:n,length)}function takeRightWhile(array,predicate){return array&&array.length?baseWhile(array,getIteratee(predicate,3),false,true):[]}function takeWhile(array,predicate){return array&&array.length?baseWhile(array,getIteratee(predicate,3)):[]}var union=baseRest(function(arrays){return baseUniq(baseFlatten(arrays,1,isArrayLikeObject,true))});var unionBy=baseRest(function(arrays){var iteratee=last(arrays);if(isArrayLikeObject(iteratee)){iteratee=undefined}return baseUniq(baseFlatten(arrays,1,isArrayLikeObject,true),getIteratee(iteratee,2))});var unionWith=baseRest(function(arrays){var comparator=last(arrays);comparator=typeof comparator=="function"?comparator:undefined;return baseUniq(baseFlatten(arrays,1,isArrayLikeObject,true),undefined,comparator)});function uniq(array){return array&&array.length?baseUniq(array):[]}function uniqBy(array,iteratee){return array&&array.length?baseUniq(array,getIteratee(iteratee,2)):[]}function uniqWith(array,comparator){comparator=typeof comparator=="function"?comparator:undefined;return array&&array.length?baseUniq(array,undefined,comparator):[]}function unzip(array){if(!(array&&array.length)){return[]}var length=0;array=arrayFilter(array,function(group){if(isArrayLikeObject(group)){length=nativeMax(group.length,length);return true}});return baseTimes(length,function(index){return arrayMap(array,baseProperty(index))})}function unzipWith(array,iteratee){if(!(array&&array.length)){return[]}var result=unzip(array);if(iteratee==null){return result}return arrayMap(result,function(group){return apply(iteratee,undefined,group)})}var without=baseRest(function(array,values){return isArrayLikeObject(array)?baseDifference(array,values):[]});var xor=baseRest(function(arrays){return baseXor(arrayFilter(arrays,isArrayLikeObject))});var xorBy=baseRest(function(arrays){var iteratee=last(arrays);if(isArrayLikeObject(iteratee)){iteratee=undefined}return baseXor(arrayFilter(arrays,isArrayLikeObject),getIteratee(iteratee,2))});var xorWith=baseRest(function(arrays){var comparator=last(arrays);comparator=typeof comparator=="function"?comparator:undefined;return baseXor(arrayFilter(arrays,isArrayLikeObject),undefined,comparator)});var zip=baseRest(unzip);function zipObject(props,values){return baseZipObject(props||[],values||[],assignValue)}function zipObjectDeep(props,values){return baseZipObject(props||[],values||[],baseSet)}var zipWith=baseRest(function(arrays){var length=arrays.length,iteratee=length>1?arrays[length-1]:undefined;iteratee=typeof iteratee=="function"?(arrays.pop(),iteratee):undefined;return unzipWith(arrays,iteratee)});function chain(value){var result=lodash(value);result.__chain__=true;return result}function tap(value,interceptor){interceptor(value);return value}function thru(value,interceptor){return interceptor(value)}var wrapperAt=flatRest(function(paths){var length=paths.length,start=length?paths[0]:0,value=this.__wrapped__,interceptor=function(object){return baseAt(object,paths)};if(length>1||this.__actions__.length||!(value instanceof LazyWrapper)||!isIndex(start)){return this.thru(interceptor)}value=value.slice(start,+start+(length?1:0));value.__actions__.push({func:thru,args:[interceptor],thisArg:undefined});return new LodashWrapper(value,this.__chain__).thru(function(array){if(length&&!array.length){array.push(undefined)}return array})});function wrapperChain(){return chain(this)}function wrapperCommit(){return new LodashWrapper(this.value(),this.__chain__)}function wrapperNext(){if(this.__values__===undefined){this.__values__=toArray(this.value())}var done=this.__index__>=this.__values__.length,value=done?undefined:this.__values__[this.__index__++];return{done:done,value:value}}function wrapperToIterator(){return this}function wrapperPlant(value){var result,parent=this;while(parent instanceof baseLodash){var clone=wrapperClone(parent);clone.__index__=0;clone.__values__=undefined;if(result){previous.__wrapped__=clone}else{result=clone}var previous=clone;parent=parent.__wrapped__}previous.__wrapped__=value;return result}function wrapperReverse(){var value=this.__wrapped__;if(value instanceof LazyWrapper){var wrapped=value;if(this.__actions__.length){wrapped=new LazyWrapper(this)}wrapped=wrapped.reverse();wrapped.__actions__.push({func:thru,args:[reverse],thisArg:undefined});return new LodashWrapper(wrapped,this.__chain__)}return this.thru(reverse)}function wrapperValue(){return baseWrapperValue(this.__wrapped__,this.__actions__)}var countBy=createAggregator(function(result,value,key){if(hasOwnProperty.call(result,key)){++result[key]}else{baseAssignValue(result,key,1)}});function every(collection,predicate,guard){var func=isArray(collection)?arrayEvery:baseEvery;if(guard&&isIterateeCall(collection,predicate,guard)){predicate=undefined}return func(collection,getIteratee(predicate,3))}function filter(collection,predicate){var func=isArray(collection)?arrayFilter:baseFilter;return func(collection,getIteratee(predicate,3))}var find=createFind(findIndex);var findLast=createFind(findLastIndex);function flatMap(collection,iteratee){return baseFlatten(map(collection,iteratee),1)}function flatMapDeep(collection,iteratee){return baseFlatten(map(collection,iteratee),INFINITY)}function flatMapDepth(collection,iteratee,depth){depth=depth===undefined?1:toInteger(depth);return baseFlatten(map(collection,iteratee),depth)}function forEach(collection,iteratee){var func=isArray(collection)?arrayEach:baseEach;return func(collection,getIteratee(iteratee,3))}function forEachRight(collection,iteratee){var func=isArray(collection)?arrayEachRight:baseEachRight;return func(collection,getIteratee(iteratee,3))}var groupBy=createAggregator(function(result,value,key){if(hasOwnProperty.call(result,key)){result[key].push(value)}else{baseAssignValue(result,key,[value]);

}});function includes(collection,value,fromIndex,guard){collection=isArrayLike(collection)?collection:values(collection);fromIndex=fromIndex&&!guard?toInteger(fromIndex):0;var length=collection.length;if(fromIndex<0){fromIndex=nativeMax(length+fromIndex,0)}return isString(collection)?fromIndex<=length&&collection.indexOf(value,fromIndex)>-1:!!length&&baseIndexOf(collection,value,fromIndex)>-1}var invokeMap=baseRest(function(collection,path,args){var index=-1,isFunc=typeof path=="function",result=isArrayLike(collection)?Array(collection.length):[];baseEach(collection,function(value){result[++index]=isFunc?apply(path,value,args):baseInvoke(value,path,args)});return result});var keyBy=createAggregator(function(result,value,key){baseAssignValue(result,key,value)});function map(collection,iteratee){var func=isArray(collection)?arrayMap:baseMap;return func(collection,getIteratee(iteratee,3))}function orderBy(collection,iteratees,orders,guard){if(collection==null){return[]}if(!isArray(iteratees)){iteratees=iteratees==null?[]:[iteratees]}orders=guard?undefined:orders;if(!isArray(orders)){orders=orders==null?[]:[orders]}return baseOrderBy(collection,iteratees,orders)}var partition=createAggregator(function(result,value,key){result[key?0:1].push(value)},function(){return[[],[]]});function reduce(collection,iteratee,accumulator){var func=isArray(collection)?arrayReduce:baseReduce,initAccum=arguments.length<3;return func(collection,getIteratee(iteratee,4),accumulator,initAccum,baseEach)}function reduceRight(collection,iteratee,accumulator){var func=isArray(collection)?arrayReduceRight:baseReduce,initAccum=arguments.length<3;return func(collection,getIteratee(iteratee,4),accumulator,initAccum,baseEachRight)}function reject(collection,predicate){var func=isArray(collection)?arrayFilter:baseFilter;return func(collection,negate(getIteratee(predicate,3)))}function sample(collection){var func=isArray(collection)?arraySample:baseSample;return func(collection)}function sampleSize(collection,n,guard){if(guard?isIterateeCall(collection,n,guard):n===undefined){n=1}else{n=toInteger(n)}var func=isArray(collection)?arraySampleSize:baseSampleSize;return func(collection,n)}function shuffle(collection){var func=isArray(collection)?arrayShuffle:baseShuffle;return func(collection)}function size(collection){if(collection==null){return 0}if(isArrayLike(collection)){return isString(collection)?stringSize(collection):collection.length}var tag=getTag(collection);if(tag==mapTag||tag==setTag){return collection.size}return baseKeys(collection).length}function some(collection,predicate,guard){var func=isArray(collection)?arraySome:baseSome;if(guard&&isIterateeCall(collection,predicate,guard)){predicate=undefined}return func(collection,getIteratee(predicate,3))}var sortBy=baseRest(function(collection,iteratees){if(collection==null){return[]}var length=iteratees.length;if(length>1&&isIterateeCall(collection,iteratees[0],iteratees[1])){iteratees=[]}else if(length>2&&isIterateeCall(iteratees[0],iteratees[1],iteratees[2])){iteratees=[iteratees[0]]}return baseOrderBy(collection,baseFlatten(iteratees,1),[])});var now=ctxNow||function(){return root.Date.now()};function after(n,func){if(typeof func!="function"){throw new TypeError(FUNC_ERROR_TEXT)}n=toInteger(n);return function(){if(--n<1){return func.apply(this,arguments)}}}function ary(func,n,guard){n=guard?undefined:n;n=func&&n==null?func.length:n;return createWrap(func,WRAP_ARY_FLAG,undefined,undefined,undefined,undefined,n)}function before(n,func){var result;if(typeof func!="function"){throw new TypeError(FUNC_ERROR_TEXT)}n=toInteger(n);return function(){if(--n>0){result=func.apply(this,arguments)}if(n<=1){func=undefined}return result}}var bind=baseRest(function(func,thisArg,partials){var bitmask=WRAP_BIND_FLAG;if(partials.length){var holders=replaceHolders(partials,getHolder(bind));bitmask|=WRAP_PARTIAL_FLAG}return createWrap(func,bitmask,thisArg,partials,holders)});var bindKey=baseRest(function(object,key,partials){var bitmask=WRAP_BIND_FLAG|WRAP_BIND_KEY_FLAG;if(partials.length){var holders=replaceHolders(partials,getHolder(bindKey));bitmask|=WRAP_PARTIAL_FLAG}return createWrap(key,bitmask,object,partials,holders)});function curry(func,arity,guard){arity=guard?undefined:arity;var result=createWrap(func,WRAP_CURRY_FLAG,undefined,undefined,undefined,undefined,undefined,arity);result.placeholder=curry.placeholder;return result}function curryRight(func,arity,guard){arity=guard?undefined:arity;var result=createWrap(func,WRAP_CURRY_RIGHT_FLAG,undefined,undefined,undefined,undefined,undefined,arity);result.placeholder=curryRight.placeholder;return result}function debounce(func,wait,options){var lastArgs,lastThis,maxWait,result,timerId,lastCallTime,lastInvokeTime=0,leading=false,maxing=false,trailing=true;if(typeof func!="function"){throw new TypeError(FUNC_ERROR_TEXT)}wait=toNumber(wait)||0;if(isObject(options)){leading=!!options.leading;maxing="maxWait"in options;maxWait=maxing?nativeMax(toNumber(options.maxWait)||0,wait):maxWait;trailing="trailing"in options?!!options.trailing:trailing}function invokeFunc(time){var args=lastArgs,thisArg=lastThis;lastArgs=lastThis=undefined;lastInvokeTime=time;result=func.apply(thisArg,args);return result}function leadingEdge(time){lastInvokeTime=time;timerId=setTimeout(timerExpired,wait);return leading?invokeFunc(time):result}function remainingWait(time){var timeSinceLastCall=time-lastCallTime,timeSinceLastInvoke=time-lastInvokeTime,result=wait-timeSinceLastCall;return maxing?nativeMin(result,maxWait-timeSinceLastInvoke):result}function shouldInvoke(time){var timeSinceLastCall=time-lastCallTime,timeSinceLastInvoke=time-lastInvokeTime;return lastCallTime===undefined||timeSinceLastCall>=wait||timeSinceLastCall<0||maxing&&timeSinceLastInvoke>=maxWait}function timerExpired(){var time=now();if(shouldInvoke(time)){return trailingEdge(time)}timerId=setTimeout(timerExpired,remainingWait(time))}function trailingEdge(time){timerId=undefined;if(trailing&&lastArgs){return invokeFunc(time)}lastArgs=lastThis=undefined;return result}function cancel(){if(timerId!==undefined){clearTimeout(timerId)}lastInvokeTime=0;lastArgs=lastCallTime=lastThis=timerId=undefined}function flush(){return timerId===undefined?result:trailingEdge(now())}function debounced(){var time=now(),isInvoking=shouldInvoke(time);lastArgs=arguments;lastThis=this;lastCallTime=time;if(isInvoking){if(timerId===undefined){return leadingEdge(lastCallTime)}if(maxing){timerId=setTimeout(timerExpired,wait);return invokeFunc(lastCallTime)}}if(timerId===undefined){timerId=setTimeout(timerExpired,wait)}return result}debounced.cancel=cancel;debounced.flush=flush;return debounced}var defer=baseRest(function(func,args){return baseDelay(func,1,args)});var delay=baseRest(function(func,wait,args){return baseDelay(func,toNumber(wait)||0,args)});function flip(func){return createWrap(func,WRAP_FLIP_FLAG)}function memoize(func,resolver){if(typeof func!="function"||resolver!=null&&typeof resolver!="function"){throw new TypeError(FUNC_ERROR_TEXT)}var memoized=function(){var args=arguments,key=resolver?resolver.apply(this,args):args[0],cache=memoized.cache;if(cache.has(key)){return cache.get(key)}var result=func.apply(this,args);memoized.cache=cache.set(key,result)||cache;return result};memoized.cache=new(memoize.Cache||MapCache);return memoized}memoize.Cache=MapCache;function negate(predicate){if(typeof predicate!="function"){throw new TypeError(FUNC_ERROR_TEXT)}return function(){var args=arguments;switch(args.length){case 0:return!predicate.call(this);case 1:return!predicate.call(this,args[0]);case 2:return!predicate.call(this,args[0],args[1]);case 3:return!predicate.call(this,args[0],args[1],args[2])}return!predicate.apply(this,args)}}function once(func){return before(2,func)}var overArgs=castRest(function(func,transforms){transforms=transforms.length==1&&isArray(transforms[0])?arrayMap(transforms[0],baseUnary(getIteratee())):arrayMap(baseFlatten(transforms,1),baseUnary(getIteratee()));var funcsLength=transforms.length;return baseRest(function(args){var index=-1,length=nativeMin(args.length,funcsLength);while(++index<length){args[index]=transforms[index].call(this,args[index])}return apply(func,this,args)})});var partial=baseRest(function(func,partials){var holders=replaceHolders(partials,getHolder(partial));return createWrap(func,WRAP_PARTIAL_FLAG,undefined,partials,holders)});var partialRight=baseRest(function(func,partials){var holders=replaceHolders(partials,getHolder(partialRight));return createWrap(func,WRAP_PARTIAL_RIGHT_FLAG,undefined,partials,holders)});var rearg=flatRest(function(func,indexes){return createWrap(func,WRAP_REARG_FLAG,undefined,undefined,undefined,indexes)});function rest(func,start){if(typeof func!="function"){throw new TypeError(FUNC_ERROR_TEXT)}start=start===undefined?start:toInteger(start);return baseRest(func,start)}function spread(func,start){if(typeof func!="function"){throw new TypeError(FUNC_ERROR_TEXT)}start=start==null?0:nativeMax(toInteger(start),0);return baseRest(function(args){var array=args[start],otherArgs=castSlice(args,0,start);if(array){arrayPush(otherArgs,array)}return apply(func,this,otherArgs)})}function throttle(func,wait,options){var leading=true,trailing=true;if(typeof func!="function"){throw new TypeError(FUNC_ERROR_TEXT)}if(isObject(options)){leading="leading"in options?!!options.leading:leading;trailing="trailing"in options?!!options.trailing:trailing}return debounce(func,wait,{leading:leading,maxWait:wait,trailing:trailing})}function unary(func){return ary(func,1)}function wrap(value,wrapper){return partial(castFunction(wrapper),value)}function castArray(){if(!arguments.length){return[]}var value=arguments[0];return isArray(value)?value:[value]}function clone(value){return baseClone(value,CLONE_SYMBOLS_FLAG)}function cloneWith(value,customizer){customizer=typeof customizer=="function"?customizer:undefined;return baseClone(value,CLONE_SYMBOLS_FLAG,customizer)}function cloneDeep(value){return baseClone(value,CLONE_DEEP_FLAG|CLONE_SYMBOLS_FLAG)}function cloneDeepWith(value,customizer){customizer=typeof customizer=="function"?customizer:undefined;return baseClone(value,CLONE_DEEP_FLAG|CLONE_SYMBOLS_FLAG,customizer)}function conformsTo(object,source){return source==null||baseConformsTo(object,source,keys(source))}function eq(value,other){return value===other||value!==value&&other!==other}var gt=createRelationalOperation(baseGt);var gte=createRelationalOperation(function(value,other){return value>=other});var isArguments=baseIsArguments(function(){return arguments}())?baseIsArguments:function(value){return isObjectLike(value)&&hasOwnProperty.call(value,"callee")&&!propertyIsEnumerable.call(value,"callee")};var isArray=Array.isArray;var isArrayBuffer=nodeIsArrayBuffer?baseUnary(nodeIsArrayBuffer):baseIsArrayBuffer;function isArrayLike(value){return value!=null&&isLength(value.length)&&!isFunction(value)}function isArrayLikeObject(value){return isObjectLike(value)&&isArrayLike(value)}function isBoolean(value){return value===true||value===false||isObjectLike(value)&&baseGetTag(value)==boolTag}var isBuffer=nativeIsBuffer||stubFalse;var isDate=nodeIsDate?baseUnary(nodeIsDate):baseIsDate;function isElement(value){return isObjectLike(value)&&value.nodeType===1&&!isPlainObject(value)}function isEmpty(value){if(value==null){return true}if(isArrayLike(value)&&(isArray(value)||typeof value=="string"||typeof value.splice=="function"||isBuffer(value)||isTypedArray(value)||isArguments(value))){return!value.length}var tag=getTag(value);if(tag==mapTag||tag==setTag){return!value.size}if(isPrototype(value)){return!baseKeys(value).length}for(var key in value){if(hasOwnProperty.call(value,key)){return false}}return true}function isEqual(value,other){return baseIsEqual(value,other)}function isEqualWith(value,other,customizer){customizer=typeof customizer=="function"?customizer:undefined;var result=customizer?customizer(value,other):undefined;return result===undefined?baseIsEqual(value,other,undefined,customizer):!!result}function isError(value){if(!isObjectLike(value)){return false}var tag=baseGetTag(value);return tag==errorTag||tag==domExcTag||typeof value.message=="string"&&typeof value.name=="string"&&!isPlainObject(value)}function isFinite(value){return typeof value=="number"&&nativeIsFinite(value)}function isFunction(value){if(!isObject(value)){return false}var tag=baseGetTag(value);return tag==funcTag||tag==genTag||tag==asyncTag||tag==proxyTag}function isInteger(value){return typeof value=="number"&&value==toInteger(value)}function isLength(value){return typeof value=="number"&&value>-1&&value%1==0&&value<=MAX_SAFE_INTEGER}function isObject(value){var type=typeof value;return value!=null&&(type=="object"||type=="function")}function isObjectLike(value){return value!=null&&typeof value=="object"}var isMap=nodeIsMap?baseUnary(nodeIsMap):baseIsMap;function isMatch(object,source){return object===source||baseIsMatch(object,source,getMatchData(source))}function isMatchWith(object,source,customizer){customizer=typeof customizer=="function"?customizer:undefined;return baseIsMatch(object,source,getMatchData(source),customizer)}function isNaN(value){return isNumber(value)&&value!=+value}function isNative(value){if(isMaskable(value)){throw new Error(CORE_ERROR_TEXT)}return baseIsNative(value)}function isNull(value){return value===null}function isNil(value){return value==null}function isNumber(value){return typeof value=="number"||isObjectLike(value)&&baseGetTag(value)==numberTag}function isPlainObject(value){if(!isObjectLike(value)||baseGetTag(value)!=objectTag){return false}var proto=getPrototype(value);if(proto===null){return true}var Ctor=hasOwnProperty.call(proto,"constructor")&&proto.constructor;return typeof Ctor=="function"&&Ctor instanceof Ctor&&funcToString.call(Ctor)==objectCtorString}var isRegExp=nodeIsRegExp?baseUnary(nodeIsRegExp):baseIsRegExp;function isSafeInteger(value){return isInteger(value)&&value>=-MAX_SAFE_INTEGER&&value<=MAX_SAFE_INTEGER}var isSet=nodeIsSet?baseUnary(nodeIsSet):baseIsSet;function isString(value){return typeof value=="string"||!isArray(value)&&isObjectLike(value)&&baseGetTag(value)==stringTag}function isSymbol(value){return typeof value=="symbol"||isObjectLike(value)&&baseGetTag(value)==symbolTag}var isTypedArray=nodeIsTypedArray?baseUnary(nodeIsTypedArray):baseIsTypedArray;function isUndefined(value){return value===undefined}function isWeakMap(value){return isObjectLike(value)&&getTag(value)==weakMapTag}function isWeakSet(value){return isObjectLike(value)&&baseGetTag(value)==weakSetTag}var lt=createRelationalOperation(baseLt);var lte=createRelationalOperation(function(value,other){return value<=other});function toArray(value){if(!value){return[]}if(isArrayLike(value)){return isString(value)?stringToArray(value):copyArray(value)}if(symIterator&&value[symIterator]){return iteratorToArray(value[symIterator]())}var tag=getTag(value),func=tag==mapTag?mapToArray:tag==setTag?setToArray:values;return func(value)}function toFinite(value){if(!value){return value===0?value:0}value=toNumber(value);if(value===INFINITY||value===-INFINITY){var sign=value<0?-1:1;return sign*MAX_INTEGER}return value===value?value:0}function toInteger(value){var result=toFinite(value),remainder=result%1;return result===result?remainder?result-remainder:result:0}function toLength(value){return value?baseClamp(toInteger(value),0,MAX_ARRAY_LENGTH):0}function toNumber(value){if(typeof value=="number"){return value}if(isSymbol(value)){return NAN}if(isObject(value)){var other=typeof value.valueOf=="function"?value.valueOf():value;value=isObject(other)?other+"":other}if(typeof value!="string"){return value===0?value:+value}value=value.replace(reTrim,"");var isBinary=reIsBinary.test(value);return isBinary||reIsOctal.test(value)?freeParseInt(value.slice(2),isBinary?2:8):reIsBadHex.test(value)?NAN:+value}function toPlainObject(value){return copyObject(value,keysIn(value))}function toSafeInteger(value){return value?baseClamp(toInteger(value),-MAX_SAFE_INTEGER,MAX_SAFE_INTEGER):value===0?value:0}function toString(value){return value==null?"":baseToString(value)}var assign=createAssigner(function(object,source){if(isPrototype(source)||isArrayLike(source)){copyObject(source,keys(source),object);return}for(var key in source){if(hasOwnProperty.call(source,key)){assignValue(object,key,source[key])}}});var assignIn=createAssigner(function(object,source){copyObject(source,keysIn(source),object)});var assignInWith=createAssigner(function(object,source,srcIndex,customizer){copyObject(source,keysIn(source),object,customizer)});var assignWith=createAssigner(function(object,source,srcIndex,customizer){copyObject(source,keys(source),object,customizer)});var at=flatRest(baseAt);function create(prototype,properties){var result=baseCreate(prototype);return properties==null?result:baseAssign(result,properties)}var defaults=baseRest(function(args){args.push(undefined,customDefaultsAssignIn);return apply(assignInWith,undefined,args)});var defaultsDeep=baseRest(function(args){args.push(undefined,customDefaultsMerge);return apply(mergeWith,undefined,args)});function findKey(object,predicate){return baseFindKey(object,getIteratee(predicate,3),baseForOwn)}function findLastKey(object,predicate){return baseFindKey(object,getIteratee(predicate,3),baseForOwnRight)}function forIn(object,iteratee){return object==null?object:baseFor(object,getIteratee(iteratee,3),keysIn)}function forInRight(object,iteratee){return object==null?object:baseForRight(object,getIteratee(iteratee,3),keysIn)}function forOwn(object,iteratee){return object&&baseForOwn(object,getIteratee(iteratee,3))}function forOwnRight(object,iteratee){return object&&baseForOwnRight(object,getIteratee(iteratee,3))}function functions(object){return object==null?[]:baseFunctions(object,keys(object))}function functionsIn(object){return object==null?[]:baseFunctions(object,keysIn(object))}function get(object,path,defaultValue){var result=object==null?undefined:baseGet(object,path);return result===undefined?defaultValue:result}function has(object,path){return object!=null&&hasPath(object,path,baseHas)}function hasIn(object,path){return object!=null&&hasPath(object,path,baseHasIn)}var invert=createInverter(function(result,value,key){result[value]=key},constant(identity));var invertBy=createInverter(function(result,value,key){if(hasOwnProperty.call(result,value)){result[value].push(key)}else{result[value]=[key]}},getIteratee);var invoke=baseRest(baseInvoke);function keys(object){return isArrayLike(object)?arrayLikeKeys(object):baseKeys(object)}function keysIn(object){return isArrayLike(object)?arrayLikeKeys(object,true):baseKeysIn(object)}function mapKeys(object,iteratee){var result={};iteratee=getIteratee(iteratee,3);baseForOwn(object,function(value,key,object){baseAssignValue(result,iteratee(value,key,object),value)});return result}function mapValues(object,iteratee){var result={};iteratee=getIteratee(iteratee,3);baseForOwn(object,function(value,key,object){baseAssignValue(result,key,iteratee(value,key,object))});return result}var merge=createAssigner(function(object,source,srcIndex){baseMerge(object,source,srcIndex)});var mergeWith=createAssigner(function(object,source,srcIndex,customizer){baseMerge(object,source,srcIndex,customizer)});var omit=flatRest(function(object,paths){var result={};if(object==null){return result}var isDeep=false;paths=arrayMap(paths,function(path){path=castPath(path,object);isDeep||(isDeep=path.length>1);return path});copyObject(object,getAllKeysIn(object),result);if(isDeep){result=baseClone(result,CLONE_DEEP_FLAG|CLONE_FLAT_FLAG|CLONE_SYMBOLS_FLAG,customOmitClone)}var length=paths.length;while(length--){baseUnset(result,paths[length])}return result});function omitBy(object,predicate){return pickBy(object,negate(getIteratee(predicate)))}var pick=flatRest(function(object,paths){return object==null?{}:basePick(object,paths)});function pickBy(object,predicate){if(object==null){return{}}var props=arrayMap(getAllKeysIn(object),function(prop){return[prop]});predicate=getIteratee(predicate);return basePickBy(object,props,function(value,path){return predicate(value,path[0])})}function result(object,path,defaultValue){path=castPath(path,object);var index=-1,length=path.length;if(!length){length=1;object=undefined}while(++index<length){var value=object==null?undefined:object[toKey(path[index])];if(value===undefined){index=length;value=defaultValue}object=isFunction(value)?value.call(object):value}return object}function set(object,path,value){return object==null?object:baseSet(object,path,value)}function setWith(object,path,value,customizer){customizer=typeof customizer=="function"?customizer:undefined;return object==null?object:baseSet(object,path,value,customizer)}var toPairs=createToPairs(keys);var toPairsIn=createToPairs(keysIn);function transform(object,iteratee,accumulator){var isArr=isArray(object),isArrLike=isArr||isBuffer(object)||isTypedArray(object);iteratee=getIteratee(iteratee,4);if(accumulator==null){var Ctor=object&&object.constructor;if(isArrLike){accumulator=isArr?new Ctor:[]}else if(isObject(object)){accumulator=isFunction(Ctor)?baseCreate(getPrototype(object)):{}}else{accumulator={}}}(isArrLike?arrayEach:baseForOwn)(object,function(value,index,object){return iteratee(accumulator,value,index,object)});return accumulator}function unset(object,path){return object==null?true:baseUnset(object,path)}function update(object,path,updater){return object==null?object:baseUpdate(object,path,castFunction(updater))}function updateWith(object,path,updater,customizer){customizer=typeof customizer=="function"?customizer:undefined;return object==null?object:baseUpdate(object,path,castFunction(updater),customizer)}function values(object){return object==null?[]:baseValues(object,keys(object))}function valuesIn(object){return object==null?[]:baseValues(object,keysIn(object))}function clamp(number,lower,upper){if(upper===undefined){upper=lower;lower=undefined}if(upper!==undefined){upper=toNumber(upper);upper=upper===upper?upper:0}if(lower!==undefined){lower=toNumber(lower);lower=lower===lower?lower:0}return baseClamp(toNumber(number),lower,upper)}function inRange(number,start,end){start=toFinite(start);if(end===undefined){end=start;start=0}else{end=toFinite(end)}number=toNumber(number);return baseInRange(number,start,end)}function random(lower,upper,floating){if(floating&&typeof floating!="boolean"&&isIterateeCall(lower,upper,floating)){upper=floating=undefined}if(floating===undefined){if(typeof upper=="boolean"){floating=upper;upper=undefined}else if(typeof lower=="boolean"){floating=lower;lower=undefined}}if(lower===undefined&&upper===undefined){lower=0;upper=1}else{lower=toFinite(lower);if(upper===undefined){upper=lower;lower=0}else{upper=toFinite(upper)}}if(lower>upper){var temp=lower;lower=upper;upper=temp}if(floating||lower%1||upper%1){var rand=nativeRandom();return nativeMin(lower+rand*(upper-lower+freeParseFloat("1e-"+((rand+"").length-1))),upper)}return baseRandom(lower,upper)}var camelCase=createCompounder(function(result,word,index){word=word.toLowerCase();return result+(index?capitalize(word):word)});function capitalize(string){return upperFirst(toString(string).toLowerCase())}function deburr(string){string=toString(string);return string&&string.replace(reLatin,deburrLetter).replace(reComboMark,"")}function endsWith(string,target,position){string=toString(string);target=baseToString(target);var length=string.length;position=position===undefined?length:baseClamp(toInteger(position),0,length);var end=position;position-=target.length;return position>=0&&string.slice(position,end)==target}function escape(string){string=toString(string);return string&&reHasUnescapedHtml.test(string)?string.replace(reUnescapedHtml,escapeHtmlChar):string}function escapeRegExp(string){string=toString(string);return string&&reHasRegExpChar.test(string)?string.replace(reRegExpChar,"\\$&"):string}var kebabCase=createCompounder(function(result,word,index){return result+(index?"-":"")+word.toLowerCase()});var lowerCase=createCompounder(function(result,word,index){return result+(index?" ":"")+word.toLowerCase()});var lowerFirst=createCaseFirst("toLowerCase");function pad(string,length,chars){string=toString(string);length=toInteger(length);var strLength=length?stringSize(string):0;if(!length||strLength>=length){return string}var mid=(length-strLength)/2;return createPadding(nativeFloor(mid),chars)+string+createPadding(nativeCeil(mid),chars)}function padEnd(string,length,chars){string=toString(string);length=toInteger(length);var strLength=length?stringSize(string):0;return length&&strLength<length?string+createPadding(length-strLength,chars):string}function padStart(string,length,chars){string=toString(string);length=toInteger(length);var strLength=length?stringSize(string):0;return length&&strLength<length?createPadding(length-strLength,chars)+string:string}function parseInt(string,radix,guard){if(guard||radix==null){radix=0}else if(radix){radix=+radix}return nativeParseInt(toString(string).replace(reTrimStart,""),radix||0)}function repeat(string,n,guard){if(guard?isIterateeCall(string,n,guard):n===undefined){n=1}else{n=toInteger(n)}return baseRepeat(toString(string),n)}function replace(){var args=arguments,string=toString(args[0]);return args.length<3?string:string.replace(args[1],args[2])}var snakeCase=createCompounder(function(result,word,index){return result+(index?"_":"")+word.toLowerCase()});function split(string,separator,limit){if(limit&&typeof limit!="number"&&isIterateeCall(string,separator,limit)){separator=limit=undefined}limit=limit===undefined?MAX_ARRAY_LENGTH:limit>>>0;if(!limit){return[]}string=toString(string);if(string&&(typeof separator=="string"||separator!=null&&!isRegExp(separator))){separator=baseToString(separator);if(!separator&&hasUnicode(string)){return castSlice(stringToArray(string),0,limit)}}return string.split(separator,limit)}var startCase=createCompounder(function(result,word,index){return result+(index?" ":"")+upperFirst(word)});function startsWith(string,target,position){string=toString(string);position=position==null?0:baseClamp(toInteger(position),0,string.length);target=baseToString(target);return string.slice(position,position+target.length)==target}function template(string,options,guard){var settings=lodash.templateSettings;if(guard&&isIterateeCall(string,options,guard)){options=undefined}string=toString(string);options=assignInWith({},options,settings,customDefaultsAssignIn);var imports=assignInWith({},options.imports,settings.imports,customDefaultsAssignIn),importsKeys=keys(imports),importsValues=baseValues(imports,importsKeys);var isEscaping,isEvaluating,index=0,interpolate=options.interpolate||reNoMatch,source="__p += '";var reDelimiters=RegExp((options.escape||reNoMatch).source+"|"+interpolate.source+"|"+(interpolate===reInterpolate?reEsTemplate:reNoMatch).source+"|"+(options.evaluate||reNoMatch).source+"|$","g");var sourceURL="//# sourceURL="+("sourceURL"in options?options.sourceURL:"lodash.templateSources["+ ++templateCounter+"]")+"\n";string.replace(reDelimiters,function(match,escapeValue,interpolateValue,esTemplateValue,evaluateValue,offset){interpolateValue||(interpolateValue=esTemplateValue);source+=string.slice(index,offset).replace(reUnescapedString,escapeStringChar);if(escapeValue){isEscaping=true;source+="' +\n__e("+escapeValue+") +\n'"}if(evaluateValue){isEvaluating=true;source+="';\n"+evaluateValue+";\n__p += '"}if(interpolateValue){source+="' +\n((__t = ("+interpolateValue+")) == null ? '' : __t) +\n'"}index=offset+match.length;return match});source+="';\n";var variable=options.variable;if(!variable){source="with (obj) {\n"+source+"\n}\n"}source=(isEvaluating?source.replace(reEmptyStringLeading,""):source).replace(reEmptyStringMiddle,"$1").replace(reEmptyStringTrailing,"$1;");source="function("+(variable||"obj")+") {\n"+(variable?"":"obj || (obj = {});\n")+"var __t, __p = ''"+(isEscaping?", __e = _.escape":"")+(isEvaluating?", __j = Array.prototype.join;\n"+"function print() { __p += __j.call(arguments, '') }\n":";\n")+source+"return __p\n}";var result=attempt(function(){return Function(importsKeys,sourceURL+"return "+source).apply(undefined,importsValues)});result.source=source;if(isError(result)){throw result}return result}function toLower(value){return toString(value).toLowerCase()}function toUpper(value){return toString(value).toUpperCase()}function trim(string,chars,guard){string=toString(string);if(string&&(guard||chars===undefined)){return string.replace(reTrim,"")}if(!string||!(chars=baseToString(chars))){return string}var strSymbols=stringToArray(string),chrSymbols=stringToArray(chars),start=charsStartIndex(strSymbols,chrSymbols),end=charsEndIndex(strSymbols,chrSymbols)+1;return castSlice(strSymbols,start,end).join("")}function trimEnd(string,chars,guard){string=toString(string);if(string&&(guard||chars===undefined)){return string.replace(reTrimEnd,"")}if(!string||!(chars=baseToString(chars))){return string}var strSymbols=stringToArray(string),end=charsEndIndex(strSymbols,stringToArray(chars))+1;return castSlice(strSymbols,0,end).join("")}function trimStart(string,chars,guard){string=toString(string);if(string&&(guard||chars===undefined)){return string.replace(reTrimStart,"")}if(!string||!(chars=baseToString(chars))){return string}var strSymbols=stringToArray(string),start=charsStartIndex(strSymbols,stringToArray(chars));return castSlice(strSymbols,start).join("")}function truncate(string,options){var length=DEFAULT_TRUNC_LENGTH,omission=DEFAULT_TRUNC_OMISSION;if(isObject(options)){var separator="separator"in options?options.separator:separator;length="length"in options?toInteger(options.length):length;omission="omission"in options?baseToString(options.omission):omission}string=toString(string);var strLength=string.length;if(hasUnicode(string)){var strSymbols=stringToArray(string);strLength=strSymbols.length}if(length>=strLength){return string}var end=length-stringSize(omission);if(end<1){return omission}var result=strSymbols?castSlice(strSymbols,0,end).join(""):string.slice(0,end);if(separator===undefined){return result+omission}if(strSymbols){end+=result.length-end}if(isRegExp(separator)){if(string.slice(end).search(separator)){var match,substring=result;if(!separator.global){separator=RegExp(separator.source,toString(reFlags.exec(separator))+"g")}separator.lastIndex=0;while(match=separator.exec(substring)){var newEnd=match.index}result=result.slice(0,newEnd===undefined?end:newEnd)}}else if(string.indexOf(baseToString(separator),end)!=end){var index=result.lastIndexOf(separator);if(index>-1){result=result.slice(0,index)}}return result+omission}function unescape(string){string=toString(string);return string&&reHasEscapedHtml.test(string)?string.replace(reEscapedHtml,unescapeHtmlChar):string}var upperCase=createCompounder(function(result,word,index){return result+(index?" ":"")+word.toUpperCase()});var upperFirst=createCaseFirst("toUpperCase");function words(string,pattern,guard){string=toString(string);pattern=guard?undefined:pattern;if(pattern===undefined){return hasUnicodeWord(string)?unicodeWords(string):asciiWords(string)}return string.match(pattern)||[]}var attempt=baseRest(function(func,args){try{return apply(func,undefined,args)}catch(e){return isError(e)?e:new Error(e)}});var bindAll=flatRest(function(object,methodNames){arrayEach(methodNames,function(key){key=toKey(key);baseAssignValue(object,key,bind(object[key],object))});return object});function cond(pairs){var length=pairs==null?0:pairs.length,toIteratee=getIteratee();pairs=!length?[]:arrayMap(pairs,function(pair){if(typeof pair[1]!="function"){throw new TypeError(FUNC_ERROR_TEXT)}return[toIteratee(pair[0]),pair[1]]});return baseRest(function(args){var index=-1;while(++index<length){var pair=pairs[index];if(apply(pair[0],this,args)){return apply(pair[1],this,args)}}})}function conforms(source){return baseConforms(baseClone(source,CLONE_DEEP_FLAG))}function constant(value){
return function(){return value}}function defaultTo(value,defaultValue){return value==null||value!==value?defaultValue:value}var flow=createFlow();var flowRight=createFlow(true);function identity(value){return value}function iteratee(func){return baseIteratee(typeof func=="function"?func:baseClone(func,CLONE_DEEP_FLAG))}function matches(source){return baseMatches(baseClone(source,CLONE_DEEP_FLAG))}function matchesProperty(path,srcValue){return baseMatchesProperty(path,baseClone(srcValue,CLONE_DEEP_FLAG))}var method=baseRest(function(path,args){return function(object){return baseInvoke(object,path,args)}});var methodOf=baseRest(function(object,args){return function(path){return baseInvoke(object,path,args)}});function mixin(object,source,options){var props=keys(source),methodNames=baseFunctions(source,props);if(options==null&&!(isObject(source)&&(methodNames.length||!props.length))){options=source;source=object;object=this;methodNames=baseFunctions(source,keys(source))}var chain=!(isObject(options)&&"chain"in options)||!!options.chain,isFunc=isFunction(object);arrayEach(methodNames,function(methodName){var func=source[methodName];object[methodName]=func;if(isFunc){object.prototype[methodName]=function(){var chainAll=this.__chain__;if(chain||chainAll){var result=object(this.__wrapped__),actions=result.__actions__=copyArray(this.__actions__);actions.push({func:func,args:arguments,thisArg:object});result.__chain__=chainAll;return result}return func.apply(object,arrayPush([this.value()],arguments))}}});return object}function noConflict(){if(root._===this){root._=oldDash}return this}function noop(){}function nthArg(n){n=toInteger(n);return baseRest(function(args){return baseNth(args,n)})}var over=createOver(arrayMap);var overEvery=createOver(arrayEvery);var overSome=createOver(arraySome);function property(path){return isKey(path)?baseProperty(toKey(path)):basePropertyDeep(path)}function propertyOf(object){return function(path){return object==null?undefined:baseGet(object,path)}}var range=createRange();var rangeRight=createRange(true);function stubArray(){return[]}function stubFalse(){return false}function stubObject(){return{}}function stubString(){return""}function stubTrue(){return true}function times(n,iteratee){n=toInteger(n);if(n<1||n>MAX_SAFE_INTEGER){return[]}var index=MAX_ARRAY_LENGTH,length=nativeMin(n,MAX_ARRAY_LENGTH);iteratee=getIteratee(iteratee);n-=MAX_ARRAY_LENGTH;var result=baseTimes(length,iteratee);while(++index<n){iteratee(index)}return result}function toPath(value){if(isArray(value)){return arrayMap(value,toKey)}return isSymbol(value)?[value]:copyArray(stringToPath(toString(value)))}function uniqueId(prefix){var id=++idCounter;return toString(prefix)+id}var add=createMathOperation(function(augend,addend){return augend+addend},0);var ceil=createRound("ceil");var divide=createMathOperation(function(dividend,divisor){return dividend/divisor},1);var floor=createRound("floor");function max(array){return array&&array.length?baseExtremum(array,identity,baseGt):undefined}function maxBy(array,iteratee){return array&&array.length?baseExtremum(array,getIteratee(iteratee,2),baseGt):undefined}function mean(array){return baseMean(array,identity)}function meanBy(array,iteratee){return baseMean(array,getIteratee(iteratee,2))}function min(array){return array&&array.length?baseExtremum(array,identity,baseLt):undefined}function minBy(array,iteratee){return array&&array.length?baseExtremum(array,getIteratee(iteratee,2),baseLt):undefined}var multiply=createMathOperation(function(multiplier,multiplicand){return multiplier*multiplicand},1);var round=createRound("round");var subtract=createMathOperation(function(minuend,subtrahend){return minuend-subtrahend},0);function sum(array){return array&&array.length?baseSum(array,identity):0}function sumBy(array,iteratee){return array&&array.length?baseSum(array,getIteratee(iteratee,2)):0}lodash.after=after;lodash.ary=ary;lodash.assign=assign;lodash.assignIn=assignIn;lodash.assignInWith=assignInWith;lodash.assignWith=assignWith;lodash.at=at;lodash.before=before;lodash.bind=bind;lodash.bindAll=bindAll;lodash.bindKey=bindKey;lodash.castArray=castArray;lodash.chain=chain;lodash.chunk=chunk;lodash.compact=compact;lodash.concat=concat;lodash.cond=cond;lodash.conforms=conforms;lodash.constant=constant;lodash.countBy=countBy;lodash.create=create;lodash.curry=curry;lodash.curryRight=curryRight;lodash.debounce=debounce;lodash.defaults=defaults;lodash.defaultsDeep=defaultsDeep;lodash.defer=defer;lodash.delay=delay;lodash.difference=difference;lodash.differenceBy=differenceBy;lodash.differenceWith=differenceWith;lodash.drop=drop;lodash.dropRight=dropRight;lodash.dropRightWhile=dropRightWhile;lodash.dropWhile=dropWhile;lodash.fill=fill;lodash.filter=filter;lodash.flatMap=flatMap;lodash.flatMapDeep=flatMapDeep;lodash.flatMapDepth=flatMapDepth;lodash.flatten=flatten;lodash.flattenDeep=flattenDeep;lodash.flattenDepth=flattenDepth;lodash.flip=flip;lodash.flow=flow;lodash.flowRight=flowRight;lodash.fromPairs=fromPairs;lodash.functions=functions;lodash.functionsIn=functionsIn;lodash.groupBy=groupBy;lodash.initial=initial;lodash.intersection=intersection;lodash.intersectionBy=intersectionBy;lodash.intersectionWith=intersectionWith;lodash.invert=invert;lodash.invertBy=invertBy;lodash.invokeMap=invokeMap;lodash.iteratee=iteratee;lodash.keyBy=keyBy;lodash.keys=keys;lodash.keysIn=keysIn;lodash.map=map;lodash.mapKeys=mapKeys;lodash.mapValues=mapValues;lodash.matches=matches;lodash.matchesProperty=matchesProperty;lodash.memoize=memoize;lodash.merge=merge;lodash.mergeWith=mergeWith;lodash.method=method;lodash.methodOf=methodOf;lodash.mixin=mixin;lodash.negate=negate;lodash.nthArg=nthArg;lodash.omit=omit;lodash.omitBy=omitBy;lodash.once=once;lodash.orderBy=orderBy;lodash.over=over;lodash.overArgs=overArgs;lodash.overEvery=overEvery;lodash.overSome=overSome;lodash.partial=partial;lodash.partialRight=partialRight;lodash.partition=partition;lodash.pick=pick;lodash.pickBy=pickBy;lodash.property=property;lodash.propertyOf=propertyOf;lodash.pull=pull;lodash.pullAll=pullAll;lodash.pullAllBy=pullAllBy;lodash.pullAllWith=pullAllWith;lodash.pullAt=pullAt;lodash.range=range;lodash.rangeRight=rangeRight;lodash.rearg=rearg;lodash.reject=reject;lodash.remove=remove;lodash.rest=rest;lodash.reverse=reverse;lodash.sampleSize=sampleSize;lodash.set=set;lodash.setWith=setWith;lodash.shuffle=shuffle;lodash.slice=slice;lodash.sortBy=sortBy;lodash.sortedUniq=sortedUniq;lodash.sortedUniqBy=sortedUniqBy;lodash.split=split;lodash.spread=spread;lodash.tail=tail;lodash.take=take;lodash.takeRight=takeRight;lodash.takeRightWhile=takeRightWhile;lodash.takeWhile=takeWhile;lodash.tap=tap;lodash.throttle=throttle;lodash.thru=thru;lodash.toArray=toArray;lodash.toPairs=toPairs;lodash.toPairsIn=toPairsIn;lodash.toPath=toPath;lodash.toPlainObject=toPlainObject;lodash.transform=transform;lodash.unary=unary;lodash.union=union;lodash.unionBy=unionBy;lodash.unionWith=unionWith;lodash.uniq=uniq;lodash.uniqBy=uniqBy;lodash.uniqWith=uniqWith;lodash.unset=unset;lodash.unzip=unzip;lodash.unzipWith=unzipWith;lodash.update=update;lodash.updateWith=updateWith;lodash.values=values;lodash.valuesIn=valuesIn;lodash.without=without;lodash.words=words;lodash.wrap=wrap;lodash.xor=xor;lodash.xorBy=xorBy;lodash.xorWith=xorWith;lodash.zip=zip;lodash.zipObject=zipObject;lodash.zipObjectDeep=zipObjectDeep;lodash.zipWith=zipWith;lodash.entries=toPairs;lodash.entriesIn=toPairsIn;lodash.extend=assignIn;lodash.extendWith=assignInWith;mixin(lodash,lodash);lodash.add=add;lodash.attempt=attempt;lodash.camelCase=camelCase;lodash.capitalize=capitalize;lodash.ceil=ceil;lodash.clamp=clamp;lodash.clone=clone;lodash.cloneDeep=cloneDeep;lodash.cloneDeepWith=cloneDeepWith;lodash.cloneWith=cloneWith;lodash.conformsTo=conformsTo;lodash.deburr=deburr;lodash.defaultTo=defaultTo;lodash.divide=divide;lodash.endsWith=endsWith;lodash.eq=eq;lodash.escape=escape;lodash.escapeRegExp=escapeRegExp;lodash.every=every;lodash.find=find;lodash.findIndex=findIndex;lodash.findKey=findKey;lodash.findLast=findLast;lodash.findLastIndex=findLastIndex;lodash.findLastKey=findLastKey;lodash.floor=floor;lodash.forEach=forEach;lodash.forEachRight=forEachRight;lodash.forIn=forIn;lodash.forInRight=forInRight;lodash.forOwn=forOwn;lodash.forOwnRight=forOwnRight;lodash.get=get;lodash.gt=gt;lodash.gte=gte;lodash.has=has;lodash.hasIn=hasIn;lodash.head=head;lodash.identity=identity;lodash.includes=includes;lodash.indexOf=indexOf;lodash.inRange=inRange;lodash.invoke=invoke;lodash.isArguments=isArguments;lodash.isArray=isArray;lodash.isArrayBuffer=isArrayBuffer;lodash.isArrayLike=isArrayLike;lodash.isArrayLikeObject=isArrayLikeObject;lodash.isBoolean=isBoolean;lodash.isBuffer=isBuffer;lodash.isDate=isDate;lodash.isElement=isElement;lodash.isEmpty=isEmpty;lodash.isEqual=isEqual;lodash.isEqualWith=isEqualWith;lodash.isError=isError;lodash.isFinite=isFinite;lodash.isFunction=isFunction;lodash.isInteger=isInteger;lodash.isLength=isLength;lodash.isMap=isMap;lodash.isMatch=isMatch;lodash.isMatchWith=isMatchWith;lodash.isNaN=isNaN;lodash.isNative=isNative;lodash.isNil=isNil;lodash.isNull=isNull;lodash.isNumber=isNumber;lodash.isObject=isObject;lodash.isObjectLike=isObjectLike;lodash.isPlainObject=isPlainObject;lodash.isRegExp=isRegExp;lodash.isSafeInteger=isSafeInteger;lodash.isSet=isSet;lodash.isString=isString;lodash.isSymbol=isSymbol;lodash.isTypedArray=isTypedArray;lodash.isUndefined=isUndefined;lodash.isWeakMap=isWeakMap;lodash.isWeakSet=isWeakSet;lodash.join=join;lodash.kebabCase=kebabCase;lodash.last=last;lodash.lastIndexOf=lastIndexOf;lodash.lowerCase=lowerCase;lodash.lowerFirst=lowerFirst;lodash.lt=lt;lodash.lte=lte;lodash.max=max;lodash.maxBy=maxBy;lodash.mean=mean;lodash.meanBy=meanBy;lodash.min=min;lodash.minBy=minBy;lodash.stubArray=stubArray;lodash.stubFalse=stubFalse;lodash.stubObject=stubObject;lodash.stubString=stubString;lodash.stubTrue=stubTrue;lodash.multiply=multiply;lodash.nth=nth;lodash.noConflict=noConflict;lodash.noop=noop;lodash.now=now;lodash.pad=pad;lodash.padEnd=padEnd;lodash.padStart=padStart;lodash.parseInt=parseInt;lodash.random=random;lodash.reduce=reduce;lodash.reduceRight=reduceRight;lodash.repeat=repeat;lodash.replace=replace;lodash.result=result;lodash.round=round;lodash.runInContext=runInContext;lodash.sample=sample;lodash.size=size;lodash.snakeCase=snakeCase;lodash.some=some;lodash.sortedIndex=sortedIndex;lodash.sortedIndexBy=sortedIndexBy;lodash.sortedIndexOf=sortedIndexOf;lodash.sortedLastIndex=sortedLastIndex;lodash.sortedLastIndexBy=sortedLastIndexBy;lodash.sortedLastIndexOf=sortedLastIndexOf;lodash.startCase=startCase;lodash.startsWith=startsWith;lodash.subtract=subtract;lodash.sum=sum;lodash.sumBy=sumBy;lodash.template=template;lodash.times=times;lodash.toFinite=toFinite;lodash.toInteger=toInteger;lodash.toLength=toLength;lodash.toLower=toLower;lodash.toNumber=toNumber;lodash.toSafeInteger=toSafeInteger;lodash.toString=toString;lodash.toUpper=toUpper;lodash.trim=trim;lodash.trimEnd=trimEnd;lodash.trimStart=trimStart;lodash.truncate=truncate;lodash.unescape=unescape;lodash.uniqueId=uniqueId;lodash.upperCase=upperCase;lodash.upperFirst=upperFirst;lodash.each=forEach;lodash.eachRight=forEachRight;lodash.first=head;mixin(lodash,function(){var source={};baseForOwn(lodash,function(func,methodName){if(!hasOwnProperty.call(lodash.prototype,methodName)){source[methodName]=func}});return source}(),{chain:false});lodash.VERSION=VERSION;arrayEach(["bind","bindKey","curry","curryRight","partial","partialRight"],function(methodName){lodash[methodName].placeholder=lodash});arrayEach(["drop","take"],function(methodName,index){LazyWrapper.prototype[methodName]=function(n){n=n===undefined?1:nativeMax(toInteger(n),0);var result=this.__filtered__&&!index?new LazyWrapper(this):this.clone();if(result.__filtered__){result.__takeCount__=nativeMin(n,result.__takeCount__)}else{result.__views__.push({size:nativeMin(n,MAX_ARRAY_LENGTH),type:methodName+(result.__dir__<0?"Right":"")})}return result};LazyWrapper.prototype[methodName+"Right"]=function(n){return this.reverse()[methodName](n).reverse()}});arrayEach(["filter","map","takeWhile"],function(methodName,index){var type=index+1,isFilter=type==LAZY_FILTER_FLAG||type==LAZY_WHILE_FLAG;LazyWrapper.prototype[methodName]=function(iteratee){var result=this.clone();result.__iteratees__.push({iteratee:getIteratee(iteratee,3),type:type});result.__filtered__=result.__filtered__||isFilter;return result}});arrayEach(["head","last"],function(methodName,index){var takeName="take"+(index?"Right":"");LazyWrapper.prototype[methodName]=function(){return this[takeName](1).value()[0]}});arrayEach(["initial","tail"],function(methodName,index){var dropName="drop"+(index?"":"Right");LazyWrapper.prototype[methodName]=function(){return this.__filtered__?new LazyWrapper(this):this[dropName](1)}});LazyWrapper.prototype.compact=function(){return this.filter(identity)};LazyWrapper.prototype.find=function(predicate){return this.filter(predicate).head()};LazyWrapper.prototype.findLast=function(predicate){return this.reverse().find(predicate)};LazyWrapper.prototype.invokeMap=baseRest(function(path,args){if(typeof path=="function"){return new LazyWrapper(this)}return this.map(function(value){return baseInvoke(value,path,args)})});LazyWrapper.prototype.reject=function(predicate){return this.filter(negate(getIteratee(predicate)))};LazyWrapper.prototype.slice=function(start,end){start=toInteger(start);var result=this;if(result.__filtered__&&(start>0||end<0)){return new LazyWrapper(result)}if(start<0){result=result.takeRight(-start)}else if(start){result=result.drop(start)}if(end!==undefined){end=toInteger(end);result=end<0?result.dropRight(-end):result.take(end-start)}return result};LazyWrapper.prototype.takeRightWhile=function(predicate){return this.reverse().takeWhile(predicate).reverse()};LazyWrapper.prototype.toArray=function(){return this.take(MAX_ARRAY_LENGTH)};baseForOwn(LazyWrapper.prototype,function(func,methodName){var checkIteratee=/^(?:filter|find|map|reject)|While$/.test(methodName),isTaker=/^(?:head|last)$/.test(methodName),lodashFunc=lodash[isTaker?"take"+(methodName=="last"?"Right":""):methodName],retUnwrapped=isTaker||/^find/.test(methodName);if(!lodashFunc){return}lodash.prototype[methodName]=function(){var value=this.__wrapped__,args=isTaker?[1]:arguments,isLazy=value instanceof LazyWrapper,iteratee=args[0],useLazy=isLazy||isArray(value);var interceptor=function(value){var result=lodashFunc.apply(lodash,arrayPush([value],args));return isTaker&&chainAll?result[0]:result};if(useLazy&&checkIteratee&&typeof iteratee=="function"&&iteratee.length!=1){isLazy=useLazy=false}var chainAll=this.__chain__,isHybrid=!!this.__actions__.length,isUnwrapped=retUnwrapped&&!chainAll,onlyLazy=isLazy&&!isHybrid;if(!retUnwrapped&&useLazy){value=onlyLazy?value:new LazyWrapper(this);var result=func.apply(value,args);result.__actions__.push({func:thru,args:[interceptor],thisArg:undefined});return new LodashWrapper(result,chainAll)}if(isUnwrapped&&onlyLazy){return func.apply(this,args)}result=this.thru(interceptor);return isUnwrapped?isTaker?result.value()[0]:result.value():result}});arrayEach(["pop","push","shift","sort","splice","unshift"],function(methodName){var func=arrayProto[methodName],chainName=/^(?:push|sort|unshift)$/.test(methodName)?"tap":"thru",retUnwrapped=/^(?:pop|shift)$/.test(methodName);lodash.prototype[methodName]=function(){var args=arguments;if(retUnwrapped&&!this.__chain__){var value=this.value();return func.apply(isArray(value)?value:[],args)}return this[chainName](function(value){return func.apply(isArray(value)?value:[],args)})}});baseForOwn(LazyWrapper.prototype,function(func,methodName){var lodashFunc=lodash[methodName];if(lodashFunc){var key=lodashFunc.name+"",names=realNames[key]||(realNames[key]=[]);names.push({name:methodName,func:lodashFunc})}});realNames[createHybrid(undefined,WRAP_BIND_KEY_FLAG).name]=[{name:"wrapper",func:undefined}];LazyWrapper.prototype.clone=lazyClone;LazyWrapper.prototype.reverse=lazyReverse;LazyWrapper.prototype.value=lazyValue;lodash.prototype.at=wrapperAt;lodash.prototype.chain=wrapperChain;lodash.prototype.commit=wrapperCommit;lodash.prototype.next=wrapperNext;lodash.prototype.plant=wrapperPlant;lodash.prototype.reverse=wrapperReverse;lodash.prototype.toJSON=lodash.prototype.valueOf=lodash.prototype.value=wrapperValue;lodash.prototype.first=lodash.prototype.head;if(symIterator){lodash.prototype[symIterator]=wrapperToIterator}return lodash};var _=runInContext();if(typeof define=="function"&&typeof define.amd=="object"&&define.amd){root._=_;define(function(){return _})}else if(freeModule){(freeModule.exports=_)._=_;freeExports._=_}else{root._=_}}).call(this)}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],4:[function(require,module,exports){exports.readFile=function(filename,callback){var xhr=new XMLHttpRequest;xhr.open("GET",filename);xhr.responseType="arraybuffer";xhr.onload=function(){callback(xhr.response)};xhr.onerror=function(e){throw e};xhr.send(null)}},{}],5:[function(require,module,exports){module.exports={input:[{type:"standard",controls:[{type:"keyboard",config:{z:"a",x:"b",shift:"select","return":"start",up:"up",down:"down",left:"left",right:"right"}},{type:"gamepad",config:{index:0,buttons:{0:"b",1:"a",2:"a",3:"b",8:"select",9:"start"},axes:{0:"horizontal",1:"vertical",4:"horizontal",5:"vertical"}}}]},{type:"standard",controls:{type:"gamepad",config:{index:1,buttons:{0:"b",1:"a",2:"a",3:"b",8:"select",9:"start"},axes:{0:"horizontal",1:"vertical",4:"horizontal",5:"vertical"}}}}]}},{}],6:[function(require,module,exports){var CPU=require("./system/cpu");var APU=require("./system/apu");var PPU=require("./system/ppu");var Cartridge=require("./system/cartridge");var Controllers=require("./system/controllers");var Output=require("./system/output");var Memory=require("./system/memory");var utils=require("./utils");var Input=require("./system/input");var config=require("./config.json");function System(el){this.config=config;this.frameEnded=false;this.tickAPU=false;this.controllers=new Controllers;this.input=new Input(this);this.output=new Output;if(el){this.output.video.setElement(el)}this.interval=null;this.running=false;this.paused=true;this.cartridge=null;this.cpu=null;this.apu=null;this.ppu=null;this.memory=null;Object.preventExtensions(this)}System.prototype={load:function(filename,autorun){var self=this;utils.readFile(filename,function(data){self.initCartridge(data);if(typeof autorun==="function"){autorun()}else if(autorun===true){self.run()}})},run:function(){if(this.interval){return}var self=this;this.interval=setInterval(function(){if(!self.paused){self.runFrame()}},1e3/60);this.output.video.run();this.running=true;this.paused=false},runFrame:function(){var cpu=this.cpu,ppu=this.ppu,apu=this.apu;while(!ppu.frameEnded){cpu.tick();ppu.tick();ppu.tick();ppu.tick();if(this.tickAPU){apu.tick()}this.tickAPU=!this.tickAPU}ppu.frameEnded=false},simulate:function(milliseconds){var i,frames=milliseconds/1e3*60;for(i=0;i<frames;i++){this.runFrame()}},play:function(){this.paused=false;if(!this.running){this.run()}},pause:function(){this.paused=true},toggle:function(){if(this.paused){this.play()}else{this.pause()}return this.paused},initCartridge:function(data){this.cartridge=new Cartridge(data,this);this.initCore();this.reset()},loadCartridge:function(cartridge){this.memory.loadCartridge(cartridge);this.ppu.memory.loadCartridge(cartridge)},initCore:function(){this.cpu=new CPU(this);this.apu=new APU(this);this.ppu=new PPU(this);this.memory=new Memory(this);this.loadCartridge(this.cartridge)},reset:function(){this.cpu.reset();this.apu.reset()}};module.exports=System},{"./config.json":5,"./system/apu":9,"./system/cartridge":13,"./system/controllers":14,"./system/cpu":16,"./system/input":19,"./system/memory":28,"./system/output":30,"./system/ppu":36,"./utils":4}],7:[function(require,module,exports){"use strict";function Channel(){this.enabled=false;this.lengthCounter=0;this.lengthCounterHalt=false;this.sample=0;this.volume=0;this.masterVolume=0;this.envelopeStart=true;this.envelopeLoop=false;this.envelopeCounter=0;this.envelopeDividerPeriod=0;this.envelopeDividerCount=0;this.envelopeDisabled=false}Channel.prototype={toggle:function(flag){if(flag){this.enable()}else{this.disable()}},disable:function(){this.enabled=false;this.lengthCounter=0},enable:function(){this.enabled=true},doLengthCounter:function(){if(this.lengthCounter&&!this.lengthCounterHalt){this.lengthCounter--}},setLengthCounter:function(value){if(this.enabled){this.lengthCounter=lengthCounterLookup[value]}},doEnvelope:function(){if(this.envelopeStart){this.envelopeStart=false;this.envelopeCounter=15;this.envelopeDividerCount=this.envelopeDividerPeriod}else{if(this.envelopeDividerCount){this.envelopeDividerCount-=1;if(this.envelopeDividerCount===0){if(this.envelopeCounter===0&&this.envelopeLoop){this.envelopeCounter=15}else if(this.envelopeCounter){this.envelopeCounter-=1}this.envelopeDividerCount=this.envelopeDividerPeriod}}else{this.envelopeCounter=0}}if(this.envelopeDisabled){this.masterVolume=this.volume}else{this.masterVolume=this.envelopeCounter}},setEnvelope:function(value){this.volume=value&15;this.lengthCounterHalt=this.envelopeLoop=!!(value&32);this.envelopeDisabled=!!(value&16);this.envelopeDividerPeriod=this.volume+1;this.envelopeStart=true}};var lengthCounterLookup=[10,254,20,2,40,4,80,6,160,8,60,10,14,12,26,14,12,16,24,18,48,20,96,22,192,24,72,26,16,28,32,30];module.exports=Channel},{}],8:[function(require,module,exports){"use strict";var Channel=require("./channel");function DMC(apu){this.apu=apu;this.timerMax=periodLookup[0];this.timer=this.period;this.silence=false;this.output=0;this.sampleAddress=0;this.sampleCurrentAddress=0;this.sampleLength=0;this.sampleBytesLeft=0;this.sampleBuffer=0;this.loop=false;this.interrupt=false;this.bitsLeft=8;this.shifter=0;this.irqEnabled=false;Channel.call(this);Object.preventExtensions(this)}DMC.prototype=new Channel;DMC.prototype.writeRegister=function(index,value){switch(index){case 0:this.irqEnabled=!!(value&128);if(!this.irqEnabled){this.interrupt=false}this.loop=!!(value&64);this.timerMax=this.timer=periodLookup[value&15]>>>1;break;case 1:this.output=value&127;break;case 2:this.sampleAddress=this.sampleCurrentAddress=49152|value<<6;break;case 3:this.sampleLength=this.sampleBytesLeft=value&&value<<4|1;break}};DMC.prototype.doTimer=function(){if(this.timerMax){this.timer--;if(this.timer<=0){if(!this.silence){if(this.shifter&1){this.output=Math.min(this.output+2,127)}else{this.output=Math.max(this.output-2,0)}this.sample=this.output}else{this.sample=0}this.shifter>>>=1;this.bitsLeft--;if(!this.bitsLeft){this.bitsLeft=8;this.silence=!this.sampleBytesLeft;if(!this.silence){this.readSample()}}this.timer+=this.timerMax}}if(this.irqEnabled&&this.interrupt){this.apu.system.cpu.requestIRQ()}};DMC.prototype.readSample=function(){this.shifter=this.sampleBuffer;this.sampleBuffer=this.apu.system.memory.read(this.sampleCurrentAddress);this.sampleCurrentAddress++;if(this.sampleCurrentAddress===65535){this.sampleCurrentAddress=32768}this.sampleBytesLeft--;if(!this.sampleBytesLeft){this.sampleCurrentAddress=this.sampleAddress;if(this.loop){this.sampleBytesLeft=this.sampleLength}else{this.interrupt=this.irqEnabled}}};var periodLookup=[428,380,340,320,286,254,226,214,190,160,142,128,106,84,72,54];module.exports=DMC},{"./channel":7}],9:[function(require,module,exports){"use strict";var Pulse=require("./pulse");var Triangle=require("./triangle");var Noise=require("./noise");var DMC=require("./dmc");function APU(system){this.system=system;this.output=system.output.audio;this.sampleCounter=0;this.sampleCounterMax=1789773/2/this.output.sampleRate;this.frameCounterMode=0;this.frameCounterInterrupt=false;this.frameCount=0;this.cycles=0;this.pulse1=new Pulse;this.pulse2=new Pulse;this.triangle=new Triangle;this.noise=new Noise;this.dmc=new DMC(this);Object.preventExtensions(this)}APU.prototype={reset:function(){this.writeStatus(0)},readRegister:function(address){if(address===21){return this.readStatus()}return 0},readStatus:function(){return!!this.pulse1.lengthCounter<<0|!!this.pulse2.lengthCounter<<1|!!this.triangle.lengthCounter<<2|!!this.noise.lengthCounter<<3|!!this.dmc.sampleBytesLeft<<4},writeRegister:function(address,value){if(address<4){this.pulse1.writeRegister(address,value)}else if(address<8){this.pulse2.writeRegister(address-4,value)}else if(address<12){this.triangle.writeRegister(address-8,value)}else if(address<16){this.noise.writeRegister(address-12,value)}else if(address<20){this.dmc.writeRegister(address-16,value)}else if(address===21){this.writeStatus(value)}else if(address===23){this.frameCounterMode=+!!(value&128);this.frameCounterInterrupt=!(value&64);this.cycles=0;if(this.frameCounterMode){this.doQuarterFrame();this.doHalfFrame()}}},writeStatus:function(value){this.pulse1.toggle(value&1);this.pulse2.toggle(value&2);this.triangle.toggle(value&4);this.noise.toggle(value&8)},tick:function(){switch(this.frameCounterMode){case 0:this.tick0();break;default:this.tick1()}this.cycles+=1;this.updateSample();return},tick0:function(){switch(this.cycles){case 3728:case 7457:case 11186:case 14915:this.doQuarterFrame();break}switch(this.cycles){case 7457:case 14915:this.doHalfFrame();break}if(this.cycles>=14915){this.cycles=0;if(this.frameCounterInterrupt){this.system.cpu.requestIRQ()}}},tick1:function(){switch(this.cycles){case 3729:case 7457:case 11186:case 18641:this.doQuarterFrame();break}switch(this.cycles){case 7457:case 18641:this.doHalfFrame();break}if(this.cycles>=18641){this.cycles=0}},doQuarterFrame:function(){this.pulse1.doEnvelope();this.pulse2.doEnvelope();this.noise.doEnvelope();this.triangle.doLinearCounter()},doHalfFrame:function(){this.pulse1.doSweep();this.pulse1.doLengthCounter();this.pulse2.doSweep();this.pulse2.doLengthCounter();this.triangle.doLengthCounter();this.noise.doLengthCounter()},updateSample:function(){var tndOut=0,pulseOut=0;this.pulse1.doTimer();this.pulse2.doTimer();this.triangle.doTimer();this.noise.doTimer();this.dmc.doTimer();if(this.output.enabled){if(this.sampleCounter>=this.sampleCounterMax){pulseOut=pulseTable[this.pulse1.sample+this.pulse2.sample];tndOut=tndTable[3*this.triangle.sample+2*this.noise.sample+this.dmc.sample];this.output.writeSample(pulseOut+tndOut);this.sampleCounter-=this.sampleCounterMax}this.sampleCounter+=1}}};var i=0;var pulseTable=new Float32Array(31);for(i=0;i<31;i++){pulseTable[i]=95.52/(8128/i+100)}var tndTable=new Float32Array(203);for(i=0;i<203;i++){tndTable[i]=163.67/(24329/i+100)}module.exports=APU},{"./dmc":8,"./noise":10,"./pulse":11,"./triangle":12}],10:[function(require,module,exports){"use strict";var Channel=require("./channel");function Noise(){this.shift=1;this.mode=0;this.timerMax=periodLookup[0];this.timer=this.period;this.index=3;Channel.call(this);Object.preventExtensions(this)}Noise.prototype=new Channel;Noise.prototype.doTimer=function(){var feedback=0,otherBit=0;if(this.timerMax){if(this.timer){this.timer--}else{if(this.mode){otherBit=(this.shift&64)>>6}else{otherBit=(this.shift&2)>>1}feedback=(this.shift^otherBit)&1;this.shift>>>=1;this.shift|=feedback<<14;if(this.lengthCounter&&!(this.shift&1)){this.sample=this.masterVolume}else{this.sample=0}this.timer+=this.timerMax}}};Noise.prototype.writeRegister=function(index,value){switch(index){case 0:this.setEnvelope(value);break;case 1:break;case 2:this.mode=(value&128)>>>7;this.timerMax=this.timer=periodLookup[value&15];break;case 3:this.setLengthCounter(value>>>3);this.envelopeStart=true;break}};var periodLookup=[4,8,16,32,64,96,128,160,202,254,380,508,762,1016,2034,4068];module.exports=Noise},{"./channel":7}],11:[function(require,module,exports){"use strict";var Channel=require("./channel");function Pulse(){this.timerMax=0;this.timer=0;this.duty=0;this.sweepStart=true;this.sweepEnabled=false;this.sweepDividerPeriod=0;this.sweepDividerCount=0;this.sweepNegate=false;this.sweepShiftCount=0;this.pulseCounter=0;this.silence=false;Channel.call(this);Object.preventExtensions(this)}Pulse.prototype=new Channel;Pulse.prototype.doSweep=function(){var adjustPulse=!this.sweepDividerCount,timerDelta=0,targetTimer=0;if(this.sweepStart){this.sweepDividerCount=this.sweepDividerPeriod;this.sweepStart=false}if(adjustPulse){if(this.sweepShiftCount){timerDelta=this.timerMax>>>this.sweepShiftCount}if(this.sweepNegate){timerDelta=-timerDelta}targetTimer=this.timerMax+timerDelta;if(this.timerMax>=8&&this.timerMax<=2047){if(this.sweepEnabled){this.timerMax=targetTimer}this.silence=false}else{this.silence=true}this.sweepDividerCount=this.sweepDividerPeriod}else if(this.sweepDividerCount){this.sweepDividerCount--}};Pulse.prototype.doTimer=function(){if(!this.silence&&this.lengthCounter&&this.timerMax){if(this.timer){this.timer--}else{this.timer+=this.timerMax;this.pulseCounter=this.pulseCounter+1&7;this.sample=pulseDutyLookup[(this.duty<<3)+this.pulseCounter]*this.masterVolume}}else{this.sample=0}};Pulse.prototype.writeRegister=function(index,value){switch(index){case 0:this.duty=(value&192)>>6;this.setEnvelope(value);break;case 1:this.sweepStart=true;this.sweepEnabled=!!(value&128);this.sweepDividerPeriod=((value&112)>>4)+1;this.sweepNegate=!!(value&8);this.sweepShiftCount=value&7;break;case 2:this.timer=this.timerMax=this.timerMax&~255|value;break;case 3:this.timer=this.timerMax=this.timerMax&~65280|(value&7)<<8;this.setLengthCounter(value>>>3);this.envelopeStart=true;this.pulseCounter=0;break}this.silence=this.timerMax<8};var pulseDutyLookup=[0,1,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,1,1,1,1,0,0,0,1,0,0,1,1,1,1,1];module.exports=Pulse},{"./channel":7}],12:[function(require,module,exports){"use strict";var Channel=require("./channel");function Triangle(){this.linearCounter=0;this.linearCounterMax=0;this.linearCounterControl=false;this.linearCounterStart=false;this.timerMax=0;this.timer=0;this.sequenceCounter=0;Channel.call(this);Object.preventExtensions(this)}Triangle.prototype=new Channel;Triangle.prototype.doLinearCounter=function(){if(this.linearCounterStart){this.linearCounter=this.linearCounterMax}else if(this.linearCounter){this.linearCounter--}if(!this.linearCounterControl){this.linearCounterStart=false}};Triangle.prototype.doTimer=function(){if(this.timerMax){this.timer-=2;if(this.timer<=0){this.timer+=this.timerMax;this.sequenceCounter=this.sequenceCounter+1&31;this.sample=sequence[this.sequenceCounter]}}if(!this.lengthCounter||!this.linearCounter){this.sample=0}};Triangle.prototype.writeRegister=function(index,value){switch(index){case 0:this.linearCounterMax=value&~128;this.lengthCounterHalt=this.linearCounterControl=!!(value&128);break;case 1:break;case 2:this.timer=this.timerMax=this.timerMax&~255|value;break;case 3:this.timer=this.timerMax=this.timerMax&~65280|(value&7)<<8;this.setLengthCounter(value>>>3);this.linearCounterStart=true;break}};var sequence=[15,14,13,12,11,10,9,8,7,6,5,4,3,2,1,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15];module.exports=Triangle},{"./channel":7}],13:[function(require,module,exports){"use strict";var mappers=require("./mappers");var HORIZONTAL=0,VERTICAL=1,FOUR_SCREEN=2,SINGLE_SCREEN_LOWER=3,SINGLE_SCREEN_UPPER=4;function Cartridge(data,system){this.system=system;this.raw=data;this.data=new Uint8Array(data,16,data.byteLength-16);this.header=new Uint8Array(data,0,16);this.validate();this.initHeader();this.initData();Object.preventExtensions(this)}Cartridge.prototype={validate:function(){if(!(this.header[0]===78&&this.header[1]===69&&this.header[2]===83&&this.header[3]===26)){throw new Error("Invalid ROM!")}if(this.header[7]&14){throw new Error("Bit 1-3 of byte 7 in ROM header must all be zeroes!")}if(this.header[9]&254){throw new Error("Bit 1-7 of byte 9 in header must all be zeroes!")}var i;for(i=10;i<=15;i++){if(this.header[i]){throw new Error("Byte "+i+" in ROM header must be zero.")}}if(this.header[6]&4){
throw new Error("Trained ROMs are not supported")}},initHeader:function(){var flags6=this.header[6];this.mirroring=flags6&1?VERTICAL:HORIZONTAL;this.battery=flags6&2;this.trainer=flags6&4;this.mirroring=flags6&8?FOUR_SCREEN:this.mirroring;var flags7=this.header[7];this.vs=flags7&1;this.mapper=(flags6&240)>>4|flags7&240;this.pal=this.header[9]&1},initData:function(){this.prgBanks=this.header[4];this.chrBanks=this.header[5];this.ramBanks=this.header[8]||1;this.prgSize=this.prgBanks*16*1024;this.chrSize=this.chrBanks*8*1024;this.ramSize=this.ramBanks*8*1024;this.prgData=this.data.subarray(0,this.prgSize);if(this.chrBanks){this.chrData=this.data.subarray(this.prgSize,this.prgSize+this.chrSize)}else{this.chrData=new Uint8Array(8192)}this.ramData=new Uint8Array(this.ramSize);this.initMapper()},initMapper:function(){this.prgRead=new Uint8Array(32768);this.prgRead.set(this.prgData.subarray(0,8192));this.chrRead=new Uint8Array(8192);this.chrRead.set(this.chrData.subarray(0,8192));mappers.init(this)},writeRegister:function(address,value){return},readPRG:function(address){if(address&32768){return this.prgRead[address&32767]}else if(address>=24576){return this.ramData[address-24576]}return 0},writePRG:function(address,value){if(address&32768){this.writeRegister(address,value)}else if(address>=24576){this.ramData[address-24576]=value}return},loadPRGBank:function(address,bank,size){var offset=bank*size,bankData=this.prgData.subarray(offset,offset+size);this.prgRead.set(bankData,address-32768)},readCHR:function(address){return this.chrRead[address]},writeCHR:function(address,value){if(!this.chrBanks){this.chrRead[address]=value}return value},readTile:function(baseTable,tileIndex,y){var tileAddress=(tileIndex<<4)+baseTable+y;return this.readCHR(tileAddress)<<8|this.readCHR(tileAddress+8)},loadCHRBank:function(address,bank,size){var offset=bank*size,bankData=this.chrData.subarray(offset,offset+size);this.chrRead.set(bankData,address)},getNameTableAddress:function(address){switch(this.mirroring){case HORIZONTAL:if(address>=1024){address-=1024}if(address>=2048){address-=1024}break;case VERTICAL:address&=2047;break;case FOUR_SCREEN:throw new Error("TODO, four screen mirroring");case SINGLE_SCREEN_LOWER:case SINGLE_SCREEN_UPPER:address&=1023;if(this.mirroring===4){address+=1024}break}return address},readNameTable:function(address){return this.system.ppu.ram[this.getNameTableAddress(address)]},writeNameTable:function(address,value){this.system.ppu.ram[this.getNameTableAddress(address)]=value}};module.exports=Cartridge},{"./mappers":22}],14:[function(require,module,exports){var CONTROLLER_COUNT=2;function Controllers(system){this.system=system;this.controller0=new NoController;this.controller1=new NoController;this.controllers=new Array(CONTROLLER_COUNT);this.strobe=0}Controllers.prototype={get:function(index){if(index){return this.controller1}else{return this.controller0}},connect:function(index,controller){if(index){this.controller1=controller}else{this.controller0=controller}},read:function(index){return this.get(index).read()},write:function(value){var strobe=value&1;this.controller0.setStrobe(strobe);this.controller1.setStrobe(strobe)}};function NoController(){}NoController.prototype={read:function(index){return 0},setStrobe:function(){}};module.exports=Controllers},{}],15:[function(require,module,exports){"use strict";function StandardController(){this.data=0;this.mask=0;this.strobe=0;Object.preventExtensions(this)}StandardController.prototype={press:function(button){this._press(getBitMask(button))},depress:function(button){this._depress(getBitMask(button))},_press:function(bitmask){if(bitmask&3){this._depress(3)}else if(bitmask&12){this._depress(12)}this.data|=bitmask},_depress:function(bitmask){this.data&=~bitmask},read:function(){if(!this.mask){return 1}var result=this.data&this.mask;if(!this.strobe){this.mask>>=1}return+!!result},setStrobe:function(value){if(value){this.mask=128}this.strobe=value}};function getBitMask(button){return buttonMap[button.toLowerCase()]||0}var buttonMap={a:128,b:64,select:32,start:16,up:8,down:4,left:2,right:1};module.exports=StandardController},{}],16:[function(require,module,exports){function CPU(system){"use strict";var address,writeToA,op,cyclesBurnt=0,A=0,X=0,Y=0,SP=0,PC=32768,P=0,debugPC=PC,delayInterrupt=false,flagI=false,flagB=true,flagC=false,flagN=true,flagD=false,flagV=false,flagZ=false,irqRequested=false,nmiRequested=false,LOW=255,HIGH=65280;var VECTOR_NMI=65530,VECTOR_RESET=65532,VECTOR_IRQ=65534;function reset(){interrupt(VECTOR_RESET)}function requestNMI(){nmiRequested=true}function requestIRQ(){irqRequested=true}function doNMI(){interrupt(VECTOR_NMI);nmiRequested=false}function doIRQ(){interrupt(VECTOR_IRQ);irqRequested=false}function interrupt(vector){push((PC&HIGH)>>8);push(PC&LOW);setP();push(P);flagI=1;PC=peekWord(vector);burn(7)}function burn(cycles){cyclesBurnt+=cycles}function tick(){cyclesBurnt-=1;if(cyclesBurnt>0){return}cyclesBurnt=0;setP();if(irqRequested&&!flagI){doIRQ()}op=peek(PC);execute(op);if(nmiRequested){doNMI()}delayInterrupt=false}function execute(op){writeToA=0;address=983040;debugPC=PC;switch(op){case 62:absoluteIndexedX();ROL();burn(7);break;case 61:absoluteIndexedX();AND();burn(4);break;case 133:zeroPage();STA();burn(3);break;case 132:zeroPage();STY();burn(3);break;case 40:implied();PLP();burn(4);break;case 41:immediate();AND();burn(2);break;case 248:implied();SED();burn(2);break;case 249:absoluteIndexedY();SBC();burn(4);break;case 246:zeroPageIndexedX();INC();burn(6);break;case 32:absolute();JSR();burn(6);break;case 33:indexedIndirectX();AND();burn(6);break;case 38:zeroPage();ROL();burn(5);break;case 134:zeroPage();STX();burn(3);break;case 36:zeroPage();BIT();burn(3);break;case 37:zeroPage();AND();burn(2);break;case 53:zeroPageIndexedX();AND();burn(3);break;case 54:zeroPageIndexedX();ROL();burn(6);break;case 49:indirectIndexedY();AND();burn(5);break;case 48:relative();BMI();burn(2);break;case 57:absoluteIndexedY();AND();burn(4);break;case 56:implied();SEC();burn(2);break;case 140:absolute();STY();burn(4);break;case 44:absolute();BIT();burn(4);break;case 253:absoluteIndexedX();SBC();burn(4);break;case 254:absoluteIndexedX();INC();burn(7);break;case 45:absolute();AND();burn(4);break;case 46:absolute();ROL();burn(6);break;case 186:implied();TSX();burn(2);break;case 94:absoluteIndexedX();LSR();burn(7);break;case 93:absoluteIndexedX();EOR();burn(4);break;case 64:implied();RTI();burn(6);break;case 65:indexedIndirectX();EOR();burn(6);break;case 69:zeroPage();EOR();burn(3);break;case 70:zeroPage();LSR();burn(5);break;case 72:implied();PHA();burn(3);break;case 73:immediate();EOR();burn(2);break;case 174:absolute();LDX();burn(4);break;case 173:absolute();LDA();burn(4);break;case 172:absolute();LDY();burn(4);break;case 170:implied();TAX();burn(2);break;case 74:accumulator();LSR();burn(2);break;case 76:absolute();JMP();burn(3);break;case 77:absolute();EOR();burn(4);break;case 78:absolute();LSR();burn(6);break;case 81:indirectIndexedY();EOR();burn(5);break;case 80:relative();BVC();burn(2);break;case 86:zeroPageIndexedX();LSR();burn(6);break;case 85:zeroPageIndexedX();EOR();burn(4);break;case 154:implied();TXS();burn(2);break;case 229:zeroPage();SBC();burn(3);break;case 89:absoluteIndexedY();EOR();burn(4);break;case 88:implied();CLI();burn(2);break;case 42:accumulator();ROL();burn(2);break;case 169:immediate();LDA();burn(2);break;case 168:implied();TAY();burn(2);break;case 166:zeroPage();LDX();burn(3);break;case 165:zeroPage();LDA();burn(3);break;case 162:immediate();LDX();burn(2);break;case 161:indexedIndirectX();LDA();burn(6);break;case 160:immediate();LDY();burn(2);break;case 164:zeroPage(0);LDY();burn(3);break;case 245:zeroPageIndexedX();SBC();burn(4);break;case 126:absoluteIndexedX();ROR();burn(7);break;case 125:absoluteIndexedX();ADC();burn(4);break;case 240:relative();BEQ();burn(2);break;case 104:implied();PLA();burn(4);break;case 105:immediate();ADC();burn(2);break;case 102:zeroPage();ROR();burn(5);break;case 101:zeroPage();ADC();burn(3);break;case 96:implied();RTS();burn(6);break;case 97:indexedIndirectX();ADC();burn(6);break;case 206:absolute();DEC();burn(6);break;case 205:absolute();CMP();burn(4);break;case 184:implied();CLV();burn(2);break;case 185:absoluteIndexedY();LDA();burn(4);break;case 202:implied();DEX();burn(2);break;case 204:absolute();CPY();burn(4);break;case 176:relative();BCS();burn(2);break;case 177:indirectIndexedY();LDA();burn(5);break;case 182:zeroPageIndexedY();LDX();burn(4);break;case 180:zeroPageIndexedX();LDY();burn(4);break;case 181:zeroPageIndexedX();LDA();burn(4);break;case 138:implied();TXA();burn(2);break;case 109:absolute();ADC();burn(4);break;case 110:absolute();ROR();burn(6);break;case 108:indirect();JMP();burn(5);break;case 106:accumulator();ROR();burn(2);break;case 121:absoluteIndexedY();ADC();burn(4);break;case 120:implied();SEI();burn(2);break;case 113:indirectIndexedY();ADC();burn(5);break;case 112:relative();BVS();burn(2);break;case 117:zeroPageIndexedX();ADC();burn(4);break;case 118:zeroPageIndexedX();ROR();burn(6);break;case 197:zeroPage();CMP();burn(3);break;case 196:zeroPage();CPY();burn(3);break;case 198:zeroPage();DEC();burn(5);break;case 193:indexedIndirectX();CMP();burn(6);break;case 192:immediate();CPY();burn(2);break;case 188:absoluteIndexedX();LDY();burn(4);break;case 228:zeroPage();CPX();burn(3);break;case 201:immediate();CMP();burn(2);break;case 200:implied();INY();burn(2);break;case 189:absoluteIndexedX();LDA();burn(4);break;case 190:absoluteIndexedY();LDX();burn(4);break;case 241:indirectIndexedY();SBC();burn(5);break;case 233:immediate();SBC();burn(2);break;case 208:relative();BNE();burn(2);break;case 209:indirectIndexedY();CMP();burn(5);break;case 157:absoluteIndexedX();STA();burn(5);break;case 8:implied();PHP();burn(3);break;case 213:zeroPageIndexedX();CMP();burn(4);break;case 214:zeroPageIndexedX();DEC();burn(6);break;case 216:implied();CLD();burn(2);break;case 217:absoluteIndexedY();CMP();burn(4);break;case 6:zeroPage();ASL();burn(5);break;case 0:implied();BRK();burn(7);break;case 1:indexedIndirectX();ORA();burn(6);break;case 236:absolute();CPX();burn(4);break;case 5:zeroPage();ORA();burn(2);break;case 234:implied();NOP();burn(2);break;case 129:indexedIndirectX();STA();burn(6);break;case 238:absolute();INC();burn(6);break;case 237:absolute();SBC();burn(4);break;case 30:absoluteIndexedX();ASL();burn(7);break;case 29:absoluteIndexedX();ORA();burn(4);break;case 136:implied();DEY();burn(2);break;case 9:immediate();ORA();burn(2);break;case 141:absolute();STA();burn(4);break;case 142:absolute();STX();burn(4);break;case 225:indexedIndirectX();SBC();burn(6);break;case 224:immediate();CPX();burn(2);break;case 230:zeroPage();INC();burn(5);break;case 25:absoluteIndexedY();ORA();burn(4);break;case 24:implied();CLC();burn(2);break;case 22:zeroPageIndexedX();ASL();burn(6);break;case 21:zeroPageIndexedX();ORA();burn(3);break;case 232:implied();INX();burn(2);break;case 17:indirectIndexedY();ORA();burn(5);break;case 16:relative();BPL();burn(2);break;case 150:zeroPageIndexedY();STX();burn(4);break;case 149:zeroPageIndexedX();STA();burn(4);break;case 148:zeroPageIndexedX();STY();burn(4);break;case 221:absoluteIndexedX();CMP();burn(4);break;case 222:absoluteIndexedX();DEC();burn(7);break;case 145:indirectIndexedY();STA();burn(6);break;case 144:relative();BCC();burn(2);break;case 13:absolute();ORA();burn(4);break;case 14:absolute();ASL();burn(6);break;case 10:accumulator();ASL();burn(2);break;case 153:absoluteIndexedY();STA();burn(5);break;case 152:implied();TYA();burn(2);break;default:PC+=1}}function read(){if(!writeToA&&address===983040){throw new Error("invalid read")}if(writeToA){return A}else{return peek(address)}}function modRead(){return write(read())}function write(value){if(writeToA){writeA(value)}else{poke(address,value)}if(value>255){throw new Error("invalid write")}return value}function writeA(value){A=value}function implied(){PC+=1}function accumulator(){writeToA=1;PC+=1}function immediate(){address=PC+1;PC+=2}function relative(){address=PC+1;PC+=2}function absolute(){var high=peek(PC+2)<<8,low=peek(PC+1);address=high|low;PC+=3}function zeroPage(index){var base=peek(PC+1);index=index||0;address=base+index&255;PC+=2}function absoluteIndexed(index){var high=peek(PC+2)<<8,low=peek(PC+1),base=high|low;address=base+index&65535;if(low+X&65280){burn(1)}PC+=3}function absoluteIndexedX(){absoluteIndexed(X)}function absoluteIndexedY(){absoluteIndexed(Y)}function zeroPageIndexedX(){zeroPage(X)}function zeroPageIndexedY(){zeroPage(Y)}function indirect(){var lowAddress=peekWord(PC+1),highAddress=lowAddress+1,low=0,high=0;if((lowAddress&255)===255){highAddress=lowAddress-255}low=peek(lowAddress);high=peek(highAddress)<<8;address=high|low;PC+=3}function indexedIndirectX(){var peeked=peek(PC+1),newAddress=peeked+X,low=peek(newAddress&255),high=peek(newAddress+1&255)<<8;address=high|low;if((peeked&65280)!==(newAddress&65280)){burn(1)}PC+=2}function indirectIndexedY(){var newAddress=peek(PC+1),low=peek(newAddress),high=peek(newAddress+1&255)<<8;address=(high|low)+Y&65535;PC+=2}function ADC(){doADC(read())}function doADC(value){var t=A+value+flagC;flagV=!!((A^t)&(value^t)&128)&&1;flagN=!!(t&128);flagC=t>255;flagZ=!(t&255);writeA(t&255)}function AND(){var value=read();if(value===4){value=value}writeA(A&value);flagN=A&128&&1;flagZ=+(A===0)}function ASL(){var value=modRead(),result=write(value<<1&254);flagC=value&128&&1;flagN=result&128&&1;flagZ=+(result===0)}function BCS(){branch(flagC)}function BCC(){branch(!flagC)}function BEQ(){branch(flagZ)}function BNE(){branch(!flagZ)}function BMI(){branch(flagN)}function BPL(){branch(!flagN)}function BVS(){branch(flagV)}function BVC(){branch(!flagV)}function branch(flag){var offset=read(),prevHigh=PC&HIGH,curHigh=0;if(flag){burn(1);if(offset&128){offset=-complement(offset)}PC+=offset;curHigh=PC&HIGH;if(prevHigh!==curHigh){burn(1)}}}function BIT(){var value=read(),t=A&value;flagN=value&128&&1;flagV=value&64&&1;flagZ=+(t===0)}function BRK(){var high,low;PC+=1;push((PC&HIGH)>>8);push(PC&LOW);setP();push(P|16);low=peek(65534);high=peek(65535)<<8;PC=high|low}function CLC(){flagC=0}function CLD(){flagD=0}function CLI(){flagI=0;delayInterrupt=true}function CLV(){flagV=0}function CMP(){xCMP(A)}function CPX(){xCMP(X)}function CPY(){xCMP(Y)}function xCMP(value){var readValue=read(),t=value-readValue&255;flagN=t&128&&1;flagC=+(value>=readValue);flagZ=+(t===0)}function DEC(){var result=write(modRead()-1&255);flagN=+!!(result&128);flagZ=+(result===0)}function DEX(){X=X-1&255;flagZ=+(X===0);flagN=X&128&&1}function DEY(){Y=Y-1&255;flagZ=+(Y===0);flagN=Y&128&&1}function EOR(){writeA(A^read());flagN=A&128&&1;flagZ=+(A===0)}function INC(){var result=write(modRead()+1&255);flagN=!!(result&128);flagZ=result===0}function INX(){X=X+1&255;flagN=X&128&&1;flagZ=+(X===0)}function INY(){Y=Y+1&255;flagN=Y&128&&1;flagZ=+(Y===0)}function JMP(){PC=address}function JSR(){var t=PC-1;push((t&HIGH)>>8);push(t&LOW);PC=address}function LDA(){var value=read();writeA(value);flagN=A&128&&1;flagZ=+(A===0)}function LDX(){X=read();flagN=X&128&&1;flagZ=+(X===0)}function LDY(){Y=read();flagN=Y&128&&1;flagZ=+(Y===0)}function LSR(){var value=modRead();flagN=0;flagC=value&1&&1;var result=write(value>>>1&255);flagZ=+(result===0)}function NOP(){}function ORA(){writeA(A|read());flagN=A&128&&1;flagZ=+(A===0)}function PHA(){push(A)}function PHP(){setP();push(P|16)}function PLA(){writeA(pop());flagN=A&128&&1;flagZ=+(A===0)}function PLP(){P=pop();setFlags()}function ROL(){var value=modRead(),result=value<<1&254;result=write(result|flagC);flagC=value&128&&1;flagZ=+(result===0);flagN=result&128&&1}function ROR(){var value=modRead(),result=value>>>1&255;result=write(result|(flagC?128:0));flagC=value&1;flagZ=+(result===0);flagN=result&128&&1}function RTI(){var low,high;P=pop();setFlags();low=pop();high=pop()<<8;PC=high|low}function RTS(){var low,high;low=pop();high=pop()<<8;PC=(high|low)+1}function SBC(){doADC(read()^255)}function SEC(){flagC=1}function SED(){flagD=1}function SEI(){flagI=1}function STA(){write(A)}function STX(){write(X)}function STY(){write(Y)}function TAX(){X=A;flagN=X&128&&1;flagZ=+(X===0)}function TAY(){Y=A;flagN=Y&128&&1;flagZ=+(Y===0)}function TSX(){X=SP;flagN=X&128&&1;flagZ=+(X===0)}function TXA(){writeA(X);flagN=A&128&&1;flagZ=+(A===0)}function TXS(){SP=X}function TYA(){writeA(Y);flagN=A&128&&1;flagZ=+(A===0)}function poke(index,value){system.memory.write(index,value)}function peek(index){return system.memory.read(index)}function peekWord(index){var low=peek(index),high=peek(index+1&65535)<<8;return low|high}function pop(){SP=SP+1&255;var result=peek(SP|256);return result}function push(value){poke(SP|256,value);SP=SP-1&255}function complement(value){return(~value&255)+1}function setFlags(){flagN=!!(P&128);flagV=!!(P&64);flagB=!!(P&16);flagD=!!(P&8);flagI=!!(P&4);flagZ=!!(P&2);flagC=!!(P&1)}function setP(){P=flagN<<7|flagV<<6|32|flagB<<4|flagD<<3|flagI<<2|flagZ<<1|flagC}function setPC(value){PC=value}function resetCycles(){cyclesBurnt=0}function getCycles(){return cyclesBurnt}this.burn=burn;this.reset=reset;this.tick=tick;this.setPC=setPC;this.requestNMI=requestNMI;this.requestIRQ=requestIRQ;this.getCycles=getCycles;this.resetCycles=resetCycles;this.execute=execute}module.exports=CPU},{}],17:[function(require,module,exports){function ControllerHandler(controller,config){this.controller=controller;if(config){this.configure(config)}this.initialize();this.enabled=false;this._pressed={}}ControllerHandler.prototype={initialize:function(){},configure:function(config){this.config=config;this._configure()},_configure:function(){},enable:function(){if(this.isSupported()&&!this.enabled){this.enabled=true;this._enable()}},_enable:function(){},disable:function(){if(this.enabled){this.enabled=false;this._disable()}},_disable:function(){},isSupported:function(){return true},press:function(button){this._pressed[button]=true;this.controller.press(button)},depress:function(button){if(button in this._pressed){delete this._pressed[button];this.controller.depress(button)}}};ControllerHandler.extend=function(proto){Handler=function(controller,config){ControllerHandler.call(this,controller,config)};Handler.prototype=Object.create(ControllerHandler.prototype);for(var key in proto){Handler.prototype[key]=proto[key]}return Handler};module.exports=ControllerHandler},{}],18:[function(require,module,exports){var ControllerHandler=require("./controllerhandler");var Gamepad=ControllerHandler.extend({_configure:function(){this.config.index=this.config.index||0},_enable:function(){this.initConnection()},_disable:function(){this.clearConnection();this.stopListening()},isSupported:function(){return typeof window!=="undefined"&&window.navigator&&"getGamepads"in window.navigator},initConnection:function(){if(this._connected||!this.enabled){return}var input=this;this.checkConnectionInterval=setInterval(function(){if(input.initGamepad()){input.clearConnection()}},50)},clearConnection:function(){if(this.checkConnectionInterval){clearInterval(this.checkConnectionInterval);this.checkConnectionInterval=null}},initGamepad:function(){if(this._connected){return}var gamepad=navigator.getGamepads()[this.config.index];if(gamepad){this.startListening();return true}return false},startListening:function(){this._connected=true;var input=this;requestAnimationFrame(function listen(){var gamepad=navigator.getGamepads()[input.config.index];if(gamepad&&gamepad.connected){input.handleButtons(gamepad);input.handleAxes(gamepad);requestAnimationFrame(listen)}else{input.stopListening()}})},stopListening:function(){this._connected=false;this.initConnection()},handleButtons:function(gamepad){var button,index,pressed={},buttonConfig=this.config.buttons,buttons=gamepad.buttons;for(index in buttonConfig){pressed[buttonConfig[index]]=false}for(index=0;index<buttons.length;index++){button=buttonConfig[index];if(button){pressed[button]=pressed[button]||buttons[index].pressed}}for(button in pressed){if(pressed[button]){this.press(button)}else{this.depress(button)}}},handleAxes:function(gamepad){var axis,value,directions,axisMap={vertical:["up","down"],horizontal:["left","right"]},axisUsed={},axesConfig=this.config.axes,axes=gamepad.axes;for(axis in axisMap){axisUsed[axis]=false}for(var index=0;index<axes.length;index++){axis=axesConfig[index];value=axes[index];if(axis&&value){axisUsed[axis]=true;directions=axisMap[axis];this.press(value<0?directions[0]:directions[1]);this.depress(value<0?directions[1]:directions[0])}}for(axis in axisUsed){if(axisUsed[axis]){continue}directions=axisMap[axis];for(index=0;index<directions.length;index++){this.depress(directions[index])}}}});module.exports=Gamepad},{"./controllerhandler":17}],19:[function(require,module,exports){var Gamepad=require("./gamepad");var Keyboard=require("./keyboard");var StandardController=require("../controllers/standardcontroller");function Input(system){this.system=system;this.controllers=system.controllers;this.inputHandlers=new Array(2);this.initConfig();if(typeof window!=="undefined"){this.enable()}}Input.prototype={enable:function(){this._setEnabled(true)},disable:function(){this._setEnabled(false)},_setEnabled:function(enabled){var handlers,type,method=enabled?"enable":"disable";this._enabled=enabled;for(var i=0;i<this.inputHandlers.length;i++){handlers=this.inputHandlers[i];if(handlers){for(type in handlers){handlers[type][method]()}}}},initConfig:function(){var i,j,item,controls,config=this.config=this.system.config.input;for(i=0;i<config.length;i++){item=config[i];this.setController(i,item.type);controls=item.controls;if(!Array.isArray(controls)){controls=[controls]}for(j=0;j<controls.length;j++){this.configure(i,controls[j].type,controls[j].config)}}},setController:function(index,type){var Controller=controllerMap[type];this.controllers.connect(index,new Controller)},configure:function(index,type,config){var currentHandler,InputHandler=inputHandlerMap[type],controller=this.controllers.get(index);this.initInputHandlers(index);currentHandler=this.inputHandlers[index][type];if(currentHandler){currentHandler.disable()}this.inputHandlers[index][type]=new InputHandler(controller,config);if(this._enabled){this.inputHandlers[index][type].enable()}},initInputHandlers:function(index){this.inputHandlers[index]=this.inputHandlers[index]||{}}};var controllerMap={standard:StandardController};var inputHandlerMap={gamepad:Gamepad,keyboard:Keyboard};module.exports=Input},{"../controllers/standardcontroller":15,"./gamepad":18,"./keyboard":20}],20:[function(require,module,exports){var ControllerHandler=require("./controllerhandler");var Keyboard=ControllerHandler.extend({initialize:function(){this.handlers={}},_configure:function(){this.initKeyCodes()},_enable:function(){this.bindHandler("keydown");this.bindHandler("keyup")},_disable:function(){this.unbindHandler("keydown");this.unbindHandler("keyup")},bindHandler:function(type){window.addEventListener(type,this.getHandler(type))},unbindHandler:function(type){window.removeEventListener(type,this.getHandler(type))},getHandler:function(type){if(this.handlers[type]){return this.handlers[type]}var self=this,handler=type==="keydown"?"press":"depress";this.handlers[type]=function(e){var keyCode=e.keyCode;if(keyCode in self.keyCodes){self[handler](self.keyCodes[keyCode]);e.preventDefault()}};return this.handlers[type]},initKeyCodes:function(){var name,keyCode,keyCodes={};for(name in this.config){if(name in keyCodeMap){keyCode=keyCodeMap[name]}else{keyCode=name.toUpperCase().charCodeAt()}keyCodes[keyCode]=this.config[name]}this.keyCodes=keyCodes}});var keyCodeMap={backspace:8,tab:9,"return":13,shift:16,ctrl:17,alt:18,capslock:20,space:32,left:37,up:38,right:39,down:40};module.exports=Keyboard},{"./controllerhandler":17}],21:[function(require,module,exports){module.exports={init:function(){this.axRomBanks=this.prgBanks>>1;this.setPrgBank(0)},setPrgBank:function(bank){this.prgBank=bank;this.loadPRGBank(32768,bank,32768)},writeRegister:function(address,value){this.setPrgBank(value&7);this.mirroring=value&16?4:3}}},{}],22:[function(require,module,exports){var NROM=require("./nrom"),MMC1=require("./mmc1"),MMC2=require("./mmc2"),MMC3=require("./mmc3"),UxROM=require("./uxrom"),AxROM=require("./axrom");var mapperList={};mapperList[0]=NROM;mapperList[1]=MMC1;mapperList[2]=UxROM;mapperList[4]=MMC3;mapperList[7]=AxROM;mapperList[9]=MMC2;exports.init=function(cartridge){var mapper,method,mapperID=cartridge.mapper;if(!(mapperID in mapperList)){throw new Error("Unknown mapper "+mapperID)}mapper=mapperList[mapperID];for(method in mapper){cartridge[method]=mapper[method]}cartridge.init()}},{"./axrom":21,"./mmc1":23,"./mmc2":24,"./mmc3":25,"./nrom":26,"./uxrom":27}],23:[function(require,module,exports){var mirrorMap=[3,4,1,0];module.exports={init:function(){this.lastPRG=this.prgBanks-1;this.prgBank=0;this.chrBank0=0;this.chrBank1=1;this.registerWrites=0;this.registerShift=0;this.mapperControl(12)},mapperControl:function(value){var mirroring=value&3,prgMode=(value&12)>>2,chrMode=(value&16)>>4;this.mapperFlags=value;this.mirroring=mirrorMap[mirroring];this.prgMode=prgMode;this.chrMode=chrMode;this.setPRGBanks()},setRegister:function(address,value){switch(address&24576){case 0:this.mapperControl(value);break;case 8192:this.chrBank0=value;this.setChrBanks();break;case 16384:this.chrBank1=value;this.setChrBanks();break;case 24576:value&=15;this.prgBank=value;this.setPRGBanks();break}this.registerWrites=0;this.registerShift=0},setPRGBanks:function(){var bank0,bank1;switch(this.prgMode){case 0:case 1:bank0=this.prgBank&~1;bank1=this.prgBank+1;break;case 2:bank0=0;bank1=this.prgBank;break;case 3:bank0=this.prgBank;bank1=this.lastPRG;break}this.loadPRGBank(32768,bank0,16384);this.loadPRGBank(49152,bank1,16384)},setChrBanks:function(){var bank0,bank1;if(!this.chrMode){bank0=this.chrBank0&~1;bank1=bank0+1}else{bank0=this.chrBank0;bank1=this.chrBank1;if(this.chrBanks<2){bank0&=1;bank1&=1}}this.loadCHRBank(0,bank0,4096);this.loadCHRBank(4096,bank1,4096)},writeRegister:function(address,value){if(value&128){this.registerShift=0;this.registerWrites=0;this.mapperControl(this.mapperFlags|12)}else{this.registerShift=this.registerShift>>1|(value&1)<<4;this.registerWrites++;if(this.registerWrites===5){this.setRegister(address,this.registerShift)}}}}},{}],24:[function(require,module,exports){module.exports={init:function(){this.setPrgBank(0);this.mmc2PRG=this.prgBanks<<1;this.loadPRGBank(40960,this.mmc2PRG-3,8192);this.loadPRGBank(49152,this.mmc2PRG-2,8192);this.loadPRGBank(57344,this.mmc2PRG-1,8192);this.chrLatch0=false;this.chrLatch1=false;this.chrBank0=this.chrBank1=0;this.chrBank2=this.chrBank3=0;this.chrBankA=this.chrBank0;this.chrBankB=this.chrBank1;this.setChrBanks();this.initLatchSwitches();this._readCHR=Object.getPrototypeOf(this).readCHR},initLatchSwitches:function(){var i,switches=new Uint8Array(8192);switches[4056]=1;switches[4072]=2;for(i=8152;i<8160;i++){switches[i]=3}for(i=8168;i<8176;i++){switches[i]=4}this.latchSwitches=switches},setChrBanks:function(){var bank0=this.chrLatch0?this.chrBank1:this.chrBank0,bank1=this.chrLatch1?this.chrBank3:this.chrBank2;this.loadCHRBank(0,bank0,4096);this.loadCHRBank(4096,bank1,4096)},setPrgBank:function(bank){this.prgBank=bank;this.loadPRGBank(32768,this.prgBank,8192)},writeRegister:function(address,value){switch(address&28672){case 8192:this.setPrgBank(value&15);break;case 12288:this.chrBank0=value&31;break;case 16384:this.chrBank1=value&31;break;case 20480:this.chrBank2=value&31;break;case 24576:this.chrBank3=value&31;break;case 28672:this.mirroring=+!(value&1);break}this.setChrBanks()},readCHR:function(address){var value=this._readCHR(address);switch(this.latchSwitches[address]){case 0:break;case 1:if(this.chrLatch0){this.chrLatch0=false;this.setChrBanks()}break;case 2:if(!this.chrLatch0){this.chrLatch0=true;this.setChrBanks()}break;case 3:if(this.chrLatch1){this.chrLatch1=false;this.setChrBanks()}break;case 4:if(!this.chrLatch1){this.chrLatch1=true;this.setChrBanks()}break}return value}}},{}],25:[function(require,module,exports){module.exports={init:function(){this.lastA14=0;this.irqEnabled=false;this.irqCounter=0;this.irqCounterReset=0;this.willReloadIRQ=false;this.prgBank0=0;this.prgBank1=1;this.prgBase0=32768;this.prgBase1=40960;this.mmc3PRG=this.prgBanks<<1;this.lastPRG=this.mmc3PRG-1;this.lastPRG2=this.lastPRG-1;this.mmc3CHR=this.chrBanks<<3;this.setBankSelect(0);this._readCHR=Object.getPrototypeOf(this).readCHR},setBankSelect:function(value){var prgMode=+!!(value&64),chrMode=+!!(value&128);this.bankSelectMode=value&7;if(prgMode!==this.prgMode){this.setPRGMode(prgMode)}if(chrMode!==this.chrMode){this.setCHRMode(chrMode)}},setPRGMode:function(mode){this.prgMode=mode;if(mode){this.loadPRGBank(32768,this.lastPRG2,8192);this.prgBase0=49152}else{this.loadPRGBank(49152,this.lastPRG2,8192);this.prgBase0=32768}this.loadPRGBank(57344,this.lastPRG,8192);this.prgBase1=40960;this.setPRGBanks()},setBank:function(value){var bank=0,base=0;switch(this.bankSelectMode){case 1:bank=1;case 0:base=this.chrBigBase+bank*2048;this.loadCHRBank(base,value&~1,1024);this.loadCHRBank(base+1024,value|1,1024);break;case 2:case 3:case 4:case 5:bank=this.bankSelectMode-2;base=this.chrSmallBase+bank*1024;this.loadCHRBank(base,value,1024);break;case 6:this.prgBank0=value&this.mmc3PRG-1;this.setPRGBanks();break;case 7:this.prgBank1=value&this.mmc3PRG-1;this.setPRGBanks();break}},setPRGBanks:function(){this.loadPRGBank(this.prgBase0,this.prgBank0,8192);this.loadPRGBank(this.prgBase1,this.prgBank1,8192)},setCHRMode:function(mode){this.chrMode=mode;if(mode){this.chrBigBase=4096;this.chrSmallBase=0}else{this.chrBigBase=0;this.chrSmallBase=4096}},setMirroring:function(value){this.mirroring=+!(value&1)},setRAMProtect:function(){},reloadIRQ:function(){this.willReloadIRQ=true},setIRQCounter:function(value){this.irqCounterReset=value},enableIRQ:function(enabled){this.irqEnabled=enabled},writeRegister:function(address,value){var odd=address&1;switch(address&24576){case 0:if(odd){this.setBank(value)}else{this.setBankSelect(value)}break;case 8192:if(odd){this.setRAMProtect(value)}else{this.setMirroring(value)}break;case 16384:if(odd){this.reloadIRQ()}else{this.setIRQCounter(value)}break;case 24576:this.enableIRQ(!!odd);break}},readCHR:function(address){var a14=address&4096;if(a14&&a14!==this.lastA14){this.clockScanlineCounter()}this.lastA14=a14;return this._readCHR(address)},clockScanlineCounter:function(){if(this.willReloadIRQ||!this.irqCounter){this.irqCounter=this.irqCounterReset;this.willReloadIRQ=false}else{this.irqCounter--;if(!this.irqCounter&&this.irqEnabled){this.system.cpu.requestIRQ()}}}}},{}],26:[function(require,module,exports){module.exports={init:function(){var nrom128=this.prgBanks===1;if(nrom128){this.loadPRGBank(32768,0,16384);this.loadPRGBank(49152,0,16384)}else{this.loadPRGBank(32768,0,32768)}},readCHR:function(address){return this.chrData[address]},writeCHR:function(address,value){if(!this.chrBanks){this.chrData[address]=value}return value}}},{}],27:[function(require,module,exports){module.exports={init:function(){this.prgBank=0;this.loadPRGBank(32768,this.prgBank,16384);this.loadPRGBank(49152,this.prgBanks-1,16384)},writeRegister:function(address,value){this.prgBank=value&15;this.loadPRGBank(32768,this.prgBank,16384)}}},{}],28:[function(require,module,exports){"use strict";function Memory(system){var i=0;this.system=system;this.ram=new Uint8Array(2048);for(;i<2048;i++){this.ram[i]=255}this.address=0;this.cartridge=null;Object.preventExtensions(this)}Memory.prototype={loadCartridge:function(cartridge){this.cartridge=cartridge},readWrite:function(address,write,value){this.address=address;switch(address){case 16404:if(write){var i,base=value<<8;for(i=0;i<256;i++){this.write(8196,this.read(base+i))}this.system.cpu.burn(513)}return 0;case 16406:if(write){this.system.controllers.write(value);return 0}else{return this.system.controllers.read(0)}break;case 16407:if(write){}else{return this.system.controllers.read(1);

}}if(address>=16416){if(write){return this.system.cartridge.writePRG(address,value)}else{return this.system.cartridge.readPRG(address)}}else if(address<8192){address&=2047;if(write){this.ram[address]=value;return 0}else{return this.ram[address]}}else if(address<16384){address&=7;if(write){return this.system.ppu.writeRegister(address,value)}else{return this.system.ppu.readRegister(address)}}else{address&=255;if(write){return this.system.apu.writeRegister(address,value)}else{return this.system.apu.readRegister(address)}}},read:function(address){return this.readWrite(address,false,0)},write:function(address,value){return this.readWrite(address,true,value)}};module.exports=Memory},{}],29:[function(require,module,exports){function AudioOutput(){this.bufferIndex=0;this.bufferLength=8192;this.sampleRate=44100;this.volume=1;this.playing=null;this.setEnabled(true)}AudioOutput.prototype={writeSample:function(sample){this.bufferData[this.bufferIndex++]=sample;if(this.bufferIndex===this.bufferLength){this.bufferIndex=0;if(this.playing){this.playing.stop()}this.bufferSource.buffer=this.buffer;this.playing=this.bufferSource;this.playing.start(0);this.initBuffer()}},setEnabled:function(enabled){this.enabled=enabled&&this.isSupported();if(this.enabled){this.initHardware()}},setVolume:function(value){this.gainNode.gain.value=value;this.volume=value},initHardware:function(){if(this.context){return}this.initContext();this.initBuffer()},initContext:function(){this.context=new AudioContext;this.sampleRate=this.context.sampleRate;this.gainNode=this.context.createGain();this.gainNode.connect(this.context.destination)},initBuffer:function(){this.buffer=this.context.createBuffer(1,this.bufferLength,this.context.sampleRate);this.bufferData=this.buffer.getChannelData(0);this.bufferSource=this.context.createBufferSource();this.bufferSource.connect(this.gainNode)},isSupported:function(){return typeof AudioContext!=="undefined"}};module.exports=AudioOutput},{}],30:[function(require,module,exports){var AudioOutput=require("./audiooutput");var VideoOutput=require("./videooutput");function Output(){this.audio=new AudioOutput;this.video=new VideoOutput}module.exports=Output},{"./audiooutput":29,"./videooutput":34}],31:[function(require,module,exports){var palette=require("./palette").data;function Canvas2DRenderer(el){this.el=el;this.initData();this.initPalette()}Canvas2DRenderer.isSupported=function(el){return!!getContext(el)};Canvas2DRenderer.prototype={renderFrame:function(output){var bgBuffer=output.bgBuffer,spriteBuffer=output.spriteBuffer,prioBuffer=output.prioBuffer,bgColor=output.bgColor,reds=this.reds,greens=this.greens,blues=this.blues,end=bgBuffer.length;data=this.data;var pixelIndex=0,outputIndex=0,color=0;for(;pixelIndex<end;pixelIndex++){color=bgBuffer[pixelIndex];if(spriteBuffer[pixelIndex]&&!(prioBuffer[pixelIndex]&&color)){color=spriteBuffer[pixelIndex]}color=color||bgColor;data[outputIndex++]=reds[color];data[outputIndex++]=greens[color];data[outputIndex++]=blues[color];outputIndex++}this.image.data.set(data);this.context.putImageData(this.image,0,0)},initData:function(){this.width=256;this.height=224;this.data=new Uint8Array(this.width*this.height*4);for(var i=0;i<this.data.length;i++){this.data[i]=255}this.context=getContext(this.el);this.image=this.context.getImageData(0,0,this.width,this.height);this.index=0},initPalette:function(){var color=0,i=0,address=0,view=palette,buffer=new ArrayBuffer(192),splitPalette=new Uint8Array(buffer);for(color=0;color<3;color+=1){for(i=0;i<192;i+=3){splitPalette[address]=view[i+color];address+=1}}this.palette=view;this.reds=new Uint8Array(buffer,0,64);this.greens=new Uint8Array(buffer,64,64);this.blues=new Uint8Array(buffer,128,64)}};function getContext(el){return el.getContext("2d")}module.exports=Canvas2DRenderer},{"./palette":32}],32:[function(require,module,exports){exports.data=new Uint8Array([102,102,102,0,42,136,20,18,167,59,0,164,92,0,126,110,0,64,108,7,0,86,29,0,51,53,0,12,72,0,0,82,0,0,79,8,0,64,77,0,0,0,0,0,0,0,0,0,173,173,173,21,95,217,66,64,255,117,39,254,160,26,204,183,30,123,181,49,32,153,78,0,107,109,0,56,135,0,13,147,0,0,143,50,0,124,141,0,0,0,0,0,0,0,0,0,255,255,255,100,176,255,146,144,255,198,118,255,242,106,255,255,110,204,255,129,112,234,158,34,188,190,0,136,216,0,92,228,48,69,224,130,72,205,222,79,79,79,0,0,0,0,0,0,255,255,255,192,223,255,211,210,255,232,200,255,250,194,255,255,196,234,255,204,197,247,216,165,228,229,148,207,239,150,189,244,171,179,243,204,181,235,242,184,184,184,0,0,0,0,0,0])},{}],33:[function(require,module,exports){var palette=require("./palette").data;function WebGLRenderer(el){this.el=el;this.initGL()}WebGLRenderer.isSupported=function(el){return!!getGL(el)};WebGLRenderer.prototype={renderFrame:function(output){var gl=this.gl;gl.clearColor(0,0,0,1);gl.clear(gl.COLOR_BUFFER_BIT);gl.activeTexture(gl.TEXTURE0);gl.bindTexture(gl.TEXTURE_2D,this.bgTexture);gl.texImage2D(gl.TEXTURE_2D,0,gl.LUMINANCE,256,224,0,gl.LUMINANCE,gl.UNSIGNED_BYTE,output.bgBuffer);gl.activeTexture(gl.TEXTURE1);gl.bindTexture(gl.TEXTURE_2D,this.spriteTexture);gl.texImage2D(gl.TEXTURE_2D,0,gl.LUMINANCE,256,224,0,gl.LUMINANCE,gl.UNSIGNED_BYTE,output.spriteBuffer);gl.activeTexture(gl.TEXTURE2);gl.bindTexture(gl.TEXTURE_2D,this.prioTexture);gl.texImage2D(gl.TEXTURE_2D,0,gl.LUMINANCE,256,224,0,gl.LUMINANCE,gl.UNSIGNED_BYTE,output.prioBuffer);gl.activeTexture(gl.TEXTURE3);gl.bindTexture(gl.TEXTURE_2D,this.paletteTexture);var positionLocation=gl.getAttribLocation(this.program,"vertCoord");gl.enableVertexAttribArray(positionLocation);gl.vertexAttribPointer(positionLocation,2,gl.FLOAT,false,0,0);var color=output.bgColor*3;gl.uniform4f(this.bgColorLocation,palette[color]/256,palette[color+1]/256,palette[color+2]/256,1);gl.drawArrays(gl.TRIANGLES,0,6)},initGL:function(){var gl=this.gl=getGL(this.el);gl.viewport(0,0,256,224);this.initShaders();this.initProgram();this.initBuffers();this.initTextures();this.bgColorLocation=gl.getUniformLocation(this.program,"bgColor")},initBuffers:function(){var gl=this.gl;var buffer=this.buffer=gl.createBuffer();gl.bindBuffer(gl.ARRAY_BUFFER,buffer);gl.bufferData(gl.ARRAY_BUFFER,new Float32Array([-1,-1,1,-1,-1,1,-1,1,1,-1,1,1]),gl.STATIC_DRAW)},initTextures:function(){var gl=this.gl,program=this.program;this.bgTexture=createTexture(0,"bgTexture");this.spriteTexture=createTexture(1,"spriteTexture");this.prioTexture=createTexture(2,"prioTexture");this.paletteTexture=createTexture(3,"paletteTexture");gl.texImage2D(gl.TEXTURE_2D,0,gl.RGB,64,1,0,gl.RGB,gl.UNSIGNED_BYTE,palette);function createTexture(index,name){var texture=gl.createTexture();gl.bindTexture(gl.TEXTURE_2D,texture);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,gl.LINEAR);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.LINEAR);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.CLAMP_TO_EDGE);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,gl.CLAMP_TO_EDGE);gl.uniform1i(gl.getUniformLocation(program,name),index);return texture}},initShaders:function(){var gl=this.gl;var fragmentShaderSource=["precision mediump float;","uniform sampler2D bgTexture;","uniform sampler2D spriteTexture;","uniform sampler2D prioTexture;","uniform sampler2D paletteTexture;","uniform vec4 bgColor;","varying vec2 texCoord;","void main(void) {","float bgIndex = texture2D(bgTexture, texCoord).r;","float spriteIndex = texture2D(spriteTexture, texCoord).r;","float prioIndex = texture2D(prioTexture, texCoord).r;","float colorIndex = ((spriteIndex > 0.0 && (prioIndex == 0.0 || bgIndex == 0.0)) ? spriteIndex : bgIndex);","vec4 color = texture2D(paletteTexture, vec2( colorIndex * 4.0 + 0.0078, 0.5));","if ( colorIndex > 0.0 ) {","gl_FragColor = color;","} else {","gl_FragColor = vec4(1.0, 0.0, 0.0, 1.0);","gl_FragColor = bgColor;","}","}"].join("\n");var vertexShaderSource=["attribute vec2 vertCoord;","varying vec2 texCoord;","void main() {","gl_Position = vec4(vertCoord, 0, 1);","texCoord = vec2( 0.5 * ( vertCoord.x + 1.0 ), 0.5 * (1.0 - vertCoord.y));","}"].join("");this.fragmentShader=compileShader(gl.FRAGMENT_SHADER,fragmentShaderSource);this.vertexShader=compileShader(gl.VERTEX_SHADER,vertexShaderSource);function compileShader(shaderType,shaderSource){var shader=gl.createShader(shaderType);gl.shaderSource(shader,shaderSource);gl.compileShader(shader);if(!gl.getShaderParameter(shader,gl.COMPILE_STATUS)){throw"An error occurred compiling the shaders: "+gl.getShaderInfoLog(shader)}return shader}},initProgram:function(){var gl=this.gl;var program=gl.createProgram();gl.attachShader(program,this.vertexShader);gl.attachShader(program,this.fragmentShader);gl.linkProgram(program);gl.useProgram(program);this.program=program}};function getGL(el){return el.getContext("webgl")||el.getContext("experimental-webgl")}module.exports=WebGLRenderer},{"./palette":32}],34:[function(require,module,exports){var WebGLRenderer=require("./renderer/webgl"),Canvas2DRenderer=require("./renderer/canvas2d");function VideoOutput(){var width=256,height=225,length=width*height;this.pixelBuffer=new Uint8Array(length);this.bgBuffer=new Uint8Array(length);this.spriteBuffer=new Uint8Array(length);this.prioBuffer=new Uint8Array(length);this.index=0;this.bgColor=0}VideoOutput.prototype={force2D:false,run:function(){var self=this;requestAnimationFrame(function flush(){requestAnimationFrame(flush);self.renderer.renderFrame(self)})},reset:function(bgColor){this.index=0;this.bgColor=bgColor},setIntensity:function(red,green,blue){},setGrayscale:function(grayscale){},outputScanline:function(background,sprites,priorities){this.bgBuffer.set(background,this.index);this.spriteBuffer.set(sprites,this.index);this.prioBuffer.set(priorities,this.index);this.index+=256},setElement:function(el){this.el=el;this.initRenderer()},initRenderer:function(){if(!this.force2D&&WebGLRenderer.isSupported(this.el)){this.renderer=new WebGLRenderer(this.el)}else if(Canvas2DRenderer.isSupported(this.el)){this.renderer=new Canvas2DRenderer(this.el)}else{throw new Error("No supported renderer!")}}};module.exports=VideoOutput},{"./renderer/canvas2d":31,"./renderer/webgl":33}],35:[function(require,module,exports){"use strict";var bitmap=require("../utils/bitmap");var NAMETABLE_BITMASK=3072,NAMETABLE_RESET=~NAMETABLE_BITMASK,attrAddresses=initAttrAddresses(),tileCycles=initTileCycles(),palettes=initPalettes(),masks=initMasks();function Background(ppu){this.ppu=ppu;this.memory=ppu.memory;this.enabled=true;this.enabledLeft=true;this.pixelOffset=0;this.loopyV=0;this.loopyT=0;this.loopyW=0;this.loopyX=0;this.baseTable=0;this.x=0;this.y=0;this.scanlineColors=new Uint8Array(256);this.scanlineReset=new Uint8Array(256);Object.preventExtensions(this)}Background.prototype={toggle:function(flag){this.enabled=!!flag},toggleLeft:function(flag){this.enabledLeft=!!flag},writeAddress:function(value){if(this.loopyW){value&=255;this.loopyT=this.loopyT&65280|value;this.loopyV=this.loopyT}else{value&=63;value=value<<8;this.loopyT=this.loopyT&255|value}this.loopyW=!this.loopyW},writeScroll:function(value){if(this.loopyW){this.loopyT=this.loopyT&~29664;this.loopyT=this.loopyT|(value&7)<<12;this.loopyT=this.loopyT|(value&248)<<2;this.loopyW=0}else{this.loopyT=this.loopyT&32736;this.loopyT|=value>>3;this.loopyX=value&7;this.loopyW=1}},evaluate:function(){var ppu=this.ppu,lineCycle=ppu.lineCycle;if(tileCycles[lineCycle]){this.fetchTile()}if(ppu.scanline===-1&&lineCycle>280&&lineCycle<304){this.loopyV=this.loopyV&1055|this.loopyT&31712}},initScanline:function(){this.pixelOffset=this.enabledLeft?0:8},endScanline:function(){this.incrementVY();this.loopyV=this.loopyV&31712|this.loopyT&1055;this.scanlineColors.set(this.scanlineReset);this.x=-this.loopyX},incrementVX:function(){if((this.loopyV&31)===31){this.loopyV=this.loopyV&(65535&~31)^1024}else{this.loopyV+=1}this.x+=8},incrementVY:function(){if((this.loopyV&28672)!=28672){this.loopyV+=4096}else{this.loopyV&=~28672;var coarseY=(this.loopyV&992)>>>5;if(coarseY==29){coarseY=0;this.loopyV^=2048}else if(coarseY==31){coarseY=0}else{coarseY+=1}this.loopyV=this.loopyV&~992|coarseY<<5}this.y=(this.loopyV&28672)>>12},fetchTile:function(){var cartridge=this.memory.cartridge,attrAddress=attrAddresses[this.loopyV],attribute=cartridge.readNameTable(attrAddress&8191),nametableAddress=8192|this.loopyV&4095,tileIndex=cartridge.readNameTable(nametableAddress&8191),tile=cartridge.readTile(this.baseTable,tileIndex,this.y);if(tile){this.renderTile(tile,palettes[attribute&masks[this.loopyV&4095]])}this.incrementVX()},renderTile:function(tile,palette){var colors=bitmap.getColors(tile),color=0,begin=Math.max(this.pixelOffset,this.x),end=Math.min(255,this.x+7),i=7-(end-begin);for(;end>=begin;end--){color=colors[i++];if(color){this.scanlineColors[end]=this.ppu.memory.palette[palette|color]}}},setNameTable:function(index){this.loopyT=this.loopyT&NAMETABLE_RESET|index<<10}};function initAttrAddresses(){var i,result=new Uint16Array(32768);for(i=0;i<32768;i++){result[i]=9152|i&3072|i>>4&56|i>>2&7}return result}function initMasks(){var i,mask,result=new Uint8Array(65536);for(i=0;i<65536;i++){mask=3;if(i&2){mask<<=2}if(i&64){mask<<=4}result[i]=mask}return result}function initPalettes(){var i,j,result=new Uint8Array(256);for(i=0;i<4;i++){for(j=0;j<8;j+=2){result[i<<j]=i<<2}}return result}function initTileCycles(){var i,result=new Uint8Array(400);for(i=7;i<256;i+=8){result[i]=1}for(i=327;i<336;i+=8){result[i]=1}return result}module.exports=Background},{"../utils/bitmap":39}],36:[function(require,module,exports){"use strict";var Background=require("./background");var Sprites=require("./sprites");var Memory=require("./memory");function PPU(system){this.system=system;this.ram=new Uint8Array(2048);this.enabled=true;this.frameEnded=false;this.vBlank=false;this.warmup=2;this.scanline=-1;this.lineCycle=0;this.increment=1;this.masterSlave=0;this.generateNMI=false;this.sprite0Hit=false;this.nmiOccurred=false;this.checkNMI=false;this.pixelInRange=false;this.yInRange=false;this.inRenderScanline=true;this.readBuffer=0;this.countdown=0;this.memory=new Memory(this);this.background=new Background(this);this.sprites=new Sprites(this);this.output=this.system.output.video;Object.preventExtensions(this)}PPU.prototype={readStatus:function(){var result=!!this.nmiOccurred<<7|!!this.sprite0Hit<<6|!!this.sprites.spriteOverflow<<5;this.nmiOccurred=false;return result},mask:function(value){this.output.setGrayscale(value&1);this.output.setIntensity(value&32,value&64,value&128);this.sprites.toggle(value&16);this.sprites.toggleLeft(value&4);this.background.toggle(value&8);this.background.toggleLeft(value&2);this.enabled=this.sprites.enabled||this.background.enabled},control:function(value){var nametableFlag=value&3,incrementFlag=value&4,spriteFlag=value&8,backgroundFlag=value&16,sizeFlag=value&32,nmiFlag=value&128;this.background.setNameTable(nametableFlag);this.increment=incrementFlag?32:1;this.sprites.baseTable=spriteFlag?4096:0;this.background.baseTable=backgroundFlag?4096:0;this.sprites.spriteSize=sizeFlag?16:8;this.generateNMI=!!nmiFlag},readRegister:function(address){var result;switch(address){case 2:result=this.readStatus();this.background.loopyW=0;return result;case 4:return this.sprites.readOAM();case 7:result=this.readBuffer;this.readBuffer=this.memory.read(this.background.loopyV);if((this.background.loopyV&16128)===16128){result=this.readBuffer;this.readBuffer=this.memory.read(this.background.loopyV&12287)}this.background.loopyV+=this.increment;return result}},writeRegister:function(address,value){switch(address){case 0:this.control(value);break;case 1:this.mask(value);break;case 3:this.sprites.oamAddress=value;break;case 4:this.sprites.writeOAM(value);break;case 5:this.background.writeScroll(value);break;case 6:this.background.writeAddress(value);break;case 7:this.memory.write(this.background.loopyV,value);this.background.loopyV+=this.increment;break}},tick:function(){var sprites=this.sprites,background=this.background;if(this.inRenderScanline){if(this.enabled){background.evaluate();sprites.evaluate()}if(this.pixelInRange){if(this.pixelInRange&&sprites.sprite0InRange&&sprites.scanlineSprite0[this.lineCycle-1]&&!this.sprite0Hit){this.sprite0Hit=!!background.scanlineColors[this.lineCycle-1]}}this.incrementRenderCycle()}else{this.incrementIdleCycle()}},incrementRenderCycle:function(){switch(++this.lineCycle){case 1:this.background.initScanline();this.sprites.initScanline();this.pixelInRange=this.yInRange;break;case 257:this.pixelInRange=false;if(this.yInRange){this.output.outputScanline(this.background.scanlineColors,this.sprites.scanlineColors,this.sprites.scanlinePriority)}if(this.enabled){this.background.endScanline();this.sprites.endScanline()}break;case 341:this.incrementScanline();break}},incrementIdleCycle:function(){if(!this.countdown--){this.scanline=-1;this.frameEnded=true;this.inRenderScanline=true;this.vBlank=this.nmiOccurred=false;this.checkNMI=false;this.sprites.spriteOverflow=false;this.sprite0Hit=false}},incrementScanline:function(){this.scanline++;this.lineCycle=0;switch(this.scanline){case 8:this.output.reset(this.memory.palette[0]);this.yInRange=true;break;case 233:this.yInRange=false;break;case 240:this.inRenderScanline=false;this.vBlank=this.nmiOccurred=this.checkNMI=true;if(this.generateNMI){this.system.cpu.requestNMI()}this.countdown=6800;break}}};module.exports=PPU},{"./background":35,"./memory":37,"./sprites":38}],37:[function(require,module,exports){"use strict";function Memory(ppu){this.ppu=ppu;this.system=ppu.system;this.palette=new Uint8Array(32);this.cartridge=null;Object.preventExtensions(this)}Memory.prototype={loadCartridge:function(cartridge){this.cartridge=cartridge},read:function(address){return this._readWrite(address,0,0)},write:function(address,value){this._readWrite(address,value,1)},_readWrite:function(address,value,write){var relativeAddress=0;address&=16383;if(!(address&~8191)){if(write){return this.cartridge.writeCHR(address,value)}else{return this.cartridge.readCHR(address)}}else if(!(address&~12287)){relativeAddress=address&8191;if(write){this.cartridge.writeNameTable(relativeAddress,value);return 0}else{return this.cartridge.readNameTable(relativeAddress)}}else if(address<16128){return this._readWrite(address-4096,value,write)}else if(address<16383){relativeAddress=address&31;if((relativeAddress&3)===0){relativeAddress&=~16}if(write){this.palette[relativeAddress]=value;return 0}else{return this.palette[relativeAddress]}return 0}}};module.exports=Memory},{}],38:[function(require,module,exports){"use strict";var bitmap=require("../utils/bitmap");var tileCycles=initTileCycles();function Sprites(ppu){this.ppu=ppu;this.memory=ppu.memory;this.enabled=true;this.enabledLeft=true;this.pixelOffset=0;this.oamAddress=0;this.oam=new Uint8Array(256);this.oam2=new Uint8Array(33);this.oam2reset=new Uint8Array(this.oam2.length);for(var i=0;i<this.oam2reset.length;i++){this.oam2reset[i]=255}this.spriteProgress=0;this.currentSprite=0;this.spriteSize=8;this.baseTable=0;this.sprite0Next=false;this.sprite0InRange=false;this.spriteOverflow=false;this.scanlineOverflow=false;this.spriteCount=0;this.nextSpriteCount=0;this.yCounters=new Uint8Array(64);this.yCountersReset=new Uint8Array(this.yCounters.length);this.nextScanlineSprite0=new Uint8Array(256);this.nextScanlinePriority=new Uint8Array(256);this.nextScanlineColors=new Uint8Array(256);this.scanlineSprite0=new Uint8Array(256);this.scanlinePriority=new Uint8Array(256);this.scanlineColors=new Uint8Array(256);this.scanlineReset=new Uint8Array(this.scanlineColors.length);Object.preventExtensions(this)}Sprites.prototype={toggle:function(flag){this.enabled=!!flag},toggleLeft:function(flag){this.enabledLeft=!!flag},evaluate:function(){if(tileCycles[this.ppu.lineCycle]){this.fetchTile()}},initScanline:function(){this.currentSprite=0;this.sprite0InRange=this.sprite0Next;this.sprite0Next=false;this.scanlineOverflow=false;this.oamAddress=0;this.clearSecondaryOAM();this.scanlineSprite0.set(this.nextScanlineSprite0);this.scanlinePriority.set(this.nextScanlinePriority);this.scanlineColors.set(this.nextScanlineColors);if(this.nextSpriteCount){this.nextScanlineSprite0.set(this.scanlineReset);this.nextScanlinePriority.set(this.scanlineReset);this.nextScanlineColors.set(this.scanlineReset)}this.spriteCount=this.nextSpriteCount;this.nextSpriteCount=0},endScanline:function(){this.initSecondaryOAM()},readOAM:function(){if(this.ppu.vBlank){return this.oam[this.oamAddress]}return 0},writeOAM:function(value){if(this.ppu.vBlank){this.oam[this.oamAddress]=value;this.oamAddress=this.oamAddress+1&255}},clearSecondaryOAM:function(){this.oam2.set(this.oam2reset);if(this.ppu.scanline===-1){this.yCounters.set(this.yCountersReset)}},initSecondaryOAM:function(){var ppu=this.ppu;if(!ppu.enabled){return}var value,oam2Index=0,index=this.oamAddress;for(var n=0;n<64;n++){value=this.oam[index];this.oam2[oam2Index]=value;if(ppu.scanline===value){this.yCounters[n]=this.spriteSize}if(this.yCounters[n]){if(!this.scanlineOverflow){this.oam2.set(this.oam.subarray(index,index+4),oam2Index);if(n===0){this.sprite0Next=true}this.nextSpriteCount++;oam2Index+=4;if(oam2Index===32){this.scanlineOverflow=true}}else{this.spriteOverflow=true}this.yCounters[n]--}index+=4}this.oamAddress=index;this.oam2[oam2Index]=0},fetchTile:function(){var spriteIndex=this.currentSprite<<2,y=this.oam2[spriteIndex],tileIndex=this.oam2[spriteIndex+1],attributes=this.oam2[spriteIndex+2],x=this.oam2[spriteIndex+3],baseTable=this.baseTable,tile=0,flipX=attributes&64,flipY=0,fineY=0;flipY=attributes&128;fineY=this.ppu.scanline-y&this.spriteSize-1;if(this.spriteSize===16){baseTable=tileIndex&1?4096:0;tileIndex=tileIndex&~1;if(fineY>7){fineY-=8;if(!flipY){tileIndex++}}else if(flipY){tileIndex++}}if(flipY){fineY=8-fineY-1}tile=this.memory.cartridge.readTile(baseTable,tileIndex,fineY);if(flipX){tile=bitmap.reverseTile(tile)}if(this.currentSprite<this.nextSpriteCount){this.renderTile(x,tile,attributes)}this.currentSprite+=1},renderTile:function(x,tile,attributes){var colors=bitmap.getColors(tile),palette=16|(attributes&3)<<2,priority=attributes&32,sprite0=this.currentSprite===0&&this.sprite0Next,color=0,i=8;for(;i>=0&&x>=this.pixelOffset&&x<256;i--){if(!this.nextScanlineColors[x]){color=colors[i];if(color){this.nextScanlineColors[x]=this.ppu.memory.palette[palette|color];this.nextScanlinePriority[x]=priority;this.nextScanlineSprite0[x]=sprite0}}x++}}};function initTileCycles(){var i,result=new Uint8Array(512);for(i=264;i<=320;i+=8){result[i]=1}return result}module.exports=Sprites},{"../utils/bitmap":39}],39:[function(require,module,exports){var colors=initColors();var reversedBytes=initReversedBytes();var reversedTiles=initReversedTiles();exports.getColors=function(tile){var offset=tile<<8;return colors.subarray(offset,offset+8)};exports.reverseByte=reverseByte;exports.reverseTile=function(tile){return reversedTiles[tile]};function reverseByte(byte){return reversedBytes[byte]}function initColors(){var low,high,result=new Uint8Array(16777216);for(low=0;low<256;low++){for(high=0;high<256;high++){addTile(low,high)}}return result;function addTile(low,high){var colorLow,colorHigh,color,offset=low<<16|high<<8;for(var i=0;i<8;i++){colorLow=low&1;colorHigh=(high&1)<<1;color=colorHigh|colorLow;result[offset+i]=color;low>>=1;high>>=1}}}function initReversedTiles(){var low,high,tile,reversed,result=new Uint16Array(65536);for(low=0;low<256;low++){for(high=0;high<256;high++){tile=low<<8|high;reversed=reverseByte(low)<<8|reverseByte(high);result[tile]=reversed}}return result}function initReversedBytes(){var i,result=new Uint8Array(256);for(i=0;i<256;i++){result[i]=calcReverse(i)}return result;function calcReverse(original){var i,reverse=0;for(i=7;i>=0;i--){reverse|=(original&1)<<i;original>>>=1}return reverse}}},{}]},{},[1]);